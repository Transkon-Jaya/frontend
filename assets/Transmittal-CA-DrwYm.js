import{_ as $,c as d,a as e,q as C,h as g,z as T,t as r,F as S,j as E,b as i,k as N,s as I,v as u,u as tt,r as b,n as et,o as at,p as A,A as U,g as m}from"./index-CFqpVhRV.js";const lt={setup(){const p=tt(),t=b([]),w=b(!1),a=b(!1),D=b(null),R=b([]),l=b(!1),x=b(!1),P=b(!1),V=b(null),v=b({ta_id:"",date:"",from_origin:"",document_type:"",attention:"",company:"",address:"",state:"",awb_reg:"",expeditur:"",receiver_name:"",receive_date:null,ras_status:"",description:"",remarks:""}),y=b(1),B=b(10),_=b(1),F=b(0),j=()=>{const s="TRJA",n=new Date,o=n.getFullYear().toString().slice(-2),f=(n.getMonth()+1).toString().padStart(2,"0"),c=n.getDate().toString().padStart(2,"0"),M=Math.floor(1e3+Math.random()+1);return`${s}${o}${f}${c}-${M}`},q=()=>{v.value.receive_date===""&&(v.value.receive_date=null)},k=async()=>{var s,n;try{w.value=!0,D.value=null;const o=await A.get(`${U}/transmittal`,{params:{page:y.value,limit:B.value},headers:{Authorization:`Bearer ${p.token}`}});t.value=o.data.items||[],_.value=o.data.totalPages||1,F.value=o.data.totalCount||0}catch(o){D.value=((n=(s=o.response)==null?void 0:s.data)==null?void 0:n.error)||"Failed to load data",console.error("Fetch Error:",o)}finally{w.value=!1}},L=()=>{v.value={ta_id:j(),date:"",from_origin:"",document_type:"",attention:"",company:"",address:"",state:"",awb_reg:"",expeditur:"",receiver_name:"",receive_date:null,ras_status:"",description:"",remarks:""},P.value=!1,l.value=!0},O=async s=>{var n,o;try{w.value=!0;const c=(await A.get(`${U}/transmittal`,{params:{ta_id:s},headers:{Authorization:`Bearer ${p.token}`}})).data.data;v.value={...c,receive_date:c.receive_date||null},P.value=!0,l.value=!0}catch(f){D.value="Failed to load transmittal: "+(((o=(n=f.response)==null?void 0:n.data)==null?void 0:o.error)||f.message)}finally{w.value=!1}},h=async()=>{var s,n;try{a.value=!0,D.value=null,v.value.receive_date===""&&(v.value.receive_date=null);const o=`${U}/transmittal`,f=P.value?"put":"post",c=P.value?{ta_id:v.value.ta_id}:{},M=await A[f](o,v.value,{params:c,headers:{Authorization:`Bearer ${p.token}`,"Content-Type":"application/json"}});if(M.data.status===200||M.data.status===201)z(),k();else throw new Error(M.data.error||"Operation failed")}catch(o){D.value=((n=(s=o.response)==null?void 0:s.data)==null?void 0:n.error)||o.message||"Save failed",console.error("Submit Error:",o)}finally{a.value=!1}},J=s=>{V.value=s,x.value=!0},K=async()=>{var s,n;try{a.value=!0,await A.delete(`${U}/transmittal`,{params:{ta_id:V.value},headers:{Authorization:`Bearer ${p.token}`}}),x.value=!1,k()}catch(o){D.value="Delete failed: "+(((n=(s=o.response)==null?void 0:s.data)==null?void 0:n.error)||o.message)}finally{a.value=!1}},z=()=>{l.value=!1,v.value={ta_id:"",date:"",from_origin:"",document_type:"",attention:"",company:"",address:"",state:"",awb_reg:"",expeditur:"",receiver_name:"",receive_date:null,ras_status:"",description:"",remarks:""}},W=()=>{y.value<_.value&&(y.value++,k())},Y=()=>{y.value>1&&(y.value--,k())},G=s=>{y.value=s,k()},H=()=>{y.value=1,k()},Q=s=>s?new Date(s).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):"-",X=s=>({Pending:"badge bg-warning",Received:"badge bg-info",Completed:"badge bg-success"})[s]||"badge bg-secondary",Z=et(()=>{const s=[];let o=Math.max(1,y.value-2),f=Math.min(_.value,o+5-1);f-o+1<5&&(o=Math.max(1,f-5+1));for(let c=o;c<=f;c++)s.push(c);return s});return at(()=>{k()}),{transmittals:t,loading:w,error:D,submitting:a,customers:R,showModal:l,isEditing:P,showDeleteModal:x,deleteTaId:V,formData:v,currentPage:y,itemsPerPage:B,totalPages:_,totalCount:F,visiblePages:Z,fetchTransmittals:k,openAddModal:L,openEditModal:O,submitForm:h,confirmDelete:J,deleteTransmittal:K,closeModal:z,nextPage:W,prevPage:Y,goToPage:G,resetPagination:H,formatDate:Q,statusBadgeClass:X,handleReceiveDateInput:q}}},ot={class:"container-fluid"},st={class:"card border-0 shadow"},nt={class:"card-header bg-black text-white"},rt={class:"d-flex justify-content-between align-items-center"},dt=["disabled"],it=["disabled"],mt={class:"card-body"},ut={key:0,class:"alert alert-danger alert-dismissible fade show mb-4"},bt={key:1,class:"text-center py-5"},ft={key:2,class:"text-center py-5"},vt={key:3},ct={class:"table-responsive"},gt={class:"table table-hover table-bordered"},pt={class:"text-center"},yt=["onClick"],Dt=["onClick"],kt={class:"d-flex justify-content-between align-items-center mt-4"},xt={class:"text-muted"},wt={class:"pagination pagination-sm"},Ct=["onClick"],Pt={class:"form-group mb-0",style:{width:"120px"}},Mt={class:"modal-content border-0 shadow"},Tt={class:"modal-header bg-black text-white"},_t={class:"modal-title"},At={class:"modal-body"},Ut={class:"row g-3"},Vt={class:"col-md-6"},St=["readonly","placeholder"],Et={class:"col-md-6"},It={class:"col-md-6"},Rt={class:"col-md-6"},Bt={class:"col-md-6"},Ft={key:0,class:"list-group mt-1",style:{position:"absolute","z-index":"1000",width:"calc(100% - 2px)"}},zt=["onClick"],Nt={class:"col-md-6"},jt={class:"col-md-6"},qt={class:"col-md-6"},Lt={class:"col-md-6"},Ot={class:"col-md-6"},ht={class:"col-md-6"},Jt={class:"col-md-6"},Kt={class:"col-md-6"},Wt={class:"col-md-6"},Yt={class:"col-md-12"},Gt={class:"modal-footer border-top-0 mt-4"},Ht=["disabled"],Qt={key:0,class:"spinner-border spinner-border-sm me-1"},Xt={class:"modal-content border-0 shadow"},Zt={class:"modal-header bg-danger text-white"},$t={class:"modal-body"},te={class:"modal-footer border-top-0"},ee=["disabled"],ae={key:0,class:"spinner-border spinner-border-sm me-1"};function le(p,t,w,a,D,R){return m(),d("div",ot,[e("div",st,[e("div",nt,[e("div",rt,[t[39]||(t[39]=e("h3",{class:"mb-0"},"Transmittal Management",-1)),e("div",null,[e("button",{onClick:t[0]||(t[0]=(...l)=>a.openAddModal&&a.openAddModal(...l)),class:"btn btn-sm btn-light me-2",disabled:a.loading},t[37]||(t[37]=[e("i",{class:"fas fa-plus me-1"},null,-1),g(" Add New ")]),8,dt),e("button",{onClick:t[1]||(t[1]=(...l)=>a.fetchTransmittals&&a.fetchTransmittals(...l)),class:"btn btn-sm btn-light",disabled:a.loading},[e("i",{class:T(["fas fa-sync",{"fa-spin":a.loading}])},null,2),t[38]||(t[38]=g(" Refresh "))],8,it)])])]),e("div",mt,[a.error?(m(),d("div",ut,[t[40]||(t[40]=e("strong",null,"Error:",-1)),g(" "+r(a.error)+" ",1),e("button",{type:"button",class:"btn-close",onClick:t[2]||(t[2]=l=>a.error=null)})])):C("",!0),a.loading&&!a.showModal?(m(),d("div",bt,t[41]||(t[41]=[e("div",{class:"spinner-border text-primary",role:"status"},null,-1),e("p",{class:"mt-2"},"Loading transmittals...",-1)]))):a.transmittals.length===0&&!a.loading?(m(),d("div",ft,[t[44]||(t[44]=e("i",{class:"fas fa-database fa-3x text-muted mb-3"},null,-1)),t[45]||(t[45]=e("h5",null,"No Transmittals Found",-1)),t[46]||(t[46]=e("p",{class:"text-muted"},"There are no transmittal records available",-1)),e("button",{onClick:t[3]||(t[3]=(...l)=>a.openAddModal&&a.openAddModal(...l)),class:"btn btn-primary me-2"},t[42]||(t[42]=[e("i",{class:"fas fa-plus me-1"},null,-1),g(" Create New ")])),e("button",{onClick:t[4]||(t[4]=(...l)=>a.fetchTransmittals&&a.fetchTransmittals(...l)),class:"btn btn-outline-primary"},t[43]||(t[43]=[e("i",{class:"fas fa-sync me-1"},null,-1),g(" Refresh ")]))])):(m(),d("div",vt,[e("div",ct,[e("table",gt,[t[49]||(t[49]=e("thead",{class:"table-light"},[e("tr",null,[e("th",null,"TA ID"),e("th",null,"Date"),e("th",null,"From Origin"),e("th",null,"Document Type"),e("th",null,"Company"),e("th",null,"Status"),e("th",null,"Receive Date"),e("th",null,"Actions")])],-1)),e("tbody",null,[(m(!0),d(S,null,E(a.transmittals,l=>(m(),d("tr",{key:l.ta_id},[e("td",null,[e("code",null,r(l.ta_id),1)]),e("td",null,r(a.formatDate(l.date)),1),e("td",null,r(l.from_origin),1),e("td",null,r(l.document_type),1),e("td",null,r(l.company),1),e("td",null,[e("span",{class:T(a.statusBadgeClass(l.ras_status))},r(l.ras_status),3)]),e("td",null,r(l.receive_date?a.formatDate(l.receive_date):"-"),1),e("td",pt,[e("button",{onClick:x=>a.openEditModal(l.ta_id),class:"btn btn-sm btn-warning me-1"},t[47]||(t[47]=[e("i",{class:"fas fa-edit"},null,-1)]),8,yt),e("button",{onClick:x=>a.confirmDelete(l.ta_id),class:"btn btn-sm btn-danger"},t[48]||(t[48]=[e("i",{class:"fas fa-trash"},null,-1)]),8,Dt)])]))),128))])])]),e("div",kt,[e("div",xt," Page "+r(a.currentPage)+" of "+r(a.totalPages)+" ("+r(a.totalCount)+" records) ",1),e("nav",null,[e("ul",wt,[e("li",{class:T(["page-item",{disabled:a.currentPage===1}])},[e("button",{class:"page-link",onClick:t[5]||(t[5]=(...l)=>a.prevPage&&a.prevPage(...l))},"«")],2),(m(!0),d(S,null,E(a.visiblePages,l=>(m(),d("li",{key:l,class:T(["page-item",{active:l===a.currentPage}])},[e("button",{class:"page-link",onClick:x=>a.goToPage(l)},r(l),9,Ct)],2))),128)),e("li",{class:T(["page-item",{disabled:a.currentPage===a.totalPages}])},[e("button",{class:"page-link",onClick:t[6]||(t[6]=(...l)=>a.nextPage&&a.nextPage(...l))},"»")],2)])]),e("div",Pt,[i(e("select",{"onUpdate:modelValue":t[7]||(t[7]=l=>a.itemsPerPage=l),class:"form-select form-select-sm",onChange:t[8]||(t[8]=(...l)=>a.resetPagination&&a.resetPagination(...l))},t[50]||(t[50]=[e("option",{value:"10"},"10 / page",-1),e("option",{value:"25"},"25 / page",-1),e("option",{value:"50"},"50 / page",-1)]),544),[[N,a.itemsPerPage]])])])]))])]),a.showModal?(m(),d("div",{key:0,class:"modal fade show d-block",style:{"z-index":"1050",background:"rgba(0,0,0,0.5)"},onClick:t[31]||(t[31]=(...l)=>a.closeModal&&a.closeModal(...l))},[e("div",{class:"modal-dialog modal-dialog-centered modal-lg",onClick:t[30]||(t[30]=I(()=>{},["stop"]))},[e("div",Mt,[e("div",Tt,[e("h5",_t,r(a.isEditing?"Edit Transmittal":"Add New Transmittal"),1),e("button",{type:"button",class:"btn-close btn-close-white",onClick:t[9]||(t[9]=(...l)=>a.closeModal&&a.closeModal(...l))})]),e("div",At,[e("form",{onSubmit:t[29]||(t[29]=I((...l)=>a.submitForm&&a.submitForm(...l),["prevent"]))},[e("div",Ut,[e("div",Vt,[t[51]||(t[51]=e("label",{class:"form-label"},"TA ID",-1)),i(e("input",{"onUpdate:modelValue":t[10]||(t[10]=l=>a.formData.ta_id=l),type:"text",class:"form-control",readonly:a.isEditing,placeholder:a.isEditing?"":"Auto-generated on save",required:""},null,8,St),[[u,a.formData.ta_id]])]),e("div",Et,[t[52]||(t[52]=e("label",{class:"form-label"},[g("Date "),e("span",{class:"text-danger"},"*")],-1)),i(e("input",{"onUpdate:modelValue":t[11]||(t[11]=l=>a.formData.date=l),type:"date",class:"form-control",required:""},null,512),[[u,a.formData.date]])]),e("div",It,[t[53]||(t[53]=e("label",{class:"form-label"},[g("From Origin "),e("span",{class:"text-danger"},"*")],-1)),i(e("input",{"onUpdate:modelValue":t[12]||(t[12]=l=>a.formData.from_origin=l),type:"text",class:"form-control",required:""},null,512),[[u,a.formData.from_origin]])]),e("div",Rt,[t[54]||(t[54]=e("label",{class:"form-label"},"Document Type",-1)),i(e("input",{"onUpdate:modelValue":t[13]||(t[13]=l=>a.formData.document_type=l),type:"text",class:"form-control"},null,512),[[u,a.formData.document_type]])]),e("div",Bt,[t[55]||(t[55]=e("label",{class:"form-label"},"Company",-1)),i(e("input",{"onUpdate:modelValue":t[14]||(t[14]=l=>a.formData.company=l),type:"text",class:"form-control",onInput:t[15]||(t[15]=(...l)=>p.handleCompanyInput&&p.handleCompanyInput(...l)),onBlur:t[16]||(t[16]=l=>p.selectedCustomer=null),placeholder:"Ketik untuk cari customer"},null,544),[[u,a.formData.company]]),a.customers.length>0?(m(),d("ul",Ft,[(m(!0),d(S,null,E(a.customers,l=>(m(),d("li",{key:l.name,class:"list-group-item list-group-item-action",onClick:x=>p.selectCustomer(l),style:{cursor:"pointer"}},r(l.name)+" - "+r(l.address||"No address"),9,zt))),128))])):C("",!0)]),e("div",Nt,[t[56]||(t[56]=e("label",{class:"form-label"},"Attention",-1)),i(e("input",{"onUpdate:modelValue":t[17]||(t[17]=l=>a.formData.attention=l),type:"text",class:"form-control"},null,512),[[u,a.formData.attention]])]),e("div",jt,[t[57]||(t[57]=e("label",{class:"form-label"},"Address",-1)),i(e("textarea",{"onUpdate:modelValue":t[18]||(t[18]=l=>a.formData.address=l),rows:"2",class:"form-control"},null,512),[[u,a.formData.address]])]),e("div",qt,[t[58]||(t[58]=e("label",{class:"form-label"},"State",-1)),i(e("input",{"onUpdate:modelValue":t[19]||(t[19]=l=>a.formData.state=l),type:"text",class:"form-control"},null,512),[[u,a.formData.state]])]),e("div",Lt,[t[59]||(t[59]=e("label",{class:"form-label"},"AWB/Reg",-1)),i(e("input",{"onUpdate:modelValue":t[20]||(t[20]=l=>a.formData.awb_reg=l),type:"text",class:"form-control"},null,512),[[u,a.formData.awb_reg]])]),e("div",Ot,[t[60]||(t[60]=e("label",{class:"form-label"},"Expeditur",-1)),i(e("input",{"onUpdate:modelValue":t[21]||(t[21]=l=>a.formData.expeditur=l),type:"text",class:"form-control"},null,512),[[u,a.formData.expeditur]])]),e("div",ht,[t[61]||(t[61]=e("label",{class:"form-label"},"Receiver Name",-1)),i(e("input",{"onUpdate:modelValue":t[22]||(t[22]=l=>a.formData.receiver_name=l),type:"text",class:"form-control"},null,512),[[u,a.formData.receiver_name]])]),e("div",Jt,[t[62]||(t[62]=e("label",{class:"form-label"},"Receive Date (Optional)",-1)),i(e("input",{"onUpdate:modelValue":t[23]||(t[23]=l=>a.formData.receive_date=l),type:"date",class:"form-control",onInput:t[24]||(t[24]=(...l)=>a.handleReceiveDateInput&&a.handleReceiveDateInput(...l))},null,544),[[u,a.formData.receive_date]])]),e("div",Kt,[t[64]||(t[64]=e("label",{class:"form-label"},"Status",-1)),i(e("select",{"onUpdate:modelValue":t[25]||(t[25]=l=>a.formData.ras_status=l),class:"form-select"},t[63]||(t[63]=[e("option",{value:""},"-- Pilih Status --",-1),e("option",{value:"Pending"},"Pending",-1),e("option",{value:"Received"},"Received",-1),e("option",{value:"Completed"},"Completed",-1)]),512),[[N,a.formData.ras_status]])]),e("div",Wt,[t[65]||(t[65]=e("label",{class:"form-label"},"Description",-1)),i(e("input",{"onUpdate:modelValue":t[26]||(t[26]=l=>a.formData.description=l),type:"text",class:"form-control"},null,512),[[u,a.formData.description]])]),e("div",Yt,[t[66]||(t[66]=e("label",{class:"form-label"},"Remarks",-1)),i(e("textarea",{"onUpdate:modelValue":t[27]||(t[27]=l=>a.formData.remarks=l),rows:"2",class:"form-control"},null,512),[[u,a.formData.remarks]])])]),e("div",Gt,[e("button",{type:"button",class:"btn btn-secondary",onClick:t[28]||(t[28]=(...l)=>a.closeModal&&a.closeModal(...l))},"Cancel"),e("button",{type:"submit",class:"btn btn-primary",disabled:a.submitting},[a.submitting?(m(),d("span",Qt)):C("",!0),g(" "+r(a.isEditing?"Update":"Create"),1)],8,Ht)])],32)])])])])):C("",!0),a.showDeleteModal?(m(),d("div",{key:1,class:"modal fade show d-block",style:{"z-index":"1060",background:"rgba(0,0,0,0.5)"},onClick:t[36]||(t[36]=l=>a.showDeleteModal=!1)},[e("div",{class:"modal-dialog modal-dialog-centered",onClick:t[35]||(t[35]=I(()=>{},["stop"]))},[e("div",Xt,[e("div",Zt,[t[67]||(t[67]=e("h5",{class:"modal-title"},"Confirm Delete",-1)),e("button",{type:"button",class:"btn-close btn-close-white",onClick:t[32]||(t[32]=l=>a.showDeleteModal=!1)})]),e("div",$t,[t[69]||(t[69]=e("p",null,"Are you sure you want to delete this transmittal?",-1)),e("p",null,[t[68]||(t[68]=e("strong",null,"TA ID:",-1)),g(" "+r(a.deleteTaId),1)]),t[70]||(t[70]=e("p",{class:"text-danger"},"This action cannot be undone!",-1))]),e("div",te,[e("button",{type:"button",class:"btn btn-secondary",onClick:t[33]||(t[33]=l=>a.showDeleteModal=!1)},"Cancel"),e("button",{type:"button",class:"btn btn-danger",onClick:t[34]||(t[34]=(...l)=>a.deleteTransmittal&&a.deleteTransmittal(...l)),disabled:a.submitting},[a.submitting?(m(),d("span",ae)):C("",!0),t[71]||(t[71]=g(" Delete "))],8,ee)])])])])):C("",!0)])}const se=$(lt,[["render",le],["__scopeId","data-v-801512df"]]);export{se as default};
