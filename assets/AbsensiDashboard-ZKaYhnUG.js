import{s as P}from"./vue-multiselect-AzznUv-C.js";import{_ as _e,u as he,r as i,A as v,o as j,c as g,n as b,a as n,h as H,t as J,q as Ce,m as W,C as G,d as F,f as Y,V as q,F as Q,j as we,s as B,x as ye,g as m,y as ke}from"./index-mqQHQ1O9.js";import{_ as Ae}from"./BigTable-CEFTvFcZ.js";import{C as X}from"./Charts-CX1yUB3x.js";import"./xlsx-Cda48wl1.js";/* empty css                            *//* empty css                                                 */const Ie={key:0,class:"container-global mb-4"},Se={class:"d-flex justify-content-between align-items-center mb-2 mt-auto"},Fe={class:"text-end"},xe={class:"row align-items-end mb-4"},De={class:"col-md-5"},Te={class:"col-md-5"},Ne={class:"col-md-2 text-end"},Ue={class:"nav nav-tabs"},Me=["onClick"],Re={key:1,class:"card mb-4"},Oe={key:2,class:"row g-4 mb-4"},$e={key:0,class:"col-md-12"},Ee={class:"card h-100"},He={key:1,class:"col-md-12"},Be={class:"card h-100"},Le={key:2,class:"col-md-12"},Ve={__name:"AbsensiDashboard",setup(ze){he();const Z=i(null),w=i(!0),x=i(null),D=i(null),R=i([]),O=i([]),$=i(),T=i({title:"Daily Average Hour Worked",type:"line",api:{url:v+"/chart/absensi_avg_hw",params:[14,new Date().toISOString().slice(0,10),"","",""]},columns:{label:["formatted_date"],datas:["avg_hour_worked"]},colors:["red"],labels:["Average Hour Worked"]}),E=i(),N=i({title:"Daily Average Hour In Out",type:"line",api:{url:v+"/chart/absensi_avg_hio",params:[14,new Date().toISOString().slice(0,10),"","",""]},columns:{label:["formatted_date"],datas:["avg_hour_in_decimal","avg_hour_out_decimal"],extras:["avg_hour_in","avg_hour_out"]},colors:["green","red"],labels:["Average Hour In","Average Hour Out"]}),ee=async()=>{const u=await B.get(`${v}/dropdowns/department`);R.value=u.data.map(o=>({label:o,value:o})),console.log(R.value);const a=await B.get(`${v}/dropdowns/name`);O.value=a.data.map(o=>({label:o,value:o})),console.log(O.value),w.value=!1},L=i();function U(){const u=new Date,a=u.getHours().toString().padStart(2,"0"),o=u.getMinutes().toString().padStart(2,"0"),p=u.getSeconds().toString().padStart(2,"0");L.value=`${a}:${o}:${p}`}j(async()=>{U(),setInterval(U,1e3),await ee(),w.value=!1});const c=i(""),le=[{label:"All",value:""},{label:"Daily Trend",value:"0"},{label:"Timesheet",value:"1"}],te=i({title:"",styleClass:"",size:[10,30,100]}),ae=i({firstCol:{label:"USERNAME",field:"username",type:"type",width:100},priority:["status","name","department","jabatan","hour_in","hour_out"],unpriority:["lastUpdated"],hidden:["tanggal","rn","created_at"],toRemove:["id"],exclude:[],uneditable:[],checkbox:["spare_exists"],date:[],datetime:[],status:{field:"status",calculate:u=>{var M,y;const a=new Date().toISOString().slice(0,10),o=(M=u.hour_in)==null?void 0:M.slice(0,10),p=(y=u.hour_out)==null?void 0:y.slice(0,10);return o!==a&&p!==a?"Tidak Hadir":u.hour_out==null?"Masuk":"Pulang"}}}),oe=i({data:`${v}/absensi-latest`,dropdowns:{vehicle_type:{url:v+"/dropdowns/vehicle_type",valueField:"vehicle_type",column:"vehicle_type"},tk_no:{url:v+"/dropdowns/tk_no",valueField:"tk_no",column:"tk_no"}},get:{vehicle_type:{url:v+"/get/vehicle_type",valueField:"vehicle_type",column:"vehicle_type"}}}),V=async(u,a)=>{let o=0;u==="dep"?(x.value=a,o=3):u==="emp"&&(D.value=a,o=2),T.value.api.params[o]=a.value,N.value.api.params[o]=a.value,await $.value.renderChart(),await E.value.renderChart(),await ye()},se=async()=>{const a=(await B.get(v+"/data/absensi_all",{params:{params:["","",""]}})).data;if(!a.length)return;const o=a.reduce((f,A)=>{const I=`${A.username} ${A.name}`;return f[I]||(f[I]=[]),f[I].push(A),f},{}),p=new ExcelJS.Workbook,M=["formatted_date","day_name","hour_start","hour_finish","break","hour_worked","ph","normal_hours","ovt","calculation_overtime_1x1_5","calculation_overtime_1x2","calculation_overtime_1x3","calculation_overtime_1x4","total"],y={break:'=IF(OR(ISBLANK(C{row}), ISBLANK(D{row})), "", IF(C{row} > D{row}, 3, IF(D{row} < 20, 1, 2)))',hour_worked:"=ROUND(IF(ISBLANK(D{row}), 0, ((INT(D{row})*60 + (D{row} - INT(D{row}))*100) - (INT(C{row})*60 + (C{row} - INT(C{row}))*100) - (INT(E{row})*60 + (E{row} - INT(E{row}))*100)) + IF(D{row} < C{row}, 1440, 0))/60, 2)",total:"=SUMPRODUCT(J{row}:M{row}, {1.5,2,3,4})"},z={normal_hours:"=IF(F{row} > 8, 8, ROUND(F{row}, 0))",ovt:"=IF(H{row} < 8, 0, ROUND(F{row},0) - 8)",calculation_overtime_1x1_5:"=IF(I{row} > 0, 1, 0)",calculation_overtime_1x2:"=IF(I{row} > 1, I{row} - 1, 0)",calculation_overtime_1x3:"=0",calculation_overtime_1x4:"=0"},K={normal_hours:"=0",ovt:"=ROUND(F{row},0)",calculation_overtime_1x1_5:"=0",calculation_overtime_1x2:"=0",calculation_overtime_1x3:"=IF(I{row} > 0, 1, 0)",calculation_overtime_1x4:"=IF(I{row} > 1, I{row} - 1, 0)"},ne=[12.22,8.33,6.72,8.78,8.89,13.89,4.22,10.11,9.56,11.11,8.78,7.33,8.22,12.56];Object.entries(o).forEach(([f,A])=>{const[I,...de]=f.split(" "),ce=de.join(" "),me=f.slice(0,31).replace(/[\[\]\*\/\\\?\:]/g,""),e=p.addWorksheet(me);e.properties.showGridLines=!1,e.pageSetup.showGridLines=!1,ne.forEach((t,s)=>e.getColumn(s+1).width=t);const _={horizontal:"center",vertical:"middle",wrapText:!0};e.getCell("A1").value="PT.TRANSKON JAYA",e.getCell("A1").font={font:"Arial",size:16,bold:1},e.getCell("A2").value="JL. MULAWARMAN NO. 21 BALIKPAPAN",e.getCell("A2").font={font:"Arial",size:11},e.getCell("A4").value="Empl.No.",e.getCell("A4").font={font:"Arial",size:12,bold:1},e.getCell("B4").value=I,e.getCell("B4").font={font:"Arial",size:12,bold:1},e.getCell("A5").value="Name",e.getCell("A5").font={font:"Arial",size:12,bold:1},e.getCell("B5").value=ce,e.getCell("B5").font={font:"Arial",size:12,bold:1},e.getCell("O1").value="TIME SHEET",e.getCell("O1").font={font:"Arial",size:15,bold:1};for(let t=8;t<=9;t++)for(let s=1;s<=14;s++){const C=e.getCell(t,s);C.font={font:"Arial",size:12,bold:1},C.alignment=_;const r={};t===8&&(r.top={style:"double"},r.bottom={style:"medium"}),t===9&&(r.bottom={style:"double"}),s===1&&(r.left={style:"double"}),s<14?r.right={style:"medium"}:r.right={style:"double"},C.border=r}e.getCell("A8").value="Date",e.getCell("B8").value="Day",e.getCell("C8").value="Start",e.getCell("D8").value="Finish",e.getCell("E8").value="Break",e.getCell("F8").value="Total Hrs Worked",e.mergeCells("F8:F9"),e.getCell("F8").border.bottom={style:"double"},e.getCell("G8").value="PH",e.getCell("H8").value="Normal Hours",e.mergeCells("H8:H9"),e.getCell("H8").border.bottom={style:"double"},e.getCell("I8").value="OVT",e.getCell("J8").value="Calculation Overtime",e.mergeCells("J8:M8"),e.getCell("J9").value="1 x 1.5",e.getCell("K9").value="1 x 2",e.getCell("L9").value="1 x 3",e.getCell("M9").value="1 x 4",e.getCell("N8").value="Total";const S=10;let l=10;A.forEach((t,s)=>{l=S+s;const C=e.getRow(l);M.forEach((r,fe)=>{const d=C.getCell(fe+1);let h=t[r];d.border={top:{style:"medium"},bottom:{style:"medium"},left:{style:"medium"},right:{style:"medium"}},s===0&&(d.border.top={style:"double"}),d.alignment={horizontal:"center",vertical:"middle"},y[r]?(d.value={formula:y[r].replace(/{row}/g,S+s)},d.numFmt='0.00;-0.00;"-"'):t.holiday===0&&z[r]?(d.value={formula:z[r].replace(/{row}/g,S+s)},d.numFmt='0.00;-0.00;"-"'):t.holiday===1&&K[r]?(d.value={formula:K[r].replace(/{row}/g,S+s)},d.numFmt='0.00;-0.00;"-"'):["hour_start","hour_finish","break","hour_worked","normal_hours"].includes(r)?(h=typeof h=="string"?parseFloat(h):h,d.value=isNaN(h)?null:h,d.numFmt='0.00;-0.00;"-"'):d.value=h,t.holiday===1&&(d.font={color:{argb:"FFFF0000"}})}),C.commit()}),e.getCell(l+1,1).value="Total",e.getCell(l+1,6).value={formula:`=SUM(F10:F${l})`},e.getCell(l+1,8).value={formula:`=SUM(H10:H${l})`},e.getCell(l+1,9).value={formula:`=SUM(I10:I${l})`},e.getCell(l+1,10).value={formula:`=SUM(J10:J${l})`},e.getCell(l+1,11).value={formula:`=SUM(K10:K${l})`},e.getCell(l+1,12).value={formula:`=SUM(L10:L${l})`},e.getCell(l+1,13).value={formula:`=SUM(M10:M${l})`},e.getCell(l+1,14).value={formula:`=SUM(N10:N${l})`};for(let t=1;t<=14;t++){const s=e.getCell(l+1,t);s.border={top:{style:"double"},bottom:{style:"double"},left:{style:"double"},right:{style:"double"}},s.alignment=_,s.numFmt='0.00;-0.00;"-"'}e.getCell(l+4,1).value="Overtime : ";const ve=[1.5,2,3,4],ge=["J","K","L","M"];for(let t=0;t<4;t++){e.getCell(l+6+t,1).value=ve[t],e.getCell(l+6+t,2).value="x",e.getCell(l+6+t,3).value={formula:`=${ge[t]}${l+1}`},e.getCell(l+6+t,4).value="=",e.getCell(l+6+t,5).value={formula:`=A${l+6+t}*C${l+6+t}`};for(let s=1;s<=5;s++)e.getCell(l+6+t,s).alignment=_}e.getCell(l+10,5).value={formula:`=SUM(E${l+6}:E${l+9})`},e.getCell(l+10,5).border={top:{style:"medium"},bottom:{style:"medium"}},e.getCell(l+10,50).alignment=_,e.getCell(l+2,12).value="Printed Date: ",e.getCell(l+3,12).value="Prepared By : ",e.getCell(l+2,14).value={formula:"=TODAY()"},e.getCell(l+2,14).numFmt="d-mmm-yy",e.getCell(l+3,14).value="System",e.getCell(l+2,14).alignment=_,e.getCell(l+3,14).alignment=_;const be=["Jumlah Hari Kerja","Sakit","Absent-Tidak Dibayar","Cuti Tahunan","Cuti Panjang","Perjalanan Dinas"],pe=[l-S+1,0,0,0,0,0];for(let t=0;t<6;t++)e.getCell(l+4+t,9).value=be[t],e.getCell(l+4+t,12).value="=",e.getCell(l+4+t,12).alignment=_,e.getCell(l+4+t,13).value=pe[t],e.getCell(l+4+t,14).value="days"});const ie=await p.xlsx.writeBuffer(),ue=new Blob([ie],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),k=document.createElement("a");k.href=URL.createObjectURL(ue),k.download="timesheets.xlsx",document.body.appendChild(k),k.click(),document.body.removeChild(k)};j(()=>{U(),setInterval(U,1e3)});const re=async()=>{x.value=null,D.value=null,T.value.api.params[2]="",T.value.api.params[3]="",N.value.api.params[2]="",N.value.api.params[3]="",await $.value.renderChart(),await E.value.renderChart()};return(u,a)=>(m(),g(Q,null,[w.value?b("",!0):(m(),g("div",Ie,[n("div",Se,[a[4]||(a[4]=n("h1",{class:"h3 fw-bold mb-0"},[n("i",{class:"bi bi-people-fill me-2"}),H(" Absensi Dashboard ")],-1)),n("div",Fe,[n("div",null,J(L.value),1)])]),n("div",xe,[n("div",De,[a[5]||(a[5]=n("label",{class:"form-label"},"Select Department",-1)),w.value?b("",!0):(m(),W(G(P),{key:0,modelValue:x.value,"onUpdate:modelValue":[a[0]||(a[0]=o=>x.value=o),a[1]||(a[1]=o=>V("dep",o))],options:R.value||[],placeholder:"Select Department",label:"label","track-by":"value",class:"multiselect no-border"},null,8,["modelValue","options"]))]),n("div",Te,[a[6]||(a[6]=n("label",{class:"form-label"},"Select Employee",-1)),w.value?b("",!0):(m(),W(G(P),{key:0,modelValue:D.value,"onUpdate:modelValue":[a[2]||(a[2]=o=>D.value=o),a[3]||(a[3]=o=>V("emp",o))],options:O.value||[],placeholder:"Select Employee",label:"label","track-by":"value",class:"multiselect no-border"},null,8,["modelValue","options"]))]),n("div",Ne,[F(q,{type:"submit",color:"danger",size:"md",block:!1,onClick:re},{default:Y(()=>a[7]||(a[7]=[H("Reset Filter")])),_:1})]),a[8]||(a[8]=Ce('<div class="row text-center mb-2 mt-4" data-v-8c03531b><div class="col" data-v-8c03531b><div class="card border-success" data-v-8c03531b><div class="card-body" data-v-8c03531b><h3 class="text-success" data-v-8c03531b>0</h3><p class="fw-bold mb-0" data-v-8c03531b>Total Karyawan Masuk Hari Ini</p></div></div></div><div class="col" data-v-8c03531b><div class="card border-danger" data-v-8c03531b><div class="card-body" data-v-8c03531b><h3 class="text-success" data-v-8c03531b>0</h3><p class="fw-bold mb-0" data-v-8c03531b>Total Karyawan Tidak Masuk Hari Ini</p></div></div></div></div>',1))]),n("ul",Ue,[(m(),g(Q,null,we(le,o=>n("li",{class:"nav-item",key:o.value},[n("button",{class:ke(["nav-link",{active:c.value===o.value}]),onClick:p=>c.value=o.value},J(o.label),11,Me)])),64))])])),c.value===""||c.value==="site-summary"?(m(),g("div",Re,[F(Ae,{ref_key:"bigTableRef",ref:Z,settings:te.value,urls:oe.value,fields:ae.value,canInsert:!1,canUpdate:!0},null,8,["settings","urls","fields"])])):b("",!0),c.value===""||["0","1","2","3"].includes(c.value)?(m(),g("div",Oe,[c.value===""||c.value==="0"?(m(),g("div",$e,[n("div",Ee,[F(X,{ref_key:"chartRef1",ref:$,settings:T.value},null,8,["settings"])])])):b("",!0),c.value===""||c.value==="0"?(m(),g("div",He,[n("div",Be,[F(X,{ref_key:"chartRef2",ref:E,settings:N.value},null,8,["settings"])])])):b("",!0),c.value===""||c.value==="1"?(m(),g("div",Le,[F(q,{onClick:se,class:"btn btn-danger"},{default:Y(()=>a[9]||(a[9]=[H(" Download Timesheet ")])),_:1})])):b("",!0)])):b("",!0)],64))}},qe=_e(Ve,[["__scopeId","data-v-8c03531b"]]);export{qe as default};
