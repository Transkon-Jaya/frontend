import{_ as M,u as C,r as b,o as E,w as x,l as O,c,g as i,a as d,F as q,j as P,m as F,b as R,t as T,C as I,y as $,v as z,p as N,s as h,A as G}from"./index-B4AtJAY5.js";import{s as U}from"./vue-multiselect-CIGMXkNR.js";const H={class:"container-global mb-4"},J={key:0},K={class:"form-grid"},Q=["value"],W=["value","onInput"],X=["value","onInput"],Y={key:5,class:"checkbox-field no-border"},Z=["checked","onChange"],ee=["onUpdate:modelValue","placeholder"],le={key:1,class:"loading-message"},te={__name:"MiniForm",props:{modelValue:{type:Object,default:()=>({})},fields:Object,urls:Object},emits:["update:modelValue"],setup(j,{emit:A}){const S=C(),r=j,_=A,o=b({...r.modelValue}),v=b({}),V=b(!1),B=async()=>{const a=Object.entries(r.urls.dropdowns).map(async([t,e])=>{try{const s=await h.get(e.url);v.value[t]=s.data.map(l=>({label:l,value:l}))}catch(s){console.error(`Failed to fetch dropdown data for ${t}:`,s)}});await Promise.all(a),V.value=!0};E(async()=>{await B()}),x(()=>r.modelValue,a=>{o.value={...a}});const m=async(a,t)=>{o.value[a]=t,_("update:modelValue",{...o.value}),r.fields.columns.forEach(async e=>{if(e.autofill&&e.autofill.triggeredBy===a)try{const s=await h.get(G+"/"+e.autofill.url,{params:[t.label]}),l=e.autofill.getValue(s.data);o.value[e.column]=l,_("update:modelValue",{...o.value})}catch(s){console.error(`Failed to autofill ${e.column}:`,s),o.value[e.column]=""}})},D=a=>{var t;return(t=r.fields.uneditable)==null?void 0:t.includes(a.column)},p=(a,t)=>{var e;return(e=r.fields[a])==null?void 0:e.includes(t.column)},L=async()=>{var a,t;try{const e={};for(const l of r.fields.columns||[]){const u=l.column;if((a=r.fields.toRemove)!=null&&a.includes(u)||(t=r.fields.exclude)!=null&&t.includes(u))continue;if(l.compute){e[u]=l.compute(o.value),typeof e[u]=="boolean"&&(e[u]=e[u]?1:0);continue}if(!(typeof l.visibleIf=="function"?l.visibleIf(o.value):!0))continue;const n=o.value[u],k=l.required??!1,w=n==null||typeof n=="string"&&n.trim()===""||Array.isArray(n)&&n.length===0&&typeof n!="boolean";if(k&&w){alert(`Field "${l.label||u}" is required.`);return}!k&&w||(Array.isArray(n)?e[u]=n.map(f=>(f==null?void 0:f.label)??f).join(","):typeof n=="object"&&"label"in n?e[u]=n.label:typeof n=="boolean"?e[u]=n?1:0:e[u]=n)}e.username=S.username,console.log("payload:",e);const s=await h.post(r.urls.data,e);window.location.reload(),console.log("Form submitted successfully:",s.data)}catch(e){console.error("Failed to submit form:",e)}},y=O(()=>r.fields.columns.filter(a=>typeof a.visibleIf=="function"?a.visibleIf(o.value):!0)),g=b(y.value);return x(y,a=>{const t=a.map(s=>s.column);g.value.filter(s=>!t.includes(s)).forEach(s=>{m(s,null)}),g.value=t},{immediate:!0}),(a,t)=>(i(),c("div",H,[V.value?(i(),c("div",J,[d("form",{onSubmit:N(L,["prevent"]),class:"mini-form"},[d("div",K,[(i(!0),c(q,null,P(y.value,(e,s)=>(i(),c("div",{key:e.column,class:"form-field"},[d("label",null,T(e.label),1),D(e)?(i(),c("input",{key:0,type:"text",class:"input bordered",value:o.value[e.column],disabled:""},null,8,Q)):p("datetime",e)?(i(),c("input",{key:1,type:"datetime-local",class:"input bordered",value:o.value[e.column]||"",onInput:l=>m(e.column,l.target.value)},null,40,W)):p("number",e)?(i(),c("input",{key:2,type:"number",class:"input bordered",value:o.value[e.column]||"",onInput:l=>m(e.column,l.target.value)},null,40,X)):p("dropdown",e)?(i(),F(I(U),{key:3,modelValue:o.value[e.column],"onUpdate:modelValue":[l=>o.value[e.column]=l,l=>m(e.column,l)],options:v.value[e.column]||[],placeholder:"Select",label:"label","track-by":"value",class:"multiselect no-border"},null,8,["modelValue","onUpdate:modelValue","options"])):p("multiselect",e)?(i(),F(I(U),{key:4,modelValue:o.value[e.column],"onUpdate:modelValue":[l=>o.value[e.column]=l,l=>m(e.column,l)],options:v.value[e.column]||[],placeholder:"Select",label:"label","track-by":"value",class:$(["multiselect no-border",{"multiselect--multiple":p("multiselect",e)}]),multiple:"true","close-on-select":!1},null,8,["modelValue","onUpdate:modelValue","options","class"])):p("checkbox",e)?(i(),c("div",Y,[d("input",{type:"checkbox",checked:o.value[e.column],onChange:l=>m(e.column,l.target.checked),class:"form-checkbox"},null,40,Z)])):R((i(),c("input",{key:6,type:"text",class:"form-input bordered","onUpdate:modelValue":l=>o.value[e.column]=l,placeholder:e.filterText||e.label},null,8,ee)),[[z,o.value[e.column]]])]))),128))]),t[0]||(t[0]=d("div",{class:"submit-container"},[d("button",{type:"submit",class:"submit-button bordered"},"Submit")],-1))],32)])):(i(),c("div",le,t[1]||(t[1]=[d("i",{class:"pi pi-spin pi-spinner",style:{"font-size":"1.5rem"}},null,-1),d("p",null,"Loading form...",-1)])))]))}},ne=M(te,[["__scopeId","data-v-dd824ff5"]]);export{ne as M};
