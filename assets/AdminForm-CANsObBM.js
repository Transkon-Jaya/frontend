import{_ as e,u as l,j as a,k as t,l as o,m as r,c as i,o as u,a as c,F as n,e as s,n as d,d as m,t as p,p as v,q as y,v as _,s as f,x as b,A as g,h,b as k}from"./index-Cp3yx03n.js";/* empty css                                                                  */import{_ as x}from"./BigTable-CBFV4vCQ.js";import{s as T}from"./xlsx-CUD6asmX.js";const A={class:"container-global mb-4"},w={key:0},I={class:"form-grid"},V=["value"],F=["value","onInput"],q=["value","onInput"],S={key:5,class:"checkbox-field no-border"},E=["checked","onChange"],C=["onUpdate:modelValue","placeholder"],U={key:1,class:"loading-message"},j=e({__name:"MiniForm",props:{modelValue:{type:Object,default:()=>({})},fields:Object,urls:Object},emits:["update:modelValue"],setup(e,{emit:h}){const k=l(),x=e,j=h,B=a({...x.modelValue}),D=a({}),R=a(!1);t((async()=>{await(async()=>{const e=Object.entries(x.urls.dropdowns).map((async([e,l])=>{try{const a=await b.get(l.url);D.value[e]=a.data.map((e=>({label:e,value:e})))}catch(a){}}));await Promise.all(e),R.value=!0})()})),o((()=>x.modelValue),(e=>{B.value={...e}}));const K=async(e,l)=>{B.value[e]=l,j("update:modelValue",{...B.value}),x.fields.columns.forEach((async a=>{if(a.autofill&&a.autofill.triggeredBy===e)try{const e=await b.get(g+"/"+a.autofill.url,{params:[l.label]}),t=a.autofill.getValue(e.data);B.value[a.column]=t,j("update:modelValue",{...B.value})}catch(t){B.value[a.column]=""}}))},O=e=>{var l;return null==(l=x.fields.uneditable)?void 0:l.includes(e.column)},N=(e,l)=>{var a;return null==(a=x.fields[e])?void 0:a.includes(l.column)},P=async()=>{var e,l;try{const a={};for(const t of x.fields.columns||[]){const o=t.column;if(null==(e=x.fields.toRemove)?void 0:e.includes(o))continue;if(null==(l=x.fields.exclude)?void 0:l.includes(o))continue;if(t.compute){a[o]=t.compute(B.value),"boolean"==typeof a[o]&&(a[o]=a[o]?1:0);continue}if(!("function"!=typeof t.visibleIf||t.visibleIf(B.value)))continue;const r=B.value[o],i=t.required??!1,u=null==r||"string"==typeof r&&""===r.trim()||Array.isArray(r)&&0===r.length&&"boolean"!=typeof r;if(i&&u)return void alert(`Field "${t.label||o}" is required.`);!i&&u||(Array.isArray(r)?a[o]=r.map((e=>(null==e?void 0:e.label)??e)).join(","):a[o]="object"==typeof r&&"label"in r?r.label:"boolean"==typeof r?r?1:0:r)}a.username=k.username;await b.post(x.urls.data,a);window.location.reload()}catch(a){}},$=r((()=>x.fields.columns.filter((e=>"function"!=typeof e.visibleIf||e.visibleIf(B.value))))),z=a($.value);return o($,(e=>{const l=e.map((e=>e.column));z.value.filter((e=>!l.includes(e))).forEach((e=>{K(e,null)})),z.value=l}),{immediate:!0}),(e,l)=>(u(),i("div",A,[R.value?(u(),i("div",w,[c("form",{onSubmit:f(P,["prevent"]),class:"mini-form"},[c("div",I,[(u(!0),i(n,null,s($.value,((e,l)=>(u(),i("div",{key:e.column,class:"form-field"},[c("label",null,p(e.label),1),O(e)?(u(),i("input",{key:0,type:"text",class:"input bordered",value:B.value[e.column],disabled:""},null,8,V)):N("datetime",e)?(u(),i("input",{key:1,type:"datetime-local",class:"input bordered",value:B.value[e.column]||"",onInput:l=>K(e.column,l.target.value)},null,40,F)):N("number",e)?(u(),i("input",{key:2,type:"number",class:"input bordered",value:B.value[e.column]||"",onInput:l=>K(e.column,l.target.value)},null,40,q)):N("dropdown",e)?(u(),d(v(T),{key:3,modelValue:B.value[e.column],"onUpdate:modelValue":[l=>B.value[e.column]=l,l=>K(e.column,l)],options:D.value[e.column]||[],placeholder:"Select",label:"label","track-by":"value",class:"multiselect no-border"},null,8,["modelValue","onUpdate:modelValue","options"])):N("multiselect",e)?(u(),d(v(T),{key:4,modelValue:B.value[e.column],"onUpdate:modelValue":[l=>B.value[e.column]=l,l=>K(e.column,l)],options:D.value[e.column]||[],placeholder:"Select",label:"label","track-by":"value",class:y(["multiselect no-border",{"multiselect--multiple":N("multiselect",e)}]),multiple:"true","close-on-select":!1},null,8,["modelValue","onUpdate:modelValue","options","class"])):N("checkbox",e)?(u(),i("div",S,[c("input",{type:"checkbox",checked:B.value[e.column],onChange:l=>K(e.column,l.target.checked),class:"form-checkbox"},null,40,E)])):m((u(),i("input",{key:6,type:"text",class:"form-input bordered","onUpdate:modelValue":l=>B.value[e.column]=l,placeholder:e.filterText||e.label},null,8,C)),[[_,B.value[e.column]]])])))),128))]),l[0]||(l[0]=c("div",{class:"submit-container"},[c("button",{type:"submit",class:"submit-button bordered"},"Submit")],-1))],32)])):(u(),i("div",U,l[1]||(l[1]=[c("i",{class:"pi pi-spin pi-spinner",style:{"font-size":"1.5rem"}},null,-1),c("p",null,"Loading form...",-1)])))]))}},[["__scopeId","data-v-dd824ff5"]]),B={class:"card"},D=e({__name:"AdminForm",setup(e){const o=l(),r=a({title:"Down Equipment",size:[5,55,100],canInsert:!0,canUpdate:!0}),n=a({data:`${g}/de_site`,params:`?username=${encodeURIComponent(o.username)}`,dropdowns:{vehicle_type:{url:g+"/dropdowns/vehicle_type",valueField:"vehicle_type",column:"vehicle_type"},tk_no:{url:g+"/dropdowns/tk_no",valueField:"tk_no",column:"tk_no"},tk_no_spare:{url:g+"/dropdowns/tk_no",valueField:"tk_no",column:"tk_no"},category:{url:g+"/dropdowns/op_svc_category",valueField:"category",column:"category"},engine_:{url:g+"/dropdowns/op_svc_category_engine",valueField:"engine_",column:"engine_"},drive_train:{url:g+"/dropdowns/op_svc_category_driveTrain",valueField:"drive_train",column:"drive_train"},chasis:{url:g+"/dropdowns/op_svc_category_chasis",valueField:"chasis",column:"chasis"},electrical_body:{url:g+"/dropdowns/op_svc_category_electricalBody",valueField:"electrical_body",column:"electrical_body"},ac_system:{url:g+"/dropdowns/op_svc_category_acSystem",valueField:"ac_system",column:"ac_system"},repair_electrical:{url:g+"/dropdowns/op_svc_category_repairElectrical",valueField:"repair_electrical",column:"repair_electrical"},defact:{url:g+"/dropdowns/op_svc_category_defact",valueField:"defact",column:"defact"},body:{url:g+"/dropdowns/op_svc_category_body",valueField:"body",column:"body"}},get:{vehicle_type:{url:g+"/get/vehicle_type",valueField:"vehicle_type",column:"vehicle_type"}}}),s=a({firstCol:{label:"TK Number",field:"tk_no",type:"type"},columns:[{column:"tk_no",label:"TK NO",filterText:"Filter TK",required:!0},{column:"vehicle_type",label:"Vehicle Type",filterText:"All Vehicle",autofill:{triggeredBy:"tk_no",url:"get/vehicle_type",getValue:e=>e[0]}},{column:"plate_no",label:"Plate Number",filterText:"All Plate No",autofill:{triggeredBy:"tk_no",url:"get/plate_no",getValue:e=>e[0]}},{column:"km",label:"Kilometer",filterText:"km",required:!0},{column:"down_since",label:"Down Since",filterText:"Down Since",required:!0},{column:"estimated_return",label:"Estimated Return"},{column:"spare_exists",label:"Unit Spare"},{column:"tk_no_spare",label:"TK NO Spare",filterText:"Filter TK",required:!0,visibleIf:e=>!0===e.spare_exists},{column:"category",label:"Category",filterText:"Category"},{column:"schedule",label:"Schedule",filterText:"Schedule",required:!0,visibleIf:e=>!1,compute:e=>Array.isArray(e.category)&&e.category.some((e=>"Schedule"===e.value))},{column:"engine_",label:"Engine",filterText:"Engine",required:!0,visibleIf:e=>Array.isArray(e.category)&&e.category.some((e=>"Engine"===e.value))},{column:"drive_train",label:"Drive Train",filterText:"Drive Train",required:!0,visibleIf:e=>Array.isArray(e.category)&&e.category.some((e=>"Drive Train"===e.value))},{column:"chasis",label:"Chasis",filterText:"Chasis",required:!0,visibleIf:e=>Array.isArray(e.category)&&e.category.some((e=>"Chasis"===e.value))},{column:"electrical_body",label:"Electrical Body",filterText:"Electrical Body",required:!0,visibleIf:e=>Array.isArray(e.category)&&e.category.some((e=>"Electrical Body"===e.value))},{column:"ac_system",label:"AC System",filterText:"AC System",required:!0,visibleIf:e=>Array.isArray(e.category)&&e.category.some((e=>"AC System"===e.value))},{column:"repair_electrical",label:"Repair Electrical",filterText:"Repair Electrical",required:!0,visibleIf:e=>Array.isArray(e.category)&&e.category.some((e=>"Repair Electrical"===e.value))},{column:"defact",label:"Defact",filterText:"Defact",required:!0,visibleIf:e=>Array.isArray(e.category)&&e.category.some((e=>"Defact"===e.value))},{column:"body",label:"Body ",filterText:"Body ",required:!0,visibleIf:e=>Array.isArray(e.category)&&e.category.some((e=>"Body"===e.value))},{column:"comment",label:"Comment",filterText:"Comment"},{column:"progress",label:"Progress",filterText:"Progress",visibleIf:e=>!1}],priority:["done","vehicle_type","plate_no"],hidden:["id","schedule"],toRemove:["customer","alt_location","username","createdAt","lastUpdated","vgtSelected"],exclude:["vehicle_type","plate_no","category"],merge:[],uneditable:["vehicle_type","plate_no"],dropdown:["tk_no","tk_no_spare"],multiselect:["category","engine_","drive_train","chasis","electrical_body","ac_system","repair_electrical","defact","body"],checkbox:["done","spare_exists","deleted"],date:[],datetime:["down_since","estimated_return"],number:["km"]}),m=a({});return t((()=>{s.value.columns.forEach((e=>{m.value[e.column]=void 0!==e.default?e.default:""})),m.value.username=o.username})),(e,l)=>(u(),i("div",null,[r.value.canInsert?(u(),d(j,{key:0,modelValue:m.value,"onUpdate:modelValue":l[0]||(l[0]=e=>m.value=e),fields:s.value,urls:n.value},null,8,["modelValue","fields","urls"])):h("",!0),c("div",B,[k(x,{settings:r.value,urls:n.value,fields:s.value,canInsert:!1,canUpdate:!0},null,8,["settings","urls","fields"])])]))}},[["__scopeId","data-v-d735b63c"]]);export{D as default};
