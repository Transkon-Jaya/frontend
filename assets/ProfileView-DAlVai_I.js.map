{"version":3,"file":"ProfileView-DAlVai_I.js","sources":["../../src/views/ProfileView.vue"],"sourcesContent":["<script setup>\r\nimport { ref, onMounted, computed, nextTick } from \"vue\";\r\nimport axios from \"axios\";\r\nimport { log, logError } from \"@/utils/logger\";\r\nimport VButton from \"@/components/Button.vue\"\r\n\r\n//global variables\r\nimport { useUserStore } from \"@/stores/user\";\r\nconst userData = useUserStore();\r\n\r\n// api\r\nconst urlProfile = userData.apiBaseUrl + \"/profile\";\r\n\r\nconst loadingString = \"Loading...\";\r\n\r\nconst user = ref({\r\n  name: loadingString,\r\n  email: loadingString,\r\n  phone: loadingString,\r\n  department: loadingString,\r\n  position: loadingString,\r\n  username: loadingString,\r\n  password: \"\",\r\n  confirmPassword: \"\",\r\n});\r\n\r\nconst formData = new FormData();\r\nconst data = ref();\r\nconst selectedFile = ref(null);\r\nconst handleFileUpload = (event) => {\r\n  selectedFile.value = event.target.files[0];  // Get the selected file\r\n};\r\nconst passwordMismatch = computed(() => user.value.password !== user.value.confirmPassword);\r\n// Fetch data when component is mounted\r\nonMounted(async () => {\r\n  console.log(\"Photo : \", userData.photo);\r\n  try {\r\n    const response = await axios.get(urlProfile, {\r\n      params: {\r\n        username: userData.username ,\r\n      },\r\n    });\r\n    data.value = response.data[0];\r\n    AssignForm();\r\n  } catch (error) {\r\n    console.error(\"Fetch error:\", error);\r\n  }\r\n});\r\n\r\nconst AssignForm = () => {\r\n  user.value.name = data.value.name;\r\n  user.value.email = data.value.email;\r\n  user.value.phone = data.value.phone;\r\n  user.value.department = data.value.department;\r\n  user.value.position = data.value.jabatan;\r\n  user.value.username = userData.username;\r\n  user.value.password = \"\";\r\n  user.value.confirmPassword = \"\";\r\n}\r\n\r\nconst resetForm = () => {\r\n  AssignForm();\r\n};\r\n\r\nconst submitForm = async () => {\r\n  if (passwordMismatch.value) {\r\n    return;\r\n  }\r\n  try {\r\n    formData.append(\"name\", user.value.name);\r\n    formData.append(\"email\", user.value.email);\r\n    formData.append(\"phone\", user.value.phone);\r\n    formData.append(\"department\", user.value.department);\r\n    formData.append(\"position\", user.value.position);\r\n    formData.append(\"username\", user.value.username);\r\n    if (user.value.password) {\r\n      formData.append(\"password\", user.value.password);\r\n    }\r\n    if (selectedFile.value) {\r\n      formData.append(\"profilePicture\", selectedFile.value);\r\n    }\r\n\r\n    const response = await axios.post(urlProfile, formData);\r\n    log(\"update profile : \", response.data);\r\n    userData.setProfile(response.data.foto);\r\n    log(\"user data : \", userData.photo);\r\n    await nextTick();\r\n    // resetForm();\r\n    window.location.reload();\r\n    alert(\"Profile updated successfully!\");\r\n  } catch (error) {\r\n    logError(\"Submit error:\", error);\r\n    alert(\"Error updating profile.\");\r\n  }\r\n};\r\n\r\n</script>\r\n\r\n<template>\r\n  <div class=\"row\">\r\n    <div class=\"col-xl-6 mx-auto\">\r\n      <div class=\"card\">\r\n        <div class=\"card-header px-4 py-3\">\r\n          <h5 class=\"mb-0\">User Settings</h5>\r\n        </div>\r\n        <div class=\"card-body p-4\">\r\n          <form\r\n            @submit.prevent=\"submitForm\"\r\n            class=\"row g-3 needs-validation\"\r\n            novalidate\r\n          >\r\n            <div class=\"col-md-12\">\r\n              <label for=\"Name\" class=\"form-label\">Name</label>\r\n              <input\r\n                v-model=\"user.name\"\r\n                type=\"text\"\r\n                class=\"form-control\"\r\n                id=\"firstName\"\r\n                disabled\r\n              />\r\n            </div>\r\n            \r\n            <div class=\"col-md-12\">\r\n              <label for=\"phone\" class=\"form-label\">E-mail</label>\r\n              <input\r\n                v-model=\"user.email\"\r\n                type=\"text\"\r\n                class=\"form-control\"\r\n                id=\"email\"\r\n              />\r\n            </div>\r\n            <div class=\"col-md-12\">\r\n              <label for=\"phone\" class=\"form-label\">Phone</label>\r\n              <input\r\n                v-model=\"user.phone\"\r\n                type=\"text\"\r\n                class=\"form-control\"\r\n                id=\"phone\"\r\n              />\r\n            </div>\r\n            <div class=\"col-md-12\">\r\n              <label for=\"department\" class=\"form-label\">Department</label>\r\n              <input\r\n                v-model=\"user.department\"\r\n                type=\"text\"\r\n                class=\"form-control\"\r\n                id=\"department\"\r\n                disabled\r\n              />\r\n            </div>\r\n            <div class=\"col-md-12\">\r\n              <label for=\"position\" class=\"form-label\">Position</label>\r\n              <input\r\n                v-model=\"user.position\"\r\n                type=\"text\"\r\n                class=\"form-control\"\r\n                id=\"position\"\r\n                disabled\r\n              />\r\n            </div>\r\n            <div class=\"col-md-12\">\r\n              <label for=\"userName\" class=\"form-label\">User Name</label>\r\n              <input\r\n                v-model=\"user.username\"\r\n                type=\"userName\"\r\n                class=\"form-control\"\r\n                id=\"userName\"\r\n                disabled\r\n              />\r\n            </div>\r\n            <div class=\"col-md-12\">\r\n              <label for=\"password\" class=\"form-label\">Password</label>\r\n              <input\r\n                v-model=\"user.password\"\r\n                type=\"password\"\r\n                class=\"form-control\"\r\n                id=\"password\"\r\n              />\r\n            </div>\r\n            <div class=\"col-md-12\">\r\n              <label for=\"confirmationPassword\" class=\"form-label\">Confirm Password</label>\r\n              <input\r\n                v-model=\"user.confirmPassword\"\r\n                type=\"password\"\r\n                class=\"form-control\"\r\n                id=\"confirmationPassword\"\r\n              />\r\n            </div>\r\n            <small v-if=\"passwordMismatch\" class=\"text-danger\">\r\n              Passwords do not match!\r\n            </small>\r\n            \r\n            <!-- Upload Foto -->\r\n            <div class=\"col-md-12\">\r\n              <label for=\"photo\" class=\"form-label\">Upload Photo</label>\r\n              <input type=\"file\" class=\"form-control\" id=\"photo\" @change=\"handleFileUpload\" accept=\"image/*\" />\r\n              <div v-if=\"previewImage\" class=\"mt-3\">\r\n                <img :src=\"previewImage\" alt=\"Preview\" class=\"img-thumbnail\" style=\"max-width: 200px;\" />\r\n              </div>\r\n            </div>\r\n\r\n             <div class=\"col-md-12 mt-4 mb-3 d-flex gap-3\">\r\n              <VButton \r\n                type=\"submit\" \r\n                class=\"btn btn-danger\"\r\n                :disabled=\"passwordMismatch\"\r\n                >Submit\r\n              </VButton>\r\n              <VButton type=\"reset\" class=\"btn btn-secondary\" @click=\"resetForm\">\r\n                Reset\r\n              </VButton>\r\n            </div>\r\n          </form>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n"],"names":["loadingString","userData","useUserStore","urlProfile","apiBaseUrl","user","ref","name","email","phone","department","position","username","password","confirmPassword","formData","FormData","data","selectedFile","handleFileUpload","event","value","target","files","passwordMismatch","computed","onMounted","async","response","axios","get","params","error","AssignForm","jabatan","resetForm","submitForm","append","post","log","setProfile","foto","photo","nextTick","window","location","reload","alert","logError"],"mappings":"4iBAaMA,EAAgB,8CALtB,MAAMC,EAAWC,IAGXC,EAAaF,EAASG,WAAa,WAInCC,EAAOC,EAAI,CACfC,KAAMP,EACNQ,MAAOR,EACPS,MAAOT,EACPU,WAAYV,EACZW,SAAUX,EACVY,SAAUZ,EACVa,SAAU,GACVC,gBAAiB,KAGbC,EAAW,IAAIC,SACfC,EAAOX,IACPY,EAAeZ,EAAI,MACnBa,EAAoBC,IACxBF,EAAaG,MAAQD,EAAME,OAAOC,MAAM,EAAC,EAErCC,EAAmBC,GAAS,IAAMpB,EAAKgB,MAAMR,WAAaR,EAAKgB,MAAMP,kBAE3EY,GAAUC,UAEJ,IACF,MAAMC,QAAiBC,EAAMC,IAAI3B,EAAY,CAC3C4B,OAAQ,CACNnB,SAAUX,EAASW,YAGlBK,EAAAI,MAAQO,EAASX,KAAK,MAE5B,OAAQe,GAER,KAGH,MAAMC,EAAa,KACZ5B,EAAAgB,MAAMd,KAAOU,EAAKI,MAAMd,KACxBF,EAAAgB,MAAMb,MAAQS,EAAKI,MAAMb,MACzBH,EAAAgB,MAAMZ,MAAQQ,EAAKI,MAAMZ,MACzBJ,EAAAgB,MAAMX,WAAaO,EAAKI,MAAMX,WAC9BL,EAAAgB,MAAMV,SAAWM,EAAKI,MAAMa,QAC5B7B,EAAAgB,MAAMT,SAAWX,EAASW,SAC/BP,EAAKgB,MAAMR,SAAW,GACtBR,EAAKgB,MAAMP,gBAAkB,EAAA,EAGzBqB,EAAY,UAIZC,EAAaT,UACjB,IAAIH,EAAiBH,MAGjB,IACFN,EAASsB,OAAO,OAAQhC,EAAKgB,MAAMd,MACnCQ,EAASsB,OAAO,QAAShC,EAAKgB,MAAMb,OACpCO,EAASsB,OAAO,QAAShC,EAAKgB,MAAMZ,OACpCM,EAASsB,OAAO,aAAchC,EAAKgB,MAAMX,YACzCK,EAASsB,OAAO,WAAYhC,EAAKgB,MAAMV,UACvCI,EAASsB,OAAO,WAAYhC,EAAKgB,MAAMT,UACnCP,EAAKgB,MAAMR,UACbE,EAASsB,OAAO,WAAYhC,EAAKgB,MAAMR,UAErCK,EAAaG,OACNN,EAAAsB,OAAO,iBAAkBnB,EAAaG,OAGjD,MAAMO,QAAiBC,EAAMS,KAAKnC,EAAYY,GAC1CwB,EAAA,oBAAqBX,EAASX,MACzBhB,EAAAuC,WAAWZ,EAASX,KAAKwB,MAC9BF,EAAA,eAAgBtC,EAASyC,aACvBC,IAENC,OAAOC,SAASC,SAChBC,MAAM,gCACP,OAAQf,GACPgB,EAAS,gBAAiBhB,GAC1Be,MAAM,0BACP"}