import{_ as Y,u as D,r as d,o as Z,s as j,D as ee,c as n,a as e,p as w,h as m,t as l,F as k,j as y,b as f,k as C,z as _,q as te,v as E,n as S,A as U,E as se,g as o}from"./index-BeYL9mDB.js";const ae={class:"card border-0 shadow-sm"},le={class:"card-header"},ne={class:"d-flex justify-content-between align-items-center"},oe=["disabled"],re={class:"card-body"},ie={key:0,class:"alert alert-danger alert-dismissible fade show"},ue={key:1,class:"text-center py-5"},de={key:2,class:"table-responsive"},ve={class:"table table-hover table-striped table-bordered mb-0"},ce={class:"table-dark"},me=["onUpdate:modelValue","placeholder"],pe={key:0},be=["colspan"],fe={class:"text-center"},ge=["onClick"],ke={class:"text-center"},ye={class:"text-center"},_e={class:"text-center"},he={class:"text-center"},xe={class:"text-center"},we={class:"text-center"},Ce={class:"d-flex flex-wrap justify-content-between align-items-center mt-3"},Se={class:"d-flex align-items-center mb-2"},Ue=["value"],$e={class:"text-muted"},Ie={"aria-label":"Page navigation"},Pe={class:"pagination pagination-sm mb-0"},Be={class:"page-item disabled"},Le={class:"page-link"},Ve={key:0,class:"modal fade show d-block",style:{background:"rgba(0,0,0,0.5)"}},je={class:"modal-dialog modal-dialog-centered"},Ee={class:"modal-content border-0 shadow"},Ae={class:"modal-title"},Ne={class:"modal-body"},Te={class:"mb-3"},qe=["disabled"],Fe={class:"mb-3"},Oe={class:"mb-3"},De=["value"],Ke={class:"mb-3"},Me=["value"],ze={class:"mb-3"},Re=["value"],Ge={class:"mb-3"},He=["value"],Je={class:"modal-footer border-top-0"},Qe={key:1,class:"modal fade show d-block",style:{background:"rgba(0,0,0,0.5)"}},We={class:"modal-dialog modal-dialog-centered"},Xe={class:"modal-content border-0 shadow"},Ye={class:"modal-body"},Ze={__name:"Impersonate",setup(et){const K=D(),M=se(),v=d([]),u=d({departments:[],placements:[],genders:["L","P"],locations:[]}),$=d(!0),h=d(null),z=d(0),B=d(!1),c=d(!1),i=d({}),R=d(-1),I=d(!1),x=d(null),b=d({username:"",name:"",department:"",placement:"",gender:"",lokasi:""}),g=d(10),p=d(1),G=[10,20,50,{value:-1,text:"All"}],A=[{text:"Username",value:"username",align:"center",sortable:!0,filterable:!0},{text:"Nama",value:"name",align:"center",sortable:!0,filterable:!0},{text:"Departemen",value:"department",align:"center",sortable:!0,filterable:!0},{text:"Jabatan",value:"jabatan",align:"center",sortable:!0,filterable:!0},{text:"Penempatan",value:"placement",align:"center",sortable:!0,filterable:!0},{text:"Gender",value:"gender",align:"center",sortable:!0,filterable:!0},{text:"Lokasi",value:"lokasi",align:"center",sortable:!0,filterable:!0}],H=async()=>{var a,t;try{$.value=!0;const s=await S.get(`${U}/users`,{headers:{Authorization:`Bearer ${K.token}`}});v.value=s.data,z.value=v.value.length,u.value.departments=[...new Set(v.value.map(r=>r.department).filter(Boolean))],u.value.placements=[...new Set(v.value.map(r=>r.placement).filter(Boolean))],u.value.locations=[...new Set(v.value.map(r=>r.lokasi).filter(Boolean))],u.value.site=[...new Set(v.value.map(r=>r.site).filter(Boolean))],$.value=!1}catch(s){h.value=((t=(a=s.response)==null?void 0:a.data)==null?void 0:t.message)||s.message,$.value=!1}};Z(async()=>{await H()});const P=j(()=>v.value.filter(a=>Object.keys(b.value).every(t=>b.value[t]?String(a[t]).toLowerCase().includes(b.value[t].toLowerCase()):!0))),L=j(()=>{if(g.value===-1)return P.value;const a=(p.value-1)*g.value,t=a+g.value;return P.value.slice(a,t)}),N=j(()=>g.value===-1?1:Math.ceil(P.value.length/g.value)),J=async()=>{var a,t;try{if(c.value){const s=await S.post(`${U}/users`,i.value,{headers:{"Content-Type":"application/json"}});v.value.unshift(s.data),T(s.data),c.value=!1}else{const s=await S.put(`${U}/users`,i.value,{headers:{"Content-Type":"application/json"}});v.value[R.value]=s.data,T(s.data),B.value=!1}i.value={}}catch(s){h.value=((t=(a=s.response)==null?void 0:a.data)==null?void 0:t.error)||s.message,console.error("CRUD Error:",s)}},T=a=>{a.department&&!u.value.departments.includes(a.department)&&u.value.departments.push(a.department),a.placement&&!u.value.placements.includes(a.placement)&&u.value.placements.push(a.placement),a.lokasi&&!u.value.locations.includes(a.lokasi)&&u.value.locations.push(a.lokasi)},Q=async()=>{var a,t;try{await S.delete(`${U}/users/${x.value.username}`),v.value=v.value.filter(s=>s.username!==x.value.username),I.value=!1,x.value=null}catch(s){h.value=((t=(a=s.response)==null?void 0:a.data)==null?void 0:t.message)||s.message,I.value=!1}},q=()=>{I.value=!1,x.value=null},F=()=>{B.value=!1,c.value=!1,i.value={}},V=D(),O=ee(),W=async a=>{try{O.originalToken||O.setToken(V.token);const t=await S.post(`${U}/sa/impersonate`,{username:a},{headers:{Authorization:`Bearer ${V.token}`}}),{token:s,payload:r}=t.data;return V.setUser({username:r.username,name:r.name,photo:r.photo,level:r.user_level,permissions:r.permissions,token:s}),M.push("/login"),!0}catch(t){return console.error("Impersonation failed:",t),!1}},X=()=>{Object.keys(b.value).forEach(a=>{b.value[a]=""}),p.value=1};return(a,t)=>(o(),n("div",ae,[e("div",le,[e("div",ne,[t[13]||(t[13]=e("h3",{class:"mb-0"},"Impersonate User",-1)),e("div",null,[e("button",{onClick:X,class:"btn btn-sm btn-light me-2",disabled:!Object.values(b.value).some(Boolean)},t[12]||(t[12]=[e("i",{class:"fas fa-filter-circle-xmark me-1"},null,-1),m(" Reset Filters ")]),8,oe)])])]),e("div",re,[h.value?(o(),n("div",ie,[m(l(h.value)+" ",1),e("button",{type:"button",class:"btn-close",onClick:t[0]||(t[0]=s=>h.value=null)})])):w("",!0),$.value?(o(),n("div",ue,t[14]||(t[14]=[e("div",{class:"spinner-border text-primary",role:"status"},[e("span",{class:"visually-hidden"},"Loading...")],-1),e("p",{class:"mt-2"},"Loading data...",-1)]))):(o(),n("div",de,[e("table",ve,[e("thead",ce,[e("tr",null,[(o(),n(k,null,y(A,s=>e("th",{key:s.value,class:_(s.align?`text-${s.align}`:"")},[e("div",null,l(s.text),1),s.filterable?f((o(),n("input",{key:0,"onUpdate:modelValue":r=>b.value[s.value]=r,type:"text",class:"form-control form-control-sm mt-1",placeholder:`Filter ${s.text}`,onInput:t[1]||(t[1]=r=>p.value=1)},null,40,me)),[[E,b.value[s.value]]]):w("",!0)],2)),64))])]),e("tbody",null,[L.value.length===0?(o(),n("tr",pe,[e("td",{colspan:A.length,class:"text-center py-4"},"No data available",8,be)])):w("",!0),(o(!0),n(k,null,y(L.value,(s,r)=>(o(),n("tr",{key:r,class:"align-middle"},[e("td",fe,[e("a",{href:"javascript:void(0)",onClick:tt=>W(s.username),class:"text-primary fw-semibold"},l(s.username),9,ge)]),e("td",ke,l(s.name),1),e("td",ye,l(s.department),1),e("td",_e,l(s.jabatan),1),e("td",he,l(s.placement),1),e("td",xe,[e("span",{class:_(["badge",s.gender==="Laki-laki"?"bg-info":"bg-danger"])},l(s.gender),3)]),e("td",we,l(s.lokasi),1)]))),128))])])])),e("div",Ce,[e("div",Se,[f(e("select",{"onUpdate:modelValue":t[2]||(t[2]=s=>g.value=s),class:"form-select form-select-sm me-2",style:{width:"90px"},onChange:t[3]||(t[3]=s=>p.value=1)},[(o(),n(k,null,y(G,s=>e("option",{key:s.value||s,value:s.value||s},l(s.text||s),9,Ue)),64))],544),[[C,g.value]]),e("small",$e," Showing "+l(L.value.length)+" of "+l(P.value.length)+" entries ",1)]),e("nav",Ie,[e("ul",Pe,[e("li",{class:_(["page-item",{disabled:p.value===1}])},[e("button",{class:"page-link",onClick:t[4]||(t[4]=s=>p.value--)},t[15]||(t[15]=[e("i",{class:"fas fa-chevron-left"},null,-1)]))],2),e("li",Be,[e("span",Le," Page "+l(p.value)+" of "+l(N.value),1)]),e("li",{class:_(["page-item",{disabled:p.value===N.value}])},[e("button",{class:"page-link",onClick:t[5]||(t[5]=s=>p.value++)},t[16]||(t[16]=[e("i",{class:"fas fa-chevron-right"},null,-1)]))],2)])])])]),B.value||c.value?(o(),n("div",Ve,[e("div",je,[e("div",Ee,[e("div",{class:_(["modal-header",(c.value,"bg-danger text-white")])},[e("h5",Ae,l(c.value?"Tambah Karyawan Baru":"Edit Karyawan"),1),e("button",{type:"button",class:_(["btn-close",(c.value,"btn-close-white")]),onClick:F},null,2)],2),e("div",Ne,[e("form",{onSubmit:te(J,["prevent"])},[e("div",Te,[t[17]||(t[17]=e("label",{class:"form-label"},[m("NIK "),e("span",{class:"text-danger"},"*")],-1)),f(e("input",{"onUpdate:modelValue":t[6]||(t[6]=s=>i.value.username=s),type:"text",class:"form-control",disabled:!c.value,required:""},null,8,qe),[[E,i.value.username]])]),e("div",Fe,[t[18]||(t[18]=e("label",{class:"form-label"},[m("Nama "),e("span",{class:"text-danger"},"*")],-1)),f(e("input",{"onUpdate:modelValue":t[7]||(t[7]=s=>i.value.name=s),type:"text",class:"form-control",required:""},null,512),[[E,i.value.name]])]),e("div",Oe,[t[19]||(t[19]=e("label",{class:"form-label"},"Departemen",-1)),f(e("select",{"onUpdate:modelValue":t[8]||(t[8]=s=>i.value.department=s),class:"form-select",required:""},[(o(!0),n(k,null,y(u.value.departments,s=>(o(),n("option",{key:s,value:s},l(s),9,De))),128))],512),[[C,i.value.department]])]),e("div",Ke,[t[20]||(t[20]=e("label",{class:"form-label"},"Penempatan",-1)),f(e("select",{"onUpdate:modelValue":t[9]||(t[9]=s=>i.value.placement=s),class:"form-select",required:""},[(o(!0),n(k,null,y(u.value.placements,s=>(o(),n("option",{key:s,value:s},l(s),9,Me))),128))],512),[[C,i.value.placement]])]),e("div",ze,[t[21]||(t[21]=e("label",{class:"form-label"},"Gender",-1)),f(e("select",{"onUpdate:modelValue":t[10]||(t[10]=s=>i.value.gender=s),class:"form-select",required:""},[(o(!0),n(k,null,y(u.value.genders,s=>(o(),n("option",{key:s,value:s},l(s==="L"?"Laki-laki":"Perempuan"),9,Re))),128))],512),[[C,i.value.gender]])]),e("div",Ge,[t[23]||(t[23]=e("label",{class:"form-label"},"Lokasi",-1)),f(e("select",{"onUpdate:modelValue":t[11]||(t[11]=s=>i.value.lokasi=s),class:"form-select"},[t[22]||(t[22]=e("option",{value:""},"Pilih Lokasi",-1)),(o(!0),n(k,null,y(u.value.locations,s=>(o(),n("option",{key:s,value:s},l(s),9,He))),128))],512),[[C,i.value.lokasi]])]),e("div",Je,[e("button",{type:"button",class:"btn btn-secondary",onClick:F},t[24]||(t[24]=[e("i",{class:"fas fa-times me-1"},null,-1),m(" Cancel ")])),e("button",{type:"submit",class:_(["btn",(c.value,"btn-danger")])},[t[25]||(t[25]=e("i",{class:"fas fa-save me-1"},null,-1)),m(" "+l(c.value?"Simpan":"Update"),1)],2)])],32)])])])])):w("",!0),I.value?(o(),n("div",Qe,[e("div",We,[e("div",Xe,[e("div",{class:"modal-header bg-danger text-white"},[t[26]||(t[26]=e("h5",{class:"modal-title"},"Konfirmasi Hapus",-1)),e("button",{type:"button",class:"btn-close btn-close-white",onClick:q})]),e("div",Ye,[t[29]||(t[29]=e("p",null,"Apakah Anda yakin ingin menghapus karyawan ini?",-1)),e("p",null,[t[27]||(t[27]=e("strong",null,"NIK:",-1)),m(" "+l(x.value.username),1)]),e("p",null,[t[28]||(t[28]=e("strong",null,"Nama:",-1)),m(" "+l(x.value.name),1)]),t[30]||(t[30]=e("p",{class:"text-danger"},"Data yang dihapus tidak dapat dikembalikan!",-1))]),e("div",{class:"modal-footer border-top-0"},[e("button",{type:"button",class:"btn btn-secondary",onClick:q},t[31]||(t[31]=[e("i",{class:"fas fa-times me-1"},null,-1),m(" Batal ")])),e("button",{type:"button",class:"btn btn-danger",onClick:Q},t[32]||(t[32]=[e("i",{class:"fas fa-trash-alt me-1"},null,-1),m(" Hapus ")]))])])])])):w("",!0)]))}},at=Y(Ze,[["__scopeId","data-v-e9a3c0b4"]]);export{at as default};
