import{r as n,o as P,J as G,c,a as d,q as V,t as S,K as u,f as R,y as i,p as _,g as l,b as U,v as C}from"./index-f4FaX8rS.js";import{V as B}from"./vue-good-table.esm-CTdsa5Kw.js";/* empty css                            */import{s as D}from"./vue-multiselect-DoJN5r7A.js";import{u as $,w as J}from"./xlsx-D1NZSDnX.js";const K={key:0},Q={key:1,class:"error"},H={class:"table-container"},X={key:0,class:"checkbox-container"},Y=["checked","onChange"],Z=["onUpdate:modelValue","onInput"],ee=["onUpdate:modelValue","onInput"],te={key:5},oe={class:"table-container"},ae={key:0,class:"checkbox-container"},le=["checked","onChange"],ne=["onUpdate:modelValue","onInput"],ce=["onUpdate:modelValue","onInput"],de={key:5},T="https://www.transkon-rent.com/api/marketing",ue="https://www.transkon-rent.com/api/customer",ie="https://www.transkon-rent.com/api/location",we={__name:"TestView",setup(se){const w=n([]),v=n([]),p=n([]),I=n([]),g=n([]),b=n([]),s=n(!0),r=n(null);n("150px");const A=n("100px"),m=n(new Map),f=n(new Map),y=["front_bumper","rear_bumper","roll_bar","rops","buggy_whip_cw_flag","body_strip_3m","foglamp_led_16_mata","rotary_lamp_led","rotary_lamp_flash_tube","lamp_comb_led","safety_cone","wheel_chock","fire_exting","radio_motorolla","gps","wheel_nut_indic","tyre_gt_265_65_r17_mt","radio_icom"],E=["isEditing","filterable","vgt_id","originalIndex"],k=["inquiry","date_rfq","date_deadline_tender","approval_presdir","date_Quotation_trja","date_send_quot","date_approved_quot","date_spk_po_customer","date_master_contract","date_po_dealer","date_send_po","date_delvery_to_customer","received_date_by_customer","date_commisioning_finish"],q=async()=>{try{const t=await _.get(ue,{headers:{Authorization:`Bearer ${userData.token}`}});console.log(typeof t.data),console.log(t.data),Array.isArray(t.data)?p.value=t.data.map(a=>a.name??""):console.error("Unexpected API response format:",t.data)}catch(t){console.error("Failed to fetch customer data:",t)}},z=async()=>{try{const t=await _.get(ie,{headers:{Authorization:`Bearer ${userData.token}`}});Array.isArray(t.data)?I.value=t.data.map(a=>a.location??""):console.error("Unexpected API response format:",t.data)}catch(t){console.error("Failed to fetch customer data:",t)}},N=async()=>{try{s.value=!0;const t=await _.get(T,{headers:{Authorization:`Bearer ${userData.token}`}});t.data.length>0&&(b.value=[{label:"ID",field:"id",width:"80px",minWidth:"100px",sortable:!0,filterable:!1,editable:!1,frozen:!0,headerClass:"custom-header"},...Object.keys(t.data[0]).filter(a=>a!=="id").map(a=>({label:a.replace(/_/g," ").toUpperCase(),field:a,sortable:!0,filterable:!0,filterOptions:{enabled:!0,placeholder:`${a}`},editable:!0,type:y.includes(a)?"checkbox":"text",width:Math.max(...t.data.map(e=>String(e[a]).length),a.length)*10+20+"px",minWidth:"80px",headerClass:"custome-header"}))]),w.value=t.data.map(a=>({...a,filterable:!0})),g.value=[...w.value],setTimeout(F,500)}catch(t){r.value="Failed to fetch data",console.error(t)}finally{s.value=!1,M()}},M=()=>{const t={};b.value.forEach(a=>{t[a.field]=y.includes(a.field)?0:""}),t.id=v.value.length+1,v.value.push(t)},h=(t,a)=>{f.value.has(t.id)?f.value.get(t.id)[a]=t[a]:f.value.set(t.id,{...t})},L=async()=>{try{console.log("button upload");const t=Array.from(f.value.values());console.log(t);for(const a of t){const e={...a};for(const o of E)delete e[o];delete e.id,console.log(e),k.forEach(o=>{e[o]!==null&&e[o]!==void 0&&!isNaN(Date.parse(e[o]))&&(e[o]=new Date(e[o]).toISOString().split("T")[0])}),Object.keys(e).forEach(o=>{e[o]===""&&(e[o]=null)}),await _.post(`${T}`,e),await N(),alert("Data uploaded Successfully"),v.value=[],f.value.clear()}}catch(t){console.error("Failed to upload: ",t),alert("Failed to upload")}},x=(t,a)=>{m.value.has(t.id)?m.value.get(t.id)[a]=t[a]:m.value.set(t.id,{...t})},O=async()=>{try{const t=Array.from(m.value.values());for(const a of t){const e={...a};for(const o of E)delete e[o];k.forEach(o=>{e[o]!==null&&e[o]!==void 0&&!isNaN(Date.parse(e[o]))&&(e[o]=new Date(e[o]).toISOString().split("T")[0])}),await _.put(`${T}`,e)}alert("Changes saved successfully!"),m.value.clear()}catch(t){console.error("Failed to save changes:",t),alert("Failed to save changes")}},W=()=>{const t=$.json_to_sheet(g.value),a=$.book_new();$.book_append_sheet(a,t,"Marketing Data"),J(a,"Filtered_Marketing_Data.xlsx")},j=t=>{g.value=t,console.log("F Len : ",g.value.length," | M Len : ",w.value.length)},F=()=>{const t=document.querySelector(".vue-good-table th:nth-child(1)");t&&(A.value=t.offsetWidth+"px"),document.documentElement.style.setProperty("--second-column-width",A.value)};return P(()=>{N(),q(),z(),window.addEventListener("resize",F)}),G(()=>{window.removeEventListener("resize",F)}),(t,a)=>(l(),c("div",null,[a[0]||(a[0]=d("h2",null,"Marketing",-1)),d("button",{onClick:L},"Upload"),d("button",{onClick:M},"Add New Row"),s.value?(l(),c("p",K,"Loading...")):V("",!0),r.value?(l(),c("p",Q,S(r.value),1)):V("",!0),d("div",H,[!s.value&&!r.value?(l(),u(i(B),{key:0,columns:b.value,rows:v.value,"pagination-options":{enabled:!1},style:{"overflow-x":"auto"}},{"table-row":R(e=>[y.includes(e.column.field)?(l(),c("div",X,[d("input",{type:"checkbox",checked:e.row[e.column.field]==1,onChange:o=>{e.row[e.column.field]=o.target.checked?1:0,h(e.row,e.column.field)}},null,40,Y)])):e.column.field==="name_customer"?(l(),u(i(D),{key:1,modelValue:e.row[e.column.field],"onUpdate:modelValue":[o=>e.row[e.column.field]=o,o=>h(e.row,e.column.field)],options:p.value||[],searchable:!0,"allow-empty":!1,placeholder:"Select customer...",noResultsText:"No matching customers found"},null,8,["modelValue","onUpdate:modelValue","options"])):e.column.field==="location"?(l(),u(i(D),{key:2,modelValue:e.row[e.column.field],"onUpdate:modelValue":[o=>e.row[e.column.field]=o,o=>h(e.row,e.column.field)],options:I.value||[],searchable:!0,"allow-empty":!1,placeholder:"Select location...",noResultsText:"No matching customers found"},null,8,["modelValue","onUpdate:modelValue","options"])):k.includes(e.column.field)?U((l(),c("input",{key:3,type:"date","onUpdate:modelValue":o=>e.row[e.column.field]=o,onInput:o=>h(e.row,e.column.field)},null,40,Z)),[[C,e.row[e.column.field]]]):e.column.editable!==!1?U((l(),c("input",{key:4,"onUpdate:modelValue":o=>e.row[e.column.field]=o,onInput:o=>h(e.row,e.column.field)},null,40,ee)),[[C,e.row[e.column.field]]]):(l(),c("span",te,S(e.row[e.column.field]),1))]),_:1},8,["columns","rows"])):V("",!0)]),d("button",{onClick:W},"Export to Excel"),d("button",{onClick:O},"Save Updates"),d("div",oe,[!s.value&&!r.value?(l(),u(i(B),{key:0,columns:b.value,rows:w.value,"pagination-options":{enabled:!0,mode:"pages",perPage:10},"search-options":{enabled:!0},"sort-options":{enabled:!0},style:{"overflow-x":"auto"},onOnFiltered:j},{"table-row":R(e=>[y.includes(e.column.field)?(l(),c("div",ae,[d("input",{type:"checkbox",checked:e.row[e.column.field]==1,onChange:o=>e.row[e.column.field]=o.target.checked?1:0},null,40,le)])):e.column.field==="name_customer"?(l(),u(i(D),{key:1,modelValue:e.row[e.column.field],"onUpdate:modelValue":[o=>e.row[e.column.field]=o,o=>x(e.row,e.column.field)],options:p.value||[],searchable:!0,"allow-empty":!1,placeholder:"Select customer...",noResultsText:"No matching customers found"},null,8,["modelValue","onUpdate:modelValue","options"])):e.column.field==="location"?(l(),u(i(D),{key:2,modelValue:e.row[e.column.field],"onUpdate:modelValue":[o=>e.row[e.column.field]=o,o=>x(e.row,e.column.field)],options:I.value||[],searchable:!0,"allow-empty":!0,placeholder:"Select location...",noResultsText:"No matching customers found"},null,8,["modelValue","onUpdate:modelValue","options"])):k.includes(e.column.field)?U((l(),c("input",{key:3,type:"date","onUpdate:modelValue":o=>e.row[e.column.field]=o,onInput:o=>x(e.row,e.column.field)},null,40,ne)),[[C,e.row[e.column.field]]]):e.column.editable!==!1?U((l(),c("input",{key:4,"onUpdate:modelValue":o=>e.row[e.column.field]=o,onInput:o=>x(e.row,e.column.field)},null,40,ce)),[[C,e.row[e.column.field]]]):(l(),c("span",de,S(e.row[e.column.field]),1))]),_:1},8,["columns","rows"])):V("",!0)])]))}};export{we as default};
