import{r as n,o as z,D as G,c,a as d,n as V,t as S,m as u,f as A,C as i,s as _,g as a,b as U,v as C}from"./index-CCav3FzQ.js";import{V as L,u as T,w as Q}from"./xlsx-BgHuD1OD.js";/* empty css                            */import{s as I}from"./vue-multiselect-ryD8xG8K.js";const H={key:0},J={key:1,class:"error"},K={class:"table-container"},X={key:0,class:"checkbox-container"},Y=["checked","onChange"],Z=["onUpdate:modelValue","onInput"],ee=["onUpdate:modelValue","onInput"],te={key:5},oe={class:"table-container"},le={key:0,class:"checkbox-container"},ae=["checked","onChange"],ne=["onUpdate:modelValue","onInput"],ce=["onUpdate:modelValue","onInput"],de={key:5},E="https://www.transkon-rent.com/api/marketing",ue="https://www.transkon-rent.com/api/customer",ie="https://www.transkon-rent.com/api/location",_e={__name:"TestView",setup(se){const w=n([]),v=n([]),D=n([]),p=n([]),g=n([]),b=n([]),s=n(!0),r=n(null);n("150px");const N=n("100px"),m=n(new Map),f=n(new Map),y=["front_bumper","rear_bumper","roll_bar","rops","buggy_whip_cw_flag","body_strip_3m","foglamp_led_16_mata","rotary_lamp_led","rotary_lamp_flash_tube","lamp_comb_led","safety_cone","wheel_chock","fire_exting","radio_motorolla","gps","wheel_nut_indic","tyre_gt_265_65_r17_mt","radio_icom"],$=["isEditing","filterable","vgt_id","originalIndex"],k=["inquiry","date_rfq","date_deadline_tender","approval_presdir","date_Quotation_trja","date_send_quot","date_approved_quot","date_spk_po_customer","date_master_contract","date_po_dealer","date_send_po","date_delvery_to_customer","received_date_by_customer","date_commisioning_finish"],O=async()=>{try{const t=await _.get(ue);console.log(typeof t.data),console.log(t.data),Array.isArray(t.data)?D.value=t.data.map(l=>l.name??""):console.error("Unexpected API response format:",t.data)}catch(t){console.error("Failed to fetch customer data:",t)}},q=async()=>{try{const t=await _.get(ie);Array.isArray(t.data)?p.value=t.data.map(l=>l.location??""):console.error("Unexpected API response format:",t.data)}catch(t){console.error("Failed to fetch customer data:",t)}},M=async()=>{try{s.value=!0;const t=await _.get(E);t.data.length>0&&(b.value=[{label:"ID",field:"id",width:"80px",minWidth:"100px",sortable:!0,filterable:!1,editable:!1,frozen:!0,headerClass:"custom-header"},...Object.keys(t.data[0]).filter(l=>l!=="id").map(l=>({label:l.replace(/_/g," ").toUpperCase(),field:l,sortable:!0,filterable:!0,filterOptions:{enabled:!0,placeholder:`${l}`},editable:!0,type:y.includes(l)?"checkbox":"text",width:Math.max(...t.data.map(e=>String(e[l]).length),l.length)*10+20+"px",minWidth:"80px",headerClass:"custome-header"}))]),w.value=t.data.map(l=>({...l,filterable:!0})),g.value=[...w.value],setTimeout(F,500)}catch(t){r.value="Failed to fetch data",console.error(t)}finally{s.value=!1,R()}},R=()=>{const t={};b.value.forEach(l=>{t[l.field]=y.includes(l.field)?0:""}),t.id=v.value.length+1,v.value.push(t)},h=(t,l)=>{f.value.has(t.id)?f.value.get(t.id)[l]=t[l]:f.value.set(t.id,{...t})},B=async()=>{try{console.log("button upload");const t=Array.from(f.value.values());console.log(t);for(const l of t){const e={...l};for(const o of $)delete e[o];delete e.id,console.log(e),k.forEach(o=>{e[o]!==null&&e[o]!==void 0&&!isNaN(Date.parse(e[o]))&&(e[o]=new Date(e[o]).toISOString().split("T")[0])}),Object.keys(e).forEach(o=>{e[o]===""&&(e[o]=null)}),await _.post(`${E}`,e),await M(),alert("Data uploaded Successfully"),v.value=[],f.value.clear()}}catch(t){console.error("Failed to upload: ",t),alert("Failed to upload")}},x=(t,l)=>{m.value.has(t.id)?m.value.get(t.id)[l]=t[l]:m.value.set(t.id,{...t})},W=async()=>{try{const t=Array.from(m.value.values());for(const l of t){const e={...l};for(const o of $)delete e[o];k.forEach(o=>{e[o]!==null&&e[o]!==void 0&&!isNaN(Date.parse(e[o]))&&(e[o]=new Date(e[o]).toISOString().split("T")[0])}),await _.put(`${E}`,e)}alert("Changes saved successfully!"),m.value.clear()}catch(t){console.error("Failed to save changes:",t),alert("Failed to save changes")}},j=()=>{const t=T.json_to_sheet(g.value),l=T.book_new();T.book_append_sheet(l,t,"Marketing Data"),Q(l,"Filtered_Marketing_Data.xlsx")},P=t=>{g.value=t,console.log("F Len : ",g.value.length," | M Len : ",w.value.length)},F=()=>{const t=document.querySelector(".vue-good-table th:nth-child(1)");t&&(N.value=t.offsetWidth+"px"),document.documentElement.style.setProperty("--second-column-width",N.value)};return z(()=>{M(),O(),q(),window.addEventListener("resize",F)}),G(()=>{window.removeEventListener("resize",F)}),(t,l)=>(a(),c("div",null,[l[0]||(l[0]=d("h2",null,"Marketing",-1)),d("button",{onClick:B},"Upload"),d("button",{onClick:R},"Add New Row"),s.value?(a(),c("p",H,"Loading...")):V("",!0),r.value?(a(),c("p",J,S(r.value),1)):V("",!0),d("div",K,[!s.value&&!r.value?(a(),u(i(L),{key:0,columns:b.value,rows:v.value,"pagination-options":{enabled:!1},style:{"overflow-x":"auto"}},{"table-row":A(e=>[y.includes(e.column.field)?(a(),c("div",X,[d("input",{type:"checkbox",checked:e.row[e.column.field]==1,onChange:o=>{e.row[e.column.field]=o.target.checked?1:0,h(e.row,e.column.field)}},null,40,Y)])):e.column.field==="name_customer"?(a(),u(i(I),{key:1,modelValue:e.row[e.column.field],"onUpdate:modelValue":[o=>e.row[e.column.field]=o,o=>h(e.row,e.column.field)],options:D.value||[],searchable:!0,"allow-empty":!1,placeholder:"Select customer...",noResultsText:"No matching customers found"},null,8,["modelValue","onUpdate:modelValue","options"])):e.column.field==="location"?(a(),u(i(I),{key:2,modelValue:e.row[e.column.field],"onUpdate:modelValue":[o=>e.row[e.column.field]=o,o=>h(e.row,e.column.field)],options:p.value||[],searchable:!0,"allow-empty":!1,placeholder:"Select location...",noResultsText:"No matching customers found"},null,8,["modelValue","onUpdate:modelValue","options"])):k.includes(e.column.field)?U((a(),c("input",{key:3,type:"date","onUpdate:modelValue":o=>e.row[e.column.field]=o,onInput:o=>h(e.row,e.column.field)},null,40,Z)),[[C,e.row[e.column.field]]]):e.column.editable!==!1?U((a(),c("input",{key:4,"onUpdate:modelValue":o=>e.row[e.column.field]=o,onInput:o=>h(e.row,e.column.field)},null,40,ee)),[[C,e.row[e.column.field]]]):(a(),c("span",te,S(e.row[e.column.field]),1))]),_:1},8,["columns","rows"])):V("",!0)]),d("button",{onClick:j},"Export to Excel"),d("button",{onClick:W},"Save Updates"),d("div",oe,[!s.value&&!r.value?(a(),u(i(L),{key:0,columns:b.value,rows:w.value,"pagination-options":{enabled:!0,mode:"pages",perPage:10},"search-options":{enabled:!0},"sort-options":{enabled:!0},style:{"overflow-x":"auto"},onOnFiltered:P},{"table-row":A(e=>[y.includes(e.column.field)?(a(),c("div",le,[d("input",{type:"checkbox",checked:e.row[e.column.field]==1,onChange:o=>e.row[e.column.field]=o.target.checked?1:0},null,40,ae)])):e.column.field==="name_customer"?(a(),u(i(I),{key:1,modelValue:e.row[e.column.field],"onUpdate:modelValue":[o=>e.row[e.column.field]=o,o=>x(e.row,e.column.field)],options:D.value||[],searchable:!0,"allow-empty":!1,placeholder:"Select customer...",noResultsText:"No matching customers found"},null,8,["modelValue","onUpdate:modelValue","options"])):e.column.field==="location"?(a(),u(i(I),{key:2,modelValue:e.row[e.column.field],"onUpdate:modelValue":[o=>e.row[e.column.field]=o,o=>x(e.row,e.column.field)],options:p.value||[],searchable:!0,"allow-empty":!0,placeholder:"Select location...",noResultsText:"No matching customers found"},null,8,["modelValue","onUpdate:modelValue","options"])):k.includes(e.column.field)?U((a(),c("input",{key:3,type:"date","onUpdate:modelValue":o=>e.row[e.column.field]=o,onInput:o=>x(e.row,e.column.field)},null,40,ne)),[[C,e.row[e.column.field]]]):e.column.editable!==!1?U((a(),c("input",{key:4,"onUpdate:modelValue":o=>e.row[e.column.field]=o,onInput:o=>x(e.row,e.column.field)},null,40,ce)),[[C,e.row[e.column.field]]]):(a(),c("span",de,S(e.row[e.column.field]),1))]),_:1},8,["columns","rows"])):V("",!0)])]))}};export{_e as default};
