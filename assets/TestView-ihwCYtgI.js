import{r as d,o as Q,j as J,c as s,a as u,k as U,t as N,l as f,f as L,m as _,i as y,g as n,b as C,v as D}from"./index-B65e6T1W.js";import{V as P,u as E,w as K}from"./xlsx-CTUxu1aH.js";import{s as F}from"./vue-multiselect-CfhHZvMX.js";function R(r,i){const l=S();return R=function(c,m){return c=c-240,l[c]},R(r,i)}(function(r,i){const l=R,c=r();for(;;)try{if(-parseInt(l(252))/1*(parseInt(l(261))/2)+-parseInt(l(254))/3+parseInt(l(256))/4*(parseInt(l(243))/5)+parseInt(l(242))/6*(-parseInt(l(247))/7)+-parseInt(l(249))/8+-parseInt(l(257))/9+-parseInt(l(240))/10*(-parseInt(l(245))/11)===i)break;c.push(c.shift())}catch{c.push(c.shift())}})(S,542548);function S(){const r=["text","45019iIuAKP","json","2963052PWguZw","headers","463172mQXsLm","8798814necYgS","stringify","body","get","2DeDjON","350fckMiz","Content-Type","516WwySCd","40FyPwqC","success","740157LORzJb","message","2982HGaCOD","application/json","5534848UfHuFt","content-type"];return S=function(){return r},S()}const X={key:0},Y={key:1,class:"error"},Z={class:"table-container"},ee={key:0,class:"checkbox-container"},te=["checked","onChange"],oe=["onUpdate:modelValue","onInput"],ae=["onUpdate:modelValue","onInput"],le={key:5},ne={class:"table-container"},ce={key:0,class:"checkbox-container"},de=["checked","onChange"],se=["onUpdate:modelValue","onInput"],ue=["onUpdate:modelValue","onInput"],ie={key:5},M="https://www.transkon-rent.com/api/marketing",re="https://www.transkon-rent.com/api/customer",me="https://www.transkon-rent.com/api/location",we={__name:"TestView",setup(r){const i=d([]),l=d([]),c=d([]),m=d([]),h=d([]),k=d([]),w=d(!0),v=d(null);d("150px");const $=d("100px"),x=d(new Map),g=d(new Map),p=["front_bumper","rear_bumper","roll_bar","rops","buggy_whip_cw_flag","body_strip_3m","foglamp_led_16_mata","rotary_lamp_led","rotary_lamp_flash_tube","lamp_comb_led","safety_cone","wheel_chock","fire_exting","radio_motorolla","gps","wheel_nut_indic","tyre_gt_265_65_r17_mt","radio_icom"],A=["isEditing","filterable","vgt_id","originalIndex"],I=["inquiry","date_rfq","date_deadline_tender","approval_presdir","date_Quotation_trja","date_send_quot","date_approved_quot","date_spk_po_customer","date_master_contract","date_po_dealer","date_send_po","date_delvery_to_customer","received_date_by_customer","date_commisioning_finish"],W=async()=>{try{const t=await y.get(re);console.log(typeof t.data),console.log(t.data),Array.isArray(t.data)?c.value=t.data.map(a=>a.name??""):console.error("Unexpected API response format:",t.data)}catch(t){console.error("Failed to fetch customer data:",t)}},q=async()=>{try{const t=await y.get(me);Array.isArray(t.data)?m.value=t.data.map(a=>a.location??""):console.error("Unexpected API response format:",t.data)}catch(t){console.error("Failed to fetch customer data:",t)}},O=async()=>{try{w.value=!0;const t=await y.get(M);t.data.length>0&&(k.value=[{label:"ID",field:"id",width:"80px",minWidth:"100px",sortable:!0,filterable:!1,editable:!1,frozen:!0,headerClass:"custom-header"},...Object.keys(t.data[0]).filter(a=>a!=="id").map(a=>({label:a.replace(/_/g," ").toUpperCase(),field:a,sortable:!0,filterable:!0,filterOptions:{enabled:!0,placeholder:`${a}`},editable:!0,type:p.includes(a)?"checkbox":"text",width:Math.max(...t.data.map(e=>String(e[a]).length),a.length)*10+20+"px",minWidth:"80px",headerClass:"custome-header"}))]),i.value=t.data.map(a=>({...a,filterable:!0})),h.value=[...i.value],setTimeout(T,500)}catch(t){v.value="Failed to fetch data",console.error(t)}finally{w.value=!1,j()}},j=()=>{const t={};k.value.forEach(a=>{t[a.field]=p.includes(a.field)?0:""}),t.id=l.value.length+1,l.value.push(t)},b=(t,a)=>{g.value.has(t.id)?g.value.get(t.id)[a]=t[a]:g.value.set(t.id,{...t})},z=async()=>{try{console.log("button upload");const t=Array.from(g.value.values());console.log(t);for(const a of t){const e={...a};for(const o of A)delete e[o];delete e.id,console.log(e),I.forEach(o=>{e[o]!==null&&e[o]!==void 0&&!isNaN(Date.parse(e[o]))&&(e[o]=new Date(e[o]).toISOString().split("T")[0])}),Object.keys(e).forEach(o=>{e[o]===""&&(e[o]=null)}),await y.post(`${M}`,e),await O(),alert("Data uploaded Successfully"),l.value=[],g.value.clear()}}catch(t){console.error("Failed to upload: ",t),alert("Failed to upload")}},V=(t,a)=>{x.value.has(t.id)?x.value.get(t.id)[a]=t[a]:x.value.set(t.id,{...t})},B=async()=>{try{const t=Array.from(x.value.values());for(const a of t){const e={...a};for(const o of A)delete e[o];I.forEach(o=>{e[o]!==null&&e[o]!==void 0&&!isNaN(Date.parse(e[o]))&&(e[o]=new Date(e[o]).toISOString().split("T")[0])}),await y.put(`${M}`,e)}alert("Changes saved successfully!"),x.value.clear()}catch(t){console.error("Failed to save changes:",t),alert("Failed to save changes")}},G=()=>{const t=E.json_to_sheet(h.value),a=E.book_new();E.book_append_sheet(a,t,"Marketing Data"),K(a,"Filtered_Marketing_Data.xlsx")},H=t=>{h.value=t,console.log("F Len : ",h.value.length," | M Len : ",i.value.length)},T=()=>{const t=document.querySelector(".vue-good-table th:nth-child(1)");t&&($.value=t.offsetWidth+"px"),document.documentElement.style.setProperty("--second-column-width",$.value)};return Q(()=>{O(),W(),q(),window.addEventListener("resize",T)}),J(()=>{window.removeEventListener("resize",T)}),(t,a)=>(n(),s("div",null,[a[0]||(a[0]=u("h2",null,"Marketing",-1)),u("button",{onClick:z},"Upload"),u("button",{onClick:j},"Add New Row"),w.value?(n(),s("p",X,"Loading...")):U("",!0),v.value?(n(),s("p",Y,N(v.value),1)):U("",!0),u("div",Z,[!w.value&&!v.value?(n(),f(_(P),{key:0,columns:k.value,rows:l.value,"pagination-options":{enabled:!1},style:{"overflow-x":"auto"}},{"table-row":L(e=>[p.includes(e.column.field)?(n(),s("div",ee,[u("input",{type:"checkbox",checked:e.row[e.column.field]==1,onChange:o=>{e.row[e.column.field]=o.target.checked?1:0,b(e.row,e.column.field)}},null,40,te)])):e.column.field==="name_customer"?(n(),f(_(F),{key:1,modelValue:e.row[e.column.field],"onUpdate:modelValue":[o=>e.row[e.column.field]=o,o=>b(e.row,e.column.field)],options:c.value||[],searchable:!0,"allow-empty":!1,placeholder:"Select customer...",noResultsText:"No matching customers found"},null,8,["modelValue","onUpdate:modelValue","options"])):e.column.field==="location"?(n(),f(_(F),{key:2,modelValue:e.row[e.column.field],"onUpdate:modelValue":[o=>e.row[e.column.field]=o,o=>b(e.row,e.column.field)],options:m.value||[],searchable:!0,"allow-empty":!1,placeholder:"Select location...",noResultsText:"No matching customers found"},null,8,["modelValue","onUpdate:modelValue","options"])):I.includes(e.column.field)?C((n(),s("input",{key:3,type:"date","onUpdate:modelValue":o=>e.row[e.column.field]=o,onInput:o=>b(e.row,e.column.field)},null,40,oe)),[[D,e.row[e.column.field]]]):e.column.editable!==!1?C((n(),s("input",{key:4,"onUpdate:modelValue":o=>e.row[e.column.field]=o,onInput:o=>b(e.row,e.column.field)},null,40,ae)),[[D,e.row[e.column.field]]]):(n(),s("span",le,N(e.row[e.column.field]),1))]),_:1},8,["columns","rows"])):U("",!0)]),u("button",{onClick:G},"Export to Excel"),u("button",{onClick:B},"Save Updates"),u("div",ne,[!w.value&&!v.value?(n(),f(_(P),{key:0,columns:k.value,rows:i.value,"pagination-options":{enabled:!0,mode:"pages",perPage:10},"search-options":{enabled:!0},"sort-options":{enabled:!0},style:{"overflow-x":"auto"},onOnFiltered:H},{"table-row":L(e=>[p.includes(e.column.field)?(n(),s("div",ce,[u("input",{type:"checkbox",checked:e.row[e.column.field]==1,onChange:o=>e.row[e.column.field]=o.target.checked?1:0},null,40,de)])):e.column.field==="name_customer"?(n(),f(_(F),{key:1,modelValue:e.row[e.column.field],"onUpdate:modelValue":[o=>e.row[e.column.field]=o,o=>V(e.row,e.column.field)],options:c.value||[],searchable:!0,"allow-empty":!1,placeholder:"Select customer...",noResultsText:"No matching customers found"},null,8,["modelValue","onUpdate:modelValue","options"])):e.column.field==="location"?(n(),f(_(F),{key:2,modelValue:e.row[e.column.field],"onUpdate:modelValue":[o=>e.row[e.column.field]=o,o=>V(e.row,e.column.field)],options:m.value||[],searchable:!0,"allow-empty":!0,placeholder:"Select location...",noResultsText:"No matching customers found"},null,8,["modelValue","onUpdate:modelValue","options"])):I.includes(e.column.field)?C((n(),s("input",{key:3,type:"date","onUpdate:modelValue":o=>e.row[e.column.field]=o,onInput:o=>V(e.row,e.column.field)},null,40,se)),[[D,e.row[e.column.field]]]):e.column.editable!==!1?C((n(),s("input",{key:4,"onUpdate:modelValue":o=>e.row[e.column.field]=o,onInput:o=>V(e.row,e.column.field)},null,40,ue)),[[D,e.row[e.column.field]]]):(n(),s("span",ie,N(e.row[e.column.field]),1))]),_:1},8,["columns","rows"])):U("",!0)])]))}};export{we as default};
//# sourceMappingURL=TestView-ihwCYtgI.js.map
