import{_ as H,u as K,C as O,D as W,r as v,o as Q,c as o,a as e,s as X,b as Y,v as Z,d as w,t as c,f as j,T as ee,q as x,V as P,F as C,j as B,p as E,A as L,g as i,z,y as ae,h as R}from"./index-DFdw_Vgd.js";import{l as A}from"./logger-DsocdAuK.js";const se={class:"row"},ne={class:"col-xl-8 mx-auto"},te={class:"card mb-4"},re={class:"card-body p-4"},le={class:"col-md-12"},oe={class:"col-md-12"},ie=["onClick"],de={class:"col-md-12"},ue={key:0,class:"mt-3 d-flex align-items-center"},ce=["src"],pe={class:"col-md-12 mt-4 d-flex gap-3"},ge={key:0,class:"spinner-border spinner-border-sm me-2",role:"status"},me={class:"card"},ve={class:"card-body p-4"},be={key:0,class:"text-center py-4"},fe={key:1,class:"text-center py-4"},he={key:2,class:"table-responsive"},ke={class:"table table-hover"},ye={__name:"FormIzin",setup(we){const p=K(),M=O(),l=W({keterangan:"",jenis:"",jenisLabel:""}),b=v([]),g=v(null),m=v(null),d=v(!1),f=v(!1),_=[{value:"datang telat",label:"Datang terlambat"},{value:"pulang cepat",label:"Pulang cepat"},{value:"izin",label:"Izin Tidak Masuk"},{value:"cuti",label:"Cuti"},{value:"dinas",label:"Perjalanan Dinas"}],T=t=>new Promise(a=>{const s=new FileReader;s.onload=n=>{const r=new Image;r.onload=()=>{const u=document.createElement("canvas"),G=u.getContext("2d");u.width=600,u.height=800;const y=r.width/r.height;let h,k;y>600/800?(k=800,h=800*y):(h=600,k=600/y);const N=(600-h)/2,$=(800-k)/2;G.drawImage(r,N,$,h,k),u.toBlob(J=>{a(new File([J],t.name,{type:"image/jpeg",lastModified:Date.now()}))},"image/jpeg",.9)},r.src=n.target.result},s.readAsDataURL(t)}),S=t=>{const a=t.target.files[0];if(!a){g.value=null,m.value=null;return}const s=["jpg","jpeg","png","gif"],n=a.name.split(".").pop().toLowerCase();if(!s.includes(n)){alert("Hanya file gambar (JPG, JPEG, PNG, GIF) yang diperbolehkan"),t.target.value="";return}if(a.size>5*1024*1024){alert("Ukuran file maksimal 5MB"),t.target.value="";return}g.value=a;const r=new FileReader;r.onload=u=>{m.value=u.target.result},r.readAsDataURL(a)},F=()=>{g.value=null,m.value=null;const t=document.getElementById("foto");t&&(t.value="")},I=async()=>{try{console.log("Fetching perizinan for:",p.username),d.value=!0;const t=await E.get(`${L}/perizinan`,{headers:{Authorization:`Bearer ${p.token}`},params:{username:p.username}});console.log("Response:",t.data),b.value=t.data}catch(t){console.error("Fetch error:",t),A("Fetch error:",t),alert("Gagal mengambil data perizinan")}finally{d.value=!1}},D=()=>{l.keterangan="",l.jenis="",l.jenisLabel="",F()},U=async()=>{var t,a,s;try{if(!((t=l.keterangan)!=null&&t.trim()))throw new Error("Keterangan tidak boleh kosong");if(!l.jenis)throw new Error("Pilih jenis perizinan");const n=new FormData;if(n.append("username",p.username),n.append("keterangan",l.keterangan),n.append("izin",l.jenis),g.value){const u=await T(g.value);n.append("picture",u)}d.value=!0;const r=await E.post(`${L}/perizinan`,n,{headers:{Authorization:`Bearer ${p.token}`,"Content-Type":"multipart/form-data"},timeout:1e4});if(!r.data||r.data.status!==200)throw new Error(((a=r.data)==null?void 0:a.error)||"Response tidak valid dari server");alert("Pengajuan berhasil!"),D(),I()}catch(n){let r="Gagal mengajukan perizinan";n.response?(r=((s=n.response.data)==null?void 0:s.error)||n.response.statusText,console.error("Server error:",n.response.data)):n.request?(r="Tidak ada respon dari server",console.error("No response:",n.request)):(r=n.message,console.error("Request error:",n.message)),A("Submit error:",n),alert(`Error: ${r}`)}finally{d.value=!1}},V=()=>{f.value=!f.value},q=t=>{l.jenis=t.value,l.jenisLabel=t.label,f.value=!1};return Q(()=>{I()}),(t,a)=>(i(),o("div",se,[e("div",ne,[e("div",te,[a[6]||(a[6]=e("div",{class:"card-header px-4 py-3"},[e("h5",{class:"mb-0"},"Ajukan Perizinan")],-1)),e("div",re,[e("form",{onSubmit:X(U,["prevent"]),class:"row g-3"},[e("div",le,[a[1]||(a[1]=e("label",{for:"keterangan",class:"form-label"},"Keterangan",-1)),Y(e("textarea",{"onUpdate:modelValue":a[0]||(a[0]=s=>l.keterangan=s),class:"form-control",id:"keterangan",rows:"3",placeholder:"Masukkan keterangan perizinan",required:""},null,512),[[Z,l.keterangan]])]),e("div",oe,[a[3]||(a[3]=e("label",{class:"form-label"},"Jenis Izin",-1)),e("div",{class:"dropdown-selected d-flex justify-content-between align-items-center px-3 py-2 border rounded",onClick:V},[e("span",null,c(l.jenisLabel||"Pilih jenis izin"),1),a[2]||(a[2]=e("i",{class:"bi bi-chevron-down"},null,-1))]),w(ee,{name:"slide-fade"},{default:j(()=>[f.value?(i(),o("div",{key:0,class:z(["dropdown-options border rounded mt-1",ae(M).darkMode?"bg-dark text-white border-secondary":"bg-white text-dark border-secondary"])},[(i(),o(C,null,B(_,s=>e("div",{key:s.value,class:"dropdown-option px-3 py-2",onClick:n=>q(s)},c(s.label),9,ie)),64))],2)):x("",!0)]),_:1})]),e("div",de,[a[4]||(a[4]=e("label",{for:"foto",class:"form-label"},"Upload Foto Bukti",-1)),e("input",{type:"file",class:"form-control",id:"foto",onChange:S,accept:"image/jpeg, image/png, image/jpg",required:""},null,32),m.value?(i(),o("div",ue,[e("img",{src:m.value,alt:"Preview Foto Bukti",class:"img-thumbnail",style:{"max-width":"200px","max-height":"200px"}},null,8,ce),e("button",{type:"button",class:"btn btn-sm btn-outline-danger ms-2",onClick:F}," Hapus ")])):x("",!0)]),e("div",pe,[w(P,{type:"submit",color:"primary",size:"md",disabled:d.value},{default:j(()=>[d.value?(i(),o("span",ge)):x("",!0),R(" "+c(d.value?"Mengirim...":"Ajukan Perizinan"),1)]),_:1},8,["disabled"]),w(P,{type:"button",color:"secondary",size:"md",onClick:D},{default:j(()=>a[5]||(a[5]=[R(" Reset ")])),_:1})])],32)])]),e("div",me,[a[10]||(a[10]=e("div",{class:"card-header px-4 py-3"},[e("h5",{class:"mb-0"},"Riwayat Perizinan")],-1)),e("div",ve,[d.value&&!b.value.length?(i(),o("div",be,a[7]||(a[7]=[e("div",{class:"spinner-border text-primary",role:"status"},[e("span",{class:"visually-hidden"},"Loading...")],-1)]))):b.value.length?(i(),o("div",he,[e("table",ke,[a[9]||(a[9]=e("thead",null,[e("tr",null,[e("th",null,"Tanggal"),e("th",null,"Jenis Izin"),e("th",null,"Keterangan"),e("th",null,"Status"),e("th",null,"Feedback")])],-1)),e("tbody",null,[(i(!0),o(C,null,B(b.value,s=>{var n;return i(),o("tr",{key:s.id},[e("td",null,c(new Date(s.createdAt).toLocaleDateString()),1),e("td",null,[e("span",{class:z(["badge",{"bg-info":s.jenis==="datang telat","bg-warning":s.jenis==="pulang cepat","bg-danger":s.jenis==="izin","bg-primary":s.jenis==="cuti","bg-success":s.jenis==="dinas"}])},c(((n=_.find(r=>r.value===s.jenis))==null?void 0:n.label)||s.jenis),3)]),e("td",null,c(s.keterangan),1),e("td",null,[e("span",{class:z(["badge",{"bg-secondary":s.status==="pending","bg-success":s.status==="approved","bg-danger":s.status==="rejected"}])},c(s.status),3)]),e("td",null,c(s.feedback||"-"),1)])}),128))])])])):(i(),o("div",fe,a[8]||(a[8]=[e("p",{class:"text-muted"},"Belum ada data perizinan",-1)])))])])])]))}},ze=H(ye,[["__scopeId","data-v-14953c47"]]);export{ze as default};
