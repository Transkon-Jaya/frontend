import{r as e,o as l,G as o,c as a,a as t,m as n,t as d,E as u,f as c,z as i,q as r,g as s,b as m,v as p}from"./index-C57kw19F.js";import{V as f,u as w,w as h}from"./xlsx-Bzg_cIzL.js";import{s as _}from"./vue-multiselect-C1ZQBWzF.js";const v={key:0},y={key:1,class:"error"},b={class:"table-container"},g={key:0,class:"checkbox-container"},k=["checked","onChange"],x=["onUpdate:modelValue","onInput"],V=["onUpdate:modelValue","onInput"],U={key:5},C={class:"table-container"},I={key:0,class:"checkbox-container"},S=["checked","onChange"],E=["onUpdate:modelValue","onInput"],D=["onUpdate:modelValue","onInput"],N={key:5},T="https://www.transkon-rent.com/api/marketing",j={__name:"TestView",setup(j){const A=e([]),q=e([]),M=e([]),O=e([]),F=e([]),R=e([]),z=e(!0),L=e(null);e("150px");const W=e("100px"),$=e(new Map),P=e(new Map),G=["front_bumper","rear_bumper","roll_bar","rops","buggy_whip_cw_flag","body_strip_3m","foglamp_led_16_mata","rotary_lamp_led","rotary_lamp_flash_tube","lamp_comb_led","safety_cone","wheel_chock","fire_exting","radio_motorolla","gps","wheel_nut_indic","tyre_gt_265_65_r17_mt","radio_icom"],Q=["isEditing","filterable","vgt_id","originalIndex"],B=["inquiry","date_rfq","date_deadline_tender","approval_presdir","date_Quotation_trja","date_send_quot","date_approved_quot","date_spk_po_customer","date_master_contract","date_po_dealer","date_send_po","date_delvery_to_customer","received_date_by_customer","date_commisioning_finish"],H=async()=>{try{z.value=!0;const e=await r.get(T);e.data.length>0&&(R.value=[{label:"ID",field:"id",width:"80px",minWidth:"100px",sortable:!0,filterable:!1,editable:!1,frozen:!0,headerClass:"custom-header"},...Object.keys(e.data[0]).filter((e=>"id"!==e)).map((l=>({label:l.replace(/_/g," ").toUpperCase(),field:l,sortable:!0,filterable:!0,filterOptions:{enabled:!0,placeholder:`${l}`},editable:!0,type:G.includes(l)?"checkbox":"text",width:10*Math.max(...e.data.map((e=>String(e[l]).length)),l.length)+20+"px",minWidth:"80px",headerClass:"custome-header"})))]),A.value=e.data.map((e=>({...e,filterable:!0}))),F.value=[...A.value],setTimeout(oe,500)}catch(e){L.value="Failed to fetch data"}finally{z.value=!1,J()}},J=()=>{const e={};R.value.forEach((l=>{e[l.field]=G.includes(l.field)?0:""})),e.id=q.value.length+1,q.value.push(e)},K=(e,l)=>{P.value.has(e.id)?P.value.get(e.id)[l]=e[l]:P.value.set(e.id,{...e})},X=async()=>{try{const e=Array.from(P.value.values());for(const l of e){const e={...l};for(const l of Q)delete e[l];delete e.id,B.forEach((l=>{null===e[l]||void 0===e[l]||isNaN(Date.parse(e[l]))||(e[l]=new Date(e[l]).toISOString().split("T")[0])})),Object.keys(e).forEach((l=>{""===e[l]&&(e[l]=null)})),await r.post(`${T}`,e),await H(),alert("Data uploaded Successfully"),q.value=[],P.value.clear()}}catch(e){alert("Failed to upload")}},Y=(e,l)=>{$.value.has(e.id)?$.value.get(e.id)[l]=e[l]:$.value.set(e.id,{...e})},Z=async()=>{try{const e=Array.from($.value.values());for(const l of e){const e={...l};for(const l of Q)delete e[l];B.forEach((l=>{null===e[l]||void 0===e[l]||isNaN(Date.parse(e[l]))||(e[l]=new Date(e[l]).toISOString().split("T")[0])})),await r.put(`${T}`,e)}alert("Changes saved successfully!"),$.value.clear()}catch(e){alert("Failed to save changes")}},ee=()=>{const e=w.json_to_sheet(F.value),l=w.book_new();w.book_append_sheet(l,e,"Marketing Data"),h(l,"Filtered_Marketing_Data.xlsx")},le=e=>{F.value=e},oe=()=>{const e=document.querySelector(".vue-good-table th:nth-child(1)");e&&(W.value=e.offsetWidth+"px"),document.documentElement.style.setProperty("--second-column-width",W.value)};return l((()=>{H(),(async()=>{try{const e=await r.get("https://www.transkon-rent.com/api/customer");Array.isArray(e.data)&&(M.value=e.data.map((e=>e.name??"")))}catch(e){}})(),(async()=>{try{const e=await r.get("https://www.transkon-rent.com/api/location");Array.isArray(e.data)&&(O.value=e.data.map((e=>e.location??"")))}catch(e){}})(),window.addEventListener("resize",oe)})),o((()=>{window.removeEventListener("resize",oe)})),(e,l)=>(s(),a("div",null,[l[0]||(l[0]=t("h2",null,"Marketing",-1)),t("button",{onClick:X},"Upload"),t("button",{onClick:J},"Add New Row"),z.value?(s(),a("p",v,"Loading...")):n("",!0),L.value?(s(),a("p",y,d(L.value),1)):n("",!0),t("div",b,[z.value||L.value?n("",!0):(s(),u(i(f),{key:0,columns:R.value,rows:q.value,"pagination-options":{enabled:!1},style:{"overflow-x":"auto"}},{"table-row":c((e=>[G.includes(e.column.field)?(s(),a("div",g,[t("input",{type:"checkbox",checked:1==e.row[e.column.field],onChange:l=>{e.row[e.column.field]=l.target.checked?1:0,K(e.row,e.column.field)}},null,40,k)])):"name_customer"===e.column.field?(s(),u(i(_),{key:1,modelValue:e.row[e.column.field],"onUpdate:modelValue":[l=>e.row[e.column.field]=l,l=>K(e.row,e.column.field)],options:M.value||[],searchable:!0,"allow-empty":!1,placeholder:"Select customer...",noResultsText:"No matching customers found"},null,8,["modelValue","onUpdate:modelValue","options"])):"location"===e.column.field?(s(),u(i(_),{key:2,modelValue:e.row[e.column.field],"onUpdate:modelValue":[l=>e.row[e.column.field]=l,l=>K(e.row,e.column.field)],options:O.value||[],searchable:!0,"allow-empty":!1,placeholder:"Select location...",noResultsText:"No matching customers found"},null,8,["modelValue","onUpdate:modelValue","options"])):B.includes(e.column.field)?m((s(),a("input",{key:3,type:"date","onUpdate:modelValue":l=>e.row[e.column.field]=l,onInput:l=>K(e.row,e.column.field)},null,40,x)),[[p,e.row[e.column.field]]]):!1!==e.column.editable?m((s(),a("input",{key:4,"onUpdate:modelValue":l=>e.row[e.column.field]=l,onInput:l=>K(e.row,e.column.field)},null,40,V)),[[p,e.row[e.column.field]]]):(s(),a("span",U,d(e.row[e.column.field]),1))])),_:1},8,["columns","rows"]))]),t("button",{onClick:ee},"Export to Excel"),t("button",{onClick:Z},"Save Updates"),t("div",C,[z.value||L.value?n("",!0):(s(),u(i(f),{key:0,columns:R.value,rows:A.value,"pagination-options":{enabled:!0,mode:"pages",perPage:10},"search-options":{enabled:!0},"sort-options":{enabled:!0},style:{"overflow-x":"auto"},onOnFiltered:le},{"table-row":c((e=>[G.includes(e.column.field)?(s(),a("div",I,[t("input",{type:"checkbox",checked:1==e.row[e.column.field],onChange:l=>e.row[e.column.field]=l.target.checked?1:0},null,40,S)])):"name_customer"===e.column.field?(s(),u(i(_),{key:1,modelValue:e.row[e.column.field],"onUpdate:modelValue":[l=>e.row[e.column.field]=l,l=>Y(e.row,e.column.field)],options:M.value||[],searchable:!0,"allow-empty":!1,placeholder:"Select customer...",noResultsText:"No matching customers found"},null,8,["modelValue","onUpdate:modelValue","options"])):"location"===e.column.field?(s(),u(i(_),{key:2,modelValue:e.row[e.column.field],"onUpdate:modelValue":[l=>e.row[e.column.field]=l,l=>Y(e.row,e.column.field)],options:O.value||[],searchable:!0,"allow-empty":!0,placeholder:"Select location...",noResultsText:"No matching customers found"},null,8,["modelValue","onUpdate:modelValue","options"])):B.includes(e.column.field)?m((s(),a("input",{key:3,type:"date","onUpdate:modelValue":l=>e.row[e.column.field]=l,onInput:l=>Y(e.row,e.column.field)},null,40,E)),[[p,e.row[e.column.field]]]):!1!==e.column.editable?m((s(),a("input",{key:4,"onUpdate:modelValue":l=>e.row[e.column.field]=l,onInput:l=>Y(e.row,e.column.field)},null,40,D)),[[p,e.row[e.column.field]]]):(s(),a("span",N,d(e.row[e.column.field]),1))])),_:1},8,["columns","rows"]))])]))}};export{j as default};
//# sourceMappingURL=TestView-DBBCAyUJ.js.map
