import{f as d,o as Z,D as J,c as s,a as u,d as U,t as S,C as f,s as L,p as h,k as y,g as n,w as C,m as D}from"./index-B_SQgsNz.js";import{s as E,V as O,u as N,w as Q}from"./xlsx-Dirqld1P.js";function T(){const r=["error","object","37878ESorzA","72wKRawf","body","385xZbysE","116488hMbAgF","headers","get","3670ECzZFc","content-type","9882756BgtmtN","4675XVdsBS","10813BYGwsl","GET","242625eLqhkb","stringify","5TeBKOJ","message","application/json","text","72784CjTGgV","Content-Type","json","success","1320dppEgt"];return T=function(){return r},T()}function M(r,i){const l=T();return M=function(c,m){return c=c-221,l[c]},M(r,i)}(function(r,i){const l=M,c=r();for(;;)try{if(parseInt(l(243))/1*(-parseInt(l(232))/2)+-parseInt(l(241))/3+-parseInt(l(225))/4*(parseInt(l(238))/5)+parseInt(l(228))/6*(parseInt(l(231))/7)+parseInt(l(221))/8*(parseInt(l(229))/9)+-parseInt(l(235))/10*(parseInt(l(239))/11)+parseInt(l(237))/12===i)break;c.push(c.shift())}catch{c.push(c.shift())}})(T,202156);const X={key:0},Y={key:1,class:"error"},H={class:"table-container"},ee={key:0,class:"checkbox-container"},te=["checked","onChange"],oe=["onUpdate:modelValue","onInput"],ae=["onUpdate:modelValue","onInput"],le={key:5},ne={class:"table-container"},ce={key:0,class:"checkbox-container"},de=["checked","onChange"],se=["onUpdate:modelValue","onInput"],ue=["onUpdate:modelValue","onInput"],ie={key:5},A="https://www.transkon-rent.com/api/marketing",re="https://www.transkon-rent.com/api/customer",me="https://www.transkon-rent.com/api/location",_e={__name:"TestView",setup(r){const i=d([]),l=d([]),c=d([]),m=d([]),_=d([]),k=d([]),w=d(!0),v=d(null);d("150px");const R=d("100px"),x=d(new Map),g=d(new Map),p=["front_bumper","rear_bumper","roll_bar","rops","buggy_whip_cw_flag","body_strip_3m","foglamp_led_16_mata","rotary_lamp_led","rotary_lamp_flash_tube","lamp_comb_led","safety_cone","wheel_chock","fire_exting","radio_motorolla","gps","wheel_nut_indic","tyre_gt_265_65_r17_mt","radio_icom"],$=["isEditing","filterable","vgt_id","originalIndex"],V=["inquiry","date_rfq","date_deadline_tender","approval_presdir","date_Quotation_trja","date_send_quot","date_approved_quot","date_spk_po_customer","date_master_contract","date_po_dealer","date_send_po","date_delvery_to_customer","received_date_by_customer","date_commisioning_finish"],q=async()=>{try{const t=await y.get(re);console.log(typeof t.data),console.log(t.data),Array.isArray(t.data)?c.value=t.data.map(a=>a.name??""):console.error("Unexpected API response format:",t.data)}catch(t){console.error("Failed to fetch customer data:",t)}},z=async()=>{try{const t=await y.get(me);Array.isArray(t.data)?m.value=t.data.map(a=>a.location??""):console.error("Unexpected API response format:",t.data)}catch(t){console.error("Failed to fetch customer data:",t)}},B=async()=>{try{w.value=!0;const t=await y.get(A);t.data.length>0&&(k.value=[{label:"ID",field:"id",width:"80px",minWidth:"100px",sortable:!0,filterable:!1,editable:!1,frozen:!0,headerClass:"custom-header"},...Object.keys(t.data[0]).filter(a=>a!=="id").map(a=>({label:a.replace(/_/g," ").toUpperCase(),field:a,sortable:!0,filterable:!0,filterOptions:{enabled:!0,placeholder:`${a}`},editable:!0,type:p.includes(a)?"checkbox":"text",width:Math.max(...t.data.map(e=>String(e[a]).length),a.length)*10+20+"px",minWidth:"80px",headerClass:"custome-header"}))]),i.value=t.data.map(a=>({...a,filterable:!0})),_.value=[...i.value],setTimeout(F,500)}catch(t){v.value="Failed to fetch data",console.error(t)}finally{w.value=!1,j()}},j=()=>{const t={};k.value.forEach(a=>{t[a.field]=p.includes(a.field)?0:""}),t.id=l.value.length+1,l.value.push(t)},b=(t,a)=>{g.value.has(t.id)?g.value.get(t.id)[a]=t[a]:g.value.set(t.id,{...t})},W=async()=>{try{console.log("button upload");const t=Array.from(g.value.values());console.log(t);for(const a of t){const e={...a};for(const o of $)delete e[o];delete e.id,console.log(e),V.forEach(o=>{e[o]!==null&&e[o]!==void 0&&!isNaN(Date.parse(e[o]))&&(e[o]=new Date(e[o]).toISOString().split("T")[0])}),Object.keys(e).forEach(o=>{e[o]===""&&(e[o]=null)}),await y.post(`${A}`,e),await B(),alert("Data uploaded Successfully"),l.value=[],g.value.clear()}}catch(t){console.error("Failed to upload: ",t),alert("Failed to upload")}},I=(t,a)=>{x.value.has(t.id)?x.value.get(t.id)[a]=t[a]:x.value.set(t.id,{...t})},G=async()=>{try{const t=Array.from(x.value.values());for(const a of t){const e={...a};for(const o of $)delete e[o];V.forEach(o=>{e[o]!==null&&e[o]!==void 0&&!isNaN(Date.parse(e[o]))&&(e[o]=new Date(e[o]).toISOString().split("T")[0])}),await y.put(`${A}`,e)}alert("Changes saved successfully!"),x.value.clear()}catch(t){console.error("Failed to save changes:",t),alert("Failed to save changes")}},P=()=>{const t=N.json_to_sheet(_.value),a=N.book_new();N.book_append_sheet(a,t,"Marketing Data"),Q(a,"Filtered_Marketing_Data.xlsx")},K=t=>{_.value=t,console.log("F Len : ",_.value.length," | M Len : ",i.value.length)},F=()=>{const t=document.querySelector(".vue-good-table th:nth-child(1)");t&&(R.value=t.offsetWidth+"px"),document.documentElement.style.setProperty("--second-column-width",R.value)};return Z(()=>{B(),q(),z(),window.addEventListener("resize",F)}),J(()=>{window.removeEventListener("resize",F)}),(t,a)=>(n(),s("div",null,[a[0]||(a[0]=u("h2",null,"Marketing",-1)),u("button",{onClick:W},"Upload"),u("button",{onClick:j},"Add New Row"),w.value?(n(),s("p",X,"Loading...")):U("",!0),v.value?(n(),s("p",Y,S(v.value),1)):U("",!0),u("div",H,[!w.value&&!v.value?(n(),f(h(O),{key:0,columns:k.value,rows:l.value,"pagination-options":{enabled:!1},style:{"overflow-x":"auto"}},{"table-row":L(e=>[p.includes(e.column.field)?(n(),s("div",ee,[u("input",{type:"checkbox",checked:e.row[e.column.field]==1,onChange:o=>{e.row[e.column.field]=o.target.checked?1:0,b(e.row,e.column.field)}},null,40,te)])):e.column.field==="name_customer"?(n(),f(h(E),{key:1,modelValue:e.row[e.column.field],"onUpdate:modelValue":[o=>e.row[e.column.field]=o,o=>b(e.row,e.column.field)],options:c.value||[],searchable:!0,"allow-empty":!1,placeholder:"Select customer...",noResultsText:"No matching customers found"},null,8,["modelValue","onUpdate:modelValue","options"])):e.column.field==="location"?(n(),f(h(E),{key:2,modelValue:e.row[e.column.field],"onUpdate:modelValue":[o=>e.row[e.column.field]=o,o=>b(e.row,e.column.field)],options:m.value||[],searchable:!0,"allow-empty":!1,placeholder:"Select location...",noResultsText:"No matching customers found"},null,8,["modelValue","onUpdate:modelValue","options"])):V.includes(e.column.field)?C((n(),s("input",{key:3,type:"date","onUpdate:modelValue":o=>e.row[e.column.field]=o,onInput:o=>b(e.row,e.column.field)},null,40,oe)),[[D,e.row[e.column.field]]]):e.column.editable!==!1?C((n(),s("input",{key:4,"onUpdate:modelValue":o=>e.row[e.column.field]=o,onInput:o=>b(e.row,e.column.field)},null,40,ae)),[[D,e.row[e.column.field]]]):(n(),s("span",le,S(e.row[e.column.field]),1))]),_:1},8,["columns","rows"])):U("",!0)]),u("button",{onClick:P},"Export to Excel"),u("button",{onClick:G},"Save Updates"),u("div",ne,[!w.value&&!v.value?(n(),f(h(O),{key:0,columns:k.value,rows:i.value,"pagination-options":{enabled:!0,mode:"pages",perPage:10},"search-options":{enabled:!0},"sort-options":{enabled:!0},style:{"overflow-x":"auto"},onOnFiltered:K},{"table-row":L(e=>[p.includes(e.column.field)?(n(),s("div",ce,[u("input",{type:"checkbox",checked:e.row[e.column.field]==1,onChange:o=>e.row[e.column.field]=o.target.checked?1:0},null,40,de)])):e.column.field==="name_customer"?(n(),f(h(E),{key:1,modelValue:e.row[e.column.field],"onUpdate:modelValue":[o=>e.row[e.column.field]=o,o=>I(e.row,e.column.field)],options:c.value||[],searchable:!0,"allow-empty":!1,placeholder:"Select customer...",noResultsText:"No matching customers found"},null,8,["modelValue","onUpdate:modelValue","options"])):e.column.field==="location"?(n(),f(h(E),{key:2,modelValue:e.row[e.column.field],"onUpdate:modelValue":[o=>e.row[e.column.field]=o,o=>I(e.row,e.column.field)],options:m.value||[],searchable:!0,"allow-empty":!0,placeholder:"Select location...",noResultsText:"No matching customers found"},null,8,["modelValue","onUpdate:modelValue","options"])):V.includes(e.column.field)?C((n(),s("input",{key:3,type:"date","onUpdate:modelValue":o=>e.row[e.column.field]=o,onInput:o=>I(e.row,e.column.field)},null,40,se)),[[D,e.row[e.column.field]]]):e.column.editable!==!1?C((n(),s("input",{key:4,"onUpdate:modelValue":o=>e.row[e.column.field]=o,onInput:o=>I(e.row,e.column.field)},null,40,ue)),[[D,e.row[e.column.field]]]):(n(),s("span",ie,S(e.row[e.column.field]),1))]),_:1},8,["columns","rows"])):U("",!0)])]))}};export{_e as default};
//# sourceMappingURL=TestView-BVSjBOQL.js.map
