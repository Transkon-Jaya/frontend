import{_ as e,u as l,r as a,o as u,w as o,p as t,c as n,g as s,a as i,F as c,j as d,E as r,b as m,t as p,z as v,y as b,v as f,n as y,q as h,A as k}from"./index-ymcskxsK.js";import{s as g}from"./vue-multiselect-K0gAGM40.js";const V={class:"container-global mb-4"},w={key:0},x={class:"form-grid"},j=["value"],I=["value","onInput"],U=["value","onInput"],A={key:5,class:"checkbox-field no-border"},_=["checked","onChange"],O=["onUpdate:modelValue","placeholder"],S={key:1,class:"loading-message"},q=e({__name:"MiniForm",props:{modelValue:{type:Object,default:()=>({})},fields:Object,urls:Object},emits:["update:modelValue"],setup(e,{emit:q}){const E=l(),F=e,z=q,C=a({...F.modelValue}),M=a({}),B=a(!1);u((async()=>{await(async()=>{const e=Object.entries(F.urls.dropdowns).map((async([e,l])=>{try{const a=await h.get(l.url);M.value[e]=a.data.map((e=>({label:e,value:e})))}catch(a){}}));await Promise.all(e),B.value=!0})()})),o((()=>F.modelValue),(e=>{C.value={...e}}));const D=async(e,l)=>{C.value[e]=l,z("update:modelValue",{...C.value}),F.fields.columns.forEach((async a=>{if(a.autofill&&a.autofill.triggeredBy===e)try{const e=await h.get(k+"/"+a.autofill.url,{params:[l.label]}),u=a.autofill.getValue(e.data);C.value[a.column]=u,z("update:modelValue",{...C.value})}catch(u){C.value[a.column]=""}}))},L=e=>{var l;return null==(l=F.fields.uneditable)?void 0:l.includes(e.column)},P=(e,l)=>{var a;return null==(a=F.fields[e])?void 0:a.includes(l.column)},R=async()=>{var e,l;try{const a={};for(const u of F.fields.columns||[]){const o=u.column;if(null==(e=F.fields.toRemove)?void 0:e.includes(o))continue;if(null==(l=F.fields.exclude)?void 0:l.includes(o))continue;if(u.compute){a[o]=u.compute(C.value),"boolean"==typeof a[o]&&(a[o]=a[o]?1:0);continue}if(!("function"!=typeof u.visibleIf||u.visibleIf(C.value)))continue;const t=C.value[o],n=u.required??!1,s=null==t||"string"==typeof t&&""===t.trim()||Array.isArray(t)&&0===t.length&&"boolean"!=typeof t;if(n&&s)return void alert(`Field "${u.label||o}" is required.`);!n&&s||(Array.isArray(t)?a[o]=t.map((e=>(null==e?void 0:e.label)??e)).join(","):a[o]="object"==typeof t&&"label"in t?t.label:"boolean"==typeof t?t?1:0:t)}a.username=E.username;await h.post(F.urls.data,a);window.location.reload()}catch(a){}},T=t((()=>F.fields.columns.filter((e=>"function"!=typeof e.visibleIf||e.visibleIf(C.value))))),$=a(T.value);return o(T,(e=>{const l=e.map((e=>e.column));$.value.filter((e=>!l.includes(e))).forEach((e=>{D(e,null)})),$.value=l}),{immediate:!0}),(e,l)=>(s(),n("div",V,[B.value?(s(),n("div",w,[i("form",{onSubmit:y(R,["prevent"]),class:"mini-form"},[i("div",x,[(s(!0),n(c,null,d(T.value,((e,l)=>(s(),n("div",{key:e.column,class:"form-field"},[i("label",null,p(e.label),1),L(e)?(s(),n("input",{key:0,type:"text",class:"input bordered",value:C.value[e.column],disabled:""},null,8,j)):P("datetime",e)?(s(),n("input",{key:1,type:"datetime-local",class:"input bordered",value:C.value[e.column]||"",onInput:l=>D(e.column,l.target.value)},null,40,I)):P("number",e)?(s(),n("input",{key:2,type:"number",class:"input bordered",value:C.value[e.column]||"",onInput:l=>D(e.column,l.target.value)},null,40,U)):P("dropdown",e)?(s(),r(v(g),{key:3,modelValue:C.value[e.column],"onUpdate:modelValue":[l=>C.value[e.column]=l,l=>D(e.column,l)],options:M.value[e.column]||[],placeholder:"Select",label:"label","track-by":"value",class:"multiselect no-border"},null,8,["modelValue","onUpdate:modelValue","options"])):P("multiselect",e)?(s(),r(v(g),{key:4,modelValue:C.value[e.column],"onUpdate:modelValue":[l=>C.value[e.column]=l,l=>D(e.column,l)],options:M.value[e.column]||[],placeholder:"Select",label:"label","track-by":"value",class:b(["multiselect no-border",{"multiselect--multiple":P("multiselect",e)}]),multiple:"true","close-on-select":!1},null,8,["modelValue","onUpdate:modelValue","options","class"])):P("checkbox",e)?(s(),n("div",A,[i("input",{type:"checkbox",checked:C.value[e.column],onChange:l=>D(e.column,l.target.checked),class:"form-checkbox"},null,40,_)])):m((s(),n("input",{key:6,type:"text",class:"form-input bordered","onUpdate:modelValue":l=>C.value[e.column]=l,placeholder:e.filterText||e.label},null,8,O)),[[f,C.value[e.column]]])])))),128))]),l[0]||(l[0]=i("div",{class:"submit-container"},[i("button",{type:"submit",class:"submit-button bordered"},"Submit")],-1))],32)])):(s(),n("div",S,l[1]||(l[1]=[i("i",{class:"pi pi-spin pi-spinner",style:{"font-size":"1.5rem"}},null,-1),i("p",null,"Loading form...",-1)])))]))}},[["__scopeId","data-v-dd824ff5"]]);export{q as M};
