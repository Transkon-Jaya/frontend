import{C as h,r as B}from"./chart-BSyum5xv.js";import{p as _}from"./Charts.vue_vue_type_style_index_0_scoped_46e5040e_lang-CBrIU-De.js";import{_ as E,u as R,r as v,o as D,c as H,g as I,a as g,t as O,y as S,p as x}from"./index-CFqpVhRV.js";const V={class:"card h-100"},j={class:"card-body"},q={class:"card-title text-danger"},F={__name:"Charts",props:{settings:{type:Object,required:!0}},setup(C,{expose:w}){const f=R();h.register(...B,_);const t=C,d={green:"#10b981",orange:"#ffa600",red:"#ef4444"},u=v(null),p=v(null),k=async()=>{let o;t.settings.api.params?o=await x.get(t.settings.api.url,{headers:{Authorization:`Bearer ${f.token}`},params:{params:t.settings.api.params}}):o=await x.get(t.settings.api.url,{headers:{Authorization:`Bearer ${f.token}`}});let a;t.settings.columns.label?a=o.data.map(s=>s[t.settings.columns.label]):a=t.settings.labels;const e={},r={};return t.settings.columns.datas.forEach(s=>{e[s]=o.data.map(n=>parseFloat(n[s])||0)}),Array.isArray(t.settings.columns.extras)&&t.settings.columns.extras.forEach(s=>{r[s]=o.data.map(n=>n[s]||"")}),{labels:a,values:e,extras:r}},A=(o,a)=>{if(t.settings.type==="line")return t.settings.columns.datas.map((e,r)=>({label:t.settings.labels[r],data:o[e].map((s,n)=>{var l,c;return{x:n,y:s,extra:(c=a==null?void 0:a[(l=t.settings.columns.extras)==null?void 0:l[r]])==null?void 0:c[n]}}),borderColor:d[t.settings.colors[r]],tension:0,fill:!1}));if(["bar","ybar"].includes(t.settings.type)){const e=t.settings.type==="ybar";return t.settings.columns.datas.map((r,s)=>({label:t.settings.labels[s],data:o[r].map((n,l)=>{var c,m;return{x:e?n:l,y:e?l:n,extra:(m=a==null?void 0:a[(c=t.settings.columns.extras)==null?void 0:c[s]])==null?void 0:m[l]}}),backgroundColor:d[t.settings.colors[s]]}))}else if(t.settings.type==="pie"){let e={data:[],backgroundColor:[]};return t.settings.columns.datas.forEach((r,s)=>{e.data.push(o[r][0]),e.backgroundColor.push(t.settings.colors[s])}),[e]}},$=o=>{const a=["ybar"].includes(t.settings.type);if(["line","bar","ybar"].includes(t.settings.type))return{indexAxis:a?"y":"x",responsive:!0,maintainAspectRatio:!1,plugins:{tooltip:{callbacks:{label:function(e){const r=e.dataset.label||"",s=e.raw,n=a?s.x:s.y,l=s.extra;return l?`${r}: ${n} (${l})`:`${r}: ${n}`}}},datalabels:{display:!1}}};if(["pie"].includes(t.settings.type))return{responsive:!0,maintainAspectRatio:!1,plugins:{datalabels:{color:"#fff",font:{weight:"bold",size:14},formatter:e=>e}}}},z=()=>{if(["line","bar","ybar"].includes(t.settings.type))return null;if(["pie"].includes(t.settings.type))return[_]};let y=0,i=!1;const b=async()=>{if(i)return;i=!0;const o=++y;if(await S(),!p.value){i=!1;return}const a=p.value.getContext("2d");if(!a){console.warn("Chart rendering aborted: canvas context is null"),i=!1;return}u.value&&u.value.destroy();try{const{labels:e,values:r,extras:s}=await k();if(o!==y){i=!1;return}if(!(e!=null&&e.length)||!r){console.warn("Chart rendering aborted: no data"),i=!1;return}let n=t.settings.type;n==="ybar"&&(n="bar"),u.value=new h(a,{type:n,data:{labels:e,datasets:A(r,s)},options:$(s),plugins:z()})}catch(e){console.error("Error fetching data for chart:",e)}finally{i=!1}};return w({renderChart:b}),D(()=>{b()}),(o,a)=>(I(),H("div",V,[g("div",j,[g("h5",q,O(t.settings.title),1),g("canvas",{ref_key:"chartRef",ref:p,class:"w-100",style:{height:"300px"}},null,512)])]))}},P=E(F,[["__scopeId","data-v-46e5040e"]]);export{P as C};
