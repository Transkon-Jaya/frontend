import{d as e,f as o,E as a,c as l,a as t,l as n,t as d,y as r,k as s,i as u,g as c,o as i,h as p,v as m}from"./index-5_BT3QSG.js";import{s as f,V as h,u as w,w as _}from"./xlsx-WJjOsaSF.js";function v(){const e=["1256020PKagYD","2988YcFiyH","8ERZMKZ","content-type","15pTkoMK","application/json","get","body","1502700StcDom","text","18NBpoBU","object","message","headers","Content-Type","4352047RavGob","319oKZerb","json","includes","49695451QvsKaB","233062TSqfvU","9xZRrdf","stringify","error","3NXOOrM","1424346HyZXIx","success"];return(v=function(){return e})()}function y(e,o){const a=v();return(y=function(e,o){return a[e-=443]})(e,o)}!function(){const e=y,o=v();for(;;)try{if(820396===parseInt(e(447))/1*(-parseInt(e(446))/2)+parseInt(e(450))/3*(-parseInt(e(461))/4)+-parseInt(e(457))/5*(parseInt(e(451))/6)+parseInt(e(468))/7*(-parseInt(e(455))/8)+-parseInt(e(463))/9*(parseInt(e(453))/10)+-parseInt(e(469))/11*(-parseInt(e(454))/12)+parseInt(e(445))/13)break;o.push(o.shift())}catch(a){o.push(o.shift())}}();const b={key:0},g={key:1,class:"error"},k={class:"table-container"},x={key:0,class:"checkbox-container"},I=["checked","onChange"],V=["onUpdate:modelValue","onInput"],U=["onUpdate:modelValue","onInput"],S={key:5},C={class:"table-container"},E={key:0,class:"checkbox-container"},N=["checked","onChange"],T=["onUpdate:modelValue","onInput"],D=["onUpdate:modelValue","onInput"],j={key:5},M="https://www.transkon-rent.com/api/marketing",O={__name:"TestView",setup(v){const y=e([]),O=e([]),R=e([]),A=e([]),q=e([]),F=e([]),K=e(!0),Z=e(null);e("150px");const z=e("100px"),B=e(new Map),L=e(new Map),P=["front_bumper","rear_bumper","roll_bar","rops","buggy_whip_cw_flag","body_strip_3m","foglamp_led_16_mata","rotary_lamp_led","rotary_lamp_flash_tube","lamp_comb_led","safety_cone","wheel_chock","fire_exting","radio_motorolla","gps","wheel_nut_indic","tyre_gt_265_65_r17_mt","radio_icom"],W=["isEditing","filterable","vgt_id","originalIndex"],$=["inquiry","date_rfq","date_deadline_tender","approval_presdir","date_Quotation_trja","date_send_quot","date_approved_quot","date_spk_po_customer","date_master_contract","date_po_dealer","date_send_po","date_delvery_to_customer","received_date_by_customer","date_commisioning_finish"],H=async()=>{try{K.value=!0;const e=await c.get(M);e.data.length>0&&(F.value=[{label:"ID",field:"id",width:"80px",minWidth:"100px",sortable:!0,filterable:!1,editable:!1,frozen:!0,headerClass:"custom-header"},...Object.keys(e.data[0]).filter((e=>"id"!==e)).map((o=>({label:o.replace(/_/g," ").toUpperCase(),field:o,sortable:!0,filterable:!0,filterOptions:{enabled:!0,placeholder:`${o}`},editable:!0,type:P.includes(o)?"checkbox":"text",width:10*Math.max(...e.data.map((e=>String(e[o]).length)),o.length)+20+"px",minWidth:"80px",headerClass:"custome-header"})))]),y.value=e.data.map((e=>({...e,filterable:!0}))),q.value=[...y.value],setTimeout(ae,500)}catch(e){Z.value="Failed to fetch data"}finally{K.value=!1,Q()}},Q=()=>{const e={};F.value.forEach((o=>{e[o.field]=P.includes(o.field)?0:""})),e.id=O.value.length+1,O.value.push(e)},X=(e,o)=>{L.value.has(e.id)?L.value.get(e.id)[o]=e[o]:L.value.set(e.id,{...e})},Y=async()=>{try{const e=Array.from(L.value.values());for(const o of e){const e={...o};for(const o of W)delete e[o];delete e.id,$.forEach((o=>{null===e[o]||void 0===e[o]||isNaN(Date.parse(e[o]))||(e[o]=new Date(e[o]).toISOString().split("T")[0])})),Object.keys(e).forEach((o=>{""===e[o]&&(e[o]=null)})),await c.post(`${M}`,e),await H(),alert("Data uploaded Successfully"),O.value=[],L.value.clear()}}catch(e){alert("Failed to upload")}},G=(e,o)=>{B.value.has(e.id)?B.value.get(e.id)[o]=e[o]:B.value.set(e.id,{...e})},J=async()=>{try{const e=Array.from(B.value.values());for(const o of e){const e={...o};for(const o of W)delete e[o];$.forEach((o=>{null===e[o]||void 0===e[o]||isNaN(Date.parse(e[o]))||(e[o]=new Date(e[o]).toISOString().split("T")[0])})),await c.put(`${M}`,e)}alert("Changes saved successfully!"),B.value.clear()}catch(e){alert("Failed to save changes")}},ee=()=>{const e=w.json_to_sheet(q.value),o=w.book_new();w.book_append_sheet(o,e,"Marketing Data"),_(o,"Filtered_Marketing_Data.xlsx")},oe=e=>{q.value=e},ae=()=>{const e=document.querySelector(".vue-good-table th:nth-child(1)");e&&(z.value=e.offsetWidth+"px"),document.documentElement.style.setProperty("--second-column-width",z.value)};return o((()=>{H(),(async()=>{try{const e=await c.get("https://www.transkon-rent.com/api/customer");Array.isArray(e.data)&&(R.value=e.data.map((e=>e.name??"")))}catch(e){}})(),(async()=>{try{const e=await c.get("https://www.transkon-rent.com/api/location");Array.isArray(e.data)&&(A.value=e.data.map((e=>e.location??"")))}catch(e){}})(),window.addEventListener("resize",ae)})),a((()=>{window.removeEventListener("resize",ae)})),(e,o)=>(i(),l("div",null,[o[0]||(o[0]=t("h2",null,"Marketing",-1)),t("button",{onClick:Y},"Upload"),t("button",{onClick:Q},"Add New Row"),K.value?(i(),l("p",b,"Loading...")):n("",!0),Z.value?(i(),l("p",g,d(Z.value),1)):n("",!0),t("div",k,[K.value||Z.value?n("",!0):(i(),r(u(h),{key:0,columns:F.value,rows:O.value,"pagination-options":{enabled:!1},style:{"overflow-x":"auto"}},{"table-row":s((e=>[P.includes(e.column.field)?(i(),l("div",x,[t("input",{type:"checkbox",checked:1==e.row[e.column.field],onChange:o=>{e.row[e.column.field]=o.target.checked?1:0,X(e.row,e.column.field)}},null,40,I)])):"name_customer"===e.column.field?(i(),r(u(f),{key:1,modelValue:e.row[e.column.field],"onUpdate:modelValue":[o=>e.row[e.column.field]=o,o=>X(e.row,e.column.field)],options:R.value||[],searchable:!0,"allow-empty":!1,placeholder:"Select customer...",noResultsText:"No matching customers found"},null,8,["modelValue","onUpdate:modelValue","options"])):"location"===e.column.field?(i(),r(u(f),{key:2,modelValue:e.row[e.column.field],"onUpdate:modelValue":[o=>e.row[e.column.field]=o,o=>X(e.row,e.column.field)],options:A.value||[],searchable:!0,"allow-empty":!1,placeholder:"Select location...",noResultsText:"No matching customers found"},null,8,["modelValue","onUpdate:modelValue","options"])):$.includes(e.column.field)?p((i(),l("input",{key:3,type:"date","onUpdate:modelValue":o=>e.row[e.column.field]=o,onInput:o=>X(e.row,e.column.field)},null,40,V)),[[m,e.row[e.column.field]]]):!1!==e.column.editable?p((i(),l("input",{key:4,"onUpdate:modelValue":o=>e.row[e.column.field]=o,onInput:o=>X(e.row,e.column.field)},null,40,U)),[[m,e.row[e.column.field]]]):(i(),l("span",S,d(e.row[e.column.field]),1))])),_:1},8,["columns","rows"]))]),t("button",{onClick:ee},"Export to Excel"),t("button",{onClick:J},"Save Updates"),t("div",C,[K.value||Z.value?n("",!0):(i(),r(u(h),{key:0,columns:F.value,rows:y.value,"pagination-options":{enabled:!0,mode:"pages",perPage:10},"search-options":{enabled:!0},"sort-options":{enabled:!0},style:{"overflow-x":"auto"},onOnFiltered:oe},{"table-row":s((e=>[P.includes(e.column.field)?(i(),l("div",E,[t("input",{type:"checkbox",checked:1==e.row[e.column.field],onChange:o=>e.row[e.column.field]=o.target.checked?1:0},null,40,N)])):"name_customer"===e.column.field?(i(),r(u(f),{key:1,modelValue:e.row[e.column.field],"onUpdate:modelValue":[o=>e.row[e.column.field]=o,o=>G(e.row,e.column.field)],options:R.value||[],searchable:!0,"allow-empty":!1,placeholder:"Select customer...",noResultsText:"No matching customers found"},null,8,["modelValue","onUpdate:modelValue","options"])):"location"===e.column.field?(i(),r(u(f),{key:2,modelValue:e.row[e.column.field],"onUpdate:modelValue":[o=>e.row[e.column.field]=o,o=>G(e.row,e.column.field)],options:A.value||[],searchable:!0,"allow-empty":!0,placeholder:"Select location...",noResultsText:"No matching customers found"},null,8,["modelValue","onUpdate:modelValue","options"])):$.includes(e.column.field)?p((i(),l("input",{key:3,type:"date","onUpdate:modelValue":o=>e.row[e.column.field]=o,onInput:o=>G(e.row,e.column.field)},null,40,T)),[[m,e.row[e.column.field]]]):!1!==e.column.editable?p((i(),l("input",{key:4,"onUpdate:modelValue":o=>e.row[e.column.field]=o,onInput:o=>G(e.row,e.column.field)},null,40,D)),[[m,e.row[e.column.field]]]):(i(),l("span",j,d(e.row[e.column.field]),1))])),_:1},8,["columns","rows"]))])]))}};export{O as default};
//# sourceMappingURL=TestView-CDPSrRAP.js.map
