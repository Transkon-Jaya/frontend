import{_ as a}from"./eid-CUa9Qr1a.js";import{_ as e,c as l,d as n,o as t,a as s,h as o,t as i,u,f as c,i as d,g as r,b as v,j as p,k as m,l as g,m as h,e as f}from"./index-B0VvdGiw.js";const b={props:{imageSrc:{type:String,required:!0},imageTitle:{type:String,default:"Image Preview"},showModal:{type:Boolean,default:!1}},methods:{closeModal(){this.$emit("close")},handleKeydown(a){"Escape"===a.key&&this.closeModal()}},mounted(){window.addEventListener("keydown",this.handleKeydown)},beforeUnmount(){window.removeEventListener("keydown",this.handleKeydown)}},w={class:"modal-dialog modal-dialog-centered",role:"document"},y={class:"modal-header"},k={class:"modal-title",id:"imageModalLabel"},M={class:"modal-body"},S=["src"];const _=e(b,[["render",function(a,e,u,c,d,r){return u.showModal?(t(),l("div",{key:0,class:"modal fade show",tabindex:"-1",role:"dialog","aria-labelledby":"imageModalLabel",style:{display:"block"},"aria-hidden":"false",onClick:e[2]||(e[2]=o(((...a)=>r.closeModal&&r.closeModal(...a)),["self"]))},[s("div",w,[s("div",{class:"modal-content",onClick:e[1]||(e[1]=o((()=>{}),["stop"]))},[s("div",y,[s("h5",k,i(u.imageTitle),1),s("button",{type:"button",class:"close",onClick:e[0]||(e[0]=(...a)=>r.closeModal&&r.closeModal(...a)),"aria-label":"Close"},e[3]||(e[3]=[s("span",{"aria-hidden":"true"},"Ã—",-1)]))]),s("div",M,[s("img",{src:u.imageSrc,alt:"Image Preview",class:"img-fluid"},null,8,S)])])])])):n("",!0)}],["__scopeId","data-v-b06dafc1"]]),$={class:"app-container"},I={class:"main-content"},x={class:"container-global attendance-card"},A={class:"form-group"},D={key:0,id:"location",class:"form-control-plaintext"},P={key:1,class:"form-control-plaintext text-muted"},C={key:0,class:"mb-4"},N={key:1,class:"mb-4"},O={class:"action-group"},L={key:0},U={key:1},E={key:2},T={key:3},F={key:2,class:"confirmation-message"},B={class:"container-global info-section-edit"},J={class:"info-card"},j={class:"info-content"},G={class:"info-row"},H={class:"info-value"},K={class:"info-row"},q={class:"info-value"},z={class:"info-row"},R={key:0,class:"info-value"},V={key:1,class:"info-value text-muted"},W={class:"info-row"},Y={class:"info-value"},Z=["src"],Q={__name:"AbsensiView",setup(e){const o=u();c(null);const b=["Mengambil Data...","Izin Ditolak","Gagal Memuat"],w=c({ipv4:b[0],ipv6:b[0]}),y=c({lat:b[0],lon:b[0]});c({city:b[0],country:b[0],lat:"",lon:""});const k=c("");c("");const M=c(!1),S=c(""),Q=c([]),X=c([]),aa=c(!0),ea=c(!1),la=c(""),na=d((()=>![y.value.lat,y.value.lon,w.value.ipv4].some((a=>b.includes(a))))),ta=d((()=>{var a;return((null==(a=S.value)?void 0:a.distance)??99999)>1e3})),sa=d((()=>{const a=X.value[0];if(!a)return"IN";const e=a.hour_in?new Date(a.hour_in):null,l=e?(new Date-e)/36e5:null;return a.hour_out&&l>=16||l>=16?"IN":a.hour_out&&"00:00:00"!==a.hour_out?"DONE":"OUT"})),oa=async()=>{const a=await fetch(`${o.apiBaseUrl}/absensi-status?username=${o.username}`);X.value=await a.json(),X.value.length>0&&(X.value[0].foto_in=`${o.baseUrl}/uploads/absensi/${X.value[0].foto_in}`,X.value[0].foto_out=`${o.baseUrl}/uploads/absensi/${X.value[0].foto_out}`),aa.value=!1};const ia=async()=>{const a=await g.get(`${o.apiBaseUrl}/hr-lokasi`);Q.value=a.data.map((a=>{const e=a.latitude??null,l=a.longitude??null,n=null!==e&&null!==l&&y.value.lat&&y.value.lon?function(a,e,l,n){const t=(l-a)*Math.PI/180,s=(n-e)*Math.PI/180,o=Math.sin(t/2)**2+Math.cos(a*Math.PI/180)*Math.cos(l*Math.PI/180)*Math.sin(s/2)**2,i=2*Math.atan2(Math.sqrt(o),Math.sqrt(1-o))*6371*1e3;return isNaN(i)?0:i.toFixed(2)}(y.value.lat,y.value.lon,e,l):1/0;return{nama:a.nama??"",lat:e,lon:l,distance:n}})),Q.value.sort(((a,e)=>a.distance-e.distance)),Q.value.length>0&&(S.value=Q.value[0])},ua=async()=>{try{const a=await g.get("https://www.transkon-rent.com/api/ip");w.value.ipv4=a.data.ip}catch(a){w.value.ipv4=b[2]}},ca=a=>{la.value=a,ea.value=!0},da=()=>{ea.value=!1},ra=()=>{S.value?document.getElementById("cameraInput").click():alert("Silakan pilih lokasi absen terlebih dahulu!")},va=async a=>{const e=a.target.files[0];if(e)try{const{dimension:a,device:l}=(()=>{const a=`${window.innerWidth}x${window.innerHeight}`,e=navigator.userAgent,l=e.match(/\(([^)]+)\)/);let n=l?l[1]:`?${e}`;return n.length>250&&(n=n.substring(0,250)),{dimension:a,device:n}})(),n=new FormData;n.append("foto",e),n.append("id","IN"==sa.value?null:X.value[0].id),n.append("status",sa.value),n.append("username",o.username),n.append("lokasi",S.value.nama),n.append("jarak",S.value.distance),n.append("long",y.value.lon),n.append("lang",y.value.lat),n.append("ip",w.value.ipv4),n.append("dim",a),n.append("device",l);const t=await g.post("https://www.transkon-rent.com/api/absensi",n,{headers:{"Content-Type":"multipart/form-data"}});"success"===t.data.status&&(M.value=!0,window.location.reload())}catch(l){}};function pa(a){const e=new Date(a);return`${e.getDate()} ${["Januari","Februari","Maret","April","Mei","Juni","Juli","Agustus","September","Oktober","November","Desember"][e.getMonth()]} ${e.getFullYear()} ${String(e.getHours()).padStart(2,"0")}:${String(e.getMinutes()).padStart(2,"0")}:${String(e.getSeconds()).padStart(2,"0")}`}return r((async()=>{try{await new Promise((a=>{if("geolocation"in navigator)try{navigator.geolocation.getCurrentPosition((e=>{y.value.lat=e.coords.latitude.toFixed(6),y.value.lon=e.coords.longitude.toFixed(6),k.value=`https://static-maps.yandex.ru/1.x/?lang=en-US&ll=${y.value.lon},${y.value.lat}&size=450,300&z=12&l=map&pt=${y.value.lon},${y.value.lat},pm2rdm`,a(!0)}),(e=>{y.value.lat=b[1],y.value.lon=b[1],a(!1)}),{enableHighAccuracy:!0,timeout:5e3,maximumAge:0})}catch(e){y.value.lat=b[2],y.value.lon=b[2],a(!1)}else y.value.lat=b[2],y.value.lon=b[2],a(!1)}));await Promise.all([ia(),ua(),oa()])}catch(a){}})),(e,o)=>{var u;const c=h("VButton"),d=h("Button");return t(),l("div",$,[s("main",I,[o[11]||(o[11]=s("h1",{class:"app-title"},"Absensi Karyawan",-1)),o[12]||(o[12]=s("p",{class:"app-subtitle"},null,-1)),s("div",x,[s("div",A,[Q.value.length>0?(t(),l("p",D,i(Q.value[0].nama),1)):(t(),l("p",P,"Loading location..."))]),"OUT"===sa.value||"DONE"===sa.value?(t(),l("div",C,[s("div",null,i(pa(X.value[0].hour_in)),1),p(c,{onClick:o[0]||(o[0]=a=>ca(X.value[0].foto_in)),class:"btn btn-danger"},{default:m((()=>o[2]||(o[2]=[f("Photo In")]))),_:1}),p(_,{imageSrc:la.value,showModal:ea.value,onClose:da},null,8,["imageSrc","showModal"])])):n("",!0),"DONE"===sa.value?(t(),l("div",N,[s("div",null,i(pa(null==(u=X.value[0])?void 0:u.hour_out)),1),p(c,{onClick:o[1]||(o[1]=a=>ca(X.value[0].foto_out)),class:"btn btn-danger"},{default:m((()=>o[3]||(o[3]=[f("Photo Out")]))),_:1}),p(_,{imageSrc:la.value,showModal:ea.value,onClose:da},null,8,["imageSrc","showModal"])])):n("",!0),s("div",O,[s("input",{type:"file",accept:"image/*",capture:"environment",onChange:va,id:"cameraInput",style:{display:"none"}},null,32),p(d,{onClick:ra,class:"primary-btn",disabled:!S.value||"DONE"===sa.value||aa.value||!na.value||ta.value},{default:m((()=>[o[4]||(o[4]=s("i",{class:"fa-solid fa-camera"},null,-1)),aa.value?(t(),l("span",L,"Loading...")):na.value?ta.value?(t(),l("span",E,"Anda Diluar Zona Absensi")):(t(),l("span",T,i("DONE"===sa.value?"Sudah Absen":"OUT"===sa.value?"Absen OUT":"Absen IN"),1)):(t(),l("span",U,"Gagal Memuat"))])),_:1},8,["disabled"])]),M.value?(t(),l("div",F,o[5]||(o[5]=[s("i",{class:"fa-solid fa-check-circle success-icon"},null,-1),s("span",null,"Absensi berhasil direkam!",-1)]))):n("",!0)]),o[13]||(o[13]=v('<div class="container-global announcement-card"><div class="announcement-header"><i class="fa-solid fa-bullhorn announcement-icon"></i><h3>TRJA Memo</h3></div><div class="announcement-content"><img src="'+a+'" alt="Gambar Lebaran" class="announcement-image"><p class="announcement-text">Selamat Hari Raya Idul Fitri 1445 H</p></div></div>',1)),s("div",B,[s("div",J,[o[10]||(o[10]=s("div",{class:"info-header"},[s("i",{class:"fa-solid fa-map-marker-alt"}),s("h4",null,"Lokasi GPS Anda")],-1)),s("div",j,[s("div",G,[o[6]||(o[6]=s("span",{class:"info-label"},"Latitude:",-1)),s("span",H,i(y.value.lat),1)]),s("div",K,[o[7]||(o[7]=s("span",{class:"info-label"},"Longitude:",-1)),s("span",q,i(y.value.lon),1)]),s("div",z,[o[8]||(o[8]=s("span",{class:"info-label"},"Jarak:",-1)),Q.value.length>0?(t(),l("span",R,i(Q.value[0].distance+" Meter"),1)):(t(),l("span",V," Menghitung Jarak.. "))]),s("div",W,[o[9]||(o[9]=s("span",{class:"info-label"},"IPv4:",-1)),s("span",Y,i(w.value.ipv4),1)]),k.value?(t(),l("img",{key:0,src:k.value,alt:"GPS Map",class:"map-image"},null,8,Z)):n("",!0)])])])])])}}};export{Q as default};
//# sourceMappingURL=AbsensiView-hcVqApnn.js.map
