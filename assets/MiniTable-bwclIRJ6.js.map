{"version":3,"file":"MiniTable-bwclIRJ6.js","sources":["../../src/components/MiniTable.vue"],"sourcesContent":["<script setup>\r\nimport { ref, onMounted, computed } from 'vue';\r\nimport axios from 'axios';\r\n\r\nconst props = defineProps({\r\n  settings: Object,\r\n  urls: Object,\r\n  fields: Object\r\n});\r\n\r\nconst rawData = ref([]);\r\nconst searchQuery = ref('');\r\nconst columnFilters = ref({});\r\nconst uniqueValues = ref({});\r\nconst sort = ref({\r\n  column: null,\r\n  ascending: true\r\n});\r\n\r\nconst currentPage = ref(1);\r\nconst itemsPerPage = ref(10);\r\nconst itemsPerPageOptions = [10, 25, 50, 100];\r\n\r\nconst isDropdown = (columnName) => {\r\n  return props.fields.columns.some(col => col.column === columnName && col.dropdown);\r\n};\r\nconst checkType = (type, col) => {\r\n  return props.fields[type]?.includes(col) || false;\r\n};\r\n\r\nconst getMergedValue = (item, column) => {\r\n  const mergeDef = props.fields.merge.find(m => m.to === column);\r\n  if (mergeDef) {\r\n    for (let i = mergeDef.fields.length - 1; i >= 0; i--) {\r\n      const field = mergeDef.fields[i];\r\n      const value = item[field];\r\n      if (value !== null && value !== '') {\r\n        return value;\r\n      }\r\n    }\r\n    return '';\r\n  }\r\n  return item[column];\r\n};\r\n\r\nconst fetchData = async () => {\r\n  try {\r\n    const response = await axios.get(props.urls.data);\r\n    rawData.value = response.data;\r\n\r\n    // Build dropdown values\r\n    props.fields.columns.forEach(col => {\r\n      if (isDropdown(col.column)) {\r\n        uniqueValues.value[col.column] = [...new Set(rawData.value.map(item => item[col.column]))];\r\n      }\r\n    });\r\n  } catch (error) {\r\n    console.error(\"Fetch error:\", error);\r\n  }\r\n  // console.log(\"CHECKBOX \", isCheckbox(\"spare_exists\"));\r\n};\r\n\r\nconst filteredData = computed(() => {\r\n  let result = rawData.value.filter(item => {\r\n    const matchesSearch = searchQuery.value === '' ||\r\n      Object.values(item).join(' ').toLowerCase().includes(searchQuery.value.toLowerCase());\r\n\r\n    const matchesColumnFilters = Object.entries(columnFilters.value).every(([key, val]) => {\r\n      if (!val) return true;\r\n      const lowerVal = val.toLowerCase();\r\n\r\n      const mergeDef = props.fields.merge.find(m => m.to === key);\r\n      if (mergeDef) {\r\n        return mergeDef.fields.some(f => (item[f] || '').toString().toLowerCase().includes(lowerVal));\r\n      }\r\n\r\n      return (item[key] || '').toString().toLowerCase().includes(lowerVal);\r\n    });\r\n\r\n    return matchesSearch && matchesColumnFilters;\r\n  });\r\n\r\n  if (sort.value.column) {\r\n    result.sort((a, b) => {\r\n      const valA = getMergedValue(a, sort.value.column);\r\n      const valB = getMergedValue(b, sort.value.column);\r\n\r\n      if (valA < valB) return sort.value.ascending ? -1 : 1;\r\n      if (valA > valB) return sort.value.ascending ? 1 : -1;\r\n      return 0;\r\n    });\r\n  }\r\n\r\n  return result;\r\n});\r\n\r\nconst toggleSort = (column) => {\r\n  if (sort.value.column === column) {\r\n    sort.value.ascending = !sort.value.ascending;\r\n  } else {\r\n    sort.value.column = column;\r\n    sort.value.ascending = true;\r\n  }\r\n};\r\n\r\n\r\nconst totalPages = computed(() => {\r\n  return Math.ceil(filteredData.value.length / itemsPerPage.value);\r\n});\r\n\r\nconst paginatedData = computed(() => {\r\n  const start = (currentPage.value - 1) * itemsPerPage.value;\r\n  return filteredData.value.slice(start, start + itemsPerPage.value);\r\n});\r\n\r\nconst goToPage = (page) => {\r\n  if (page >= 1 && page <= totalPages.value) {\r\n    currentPage.value = page;\r\n  }\r\n};\r\n\r\nconst paginationWindow = computed(() => {\r\n  const total = totalPages.value;\r\n  const current = currentPage.value;\r\n  const delta = 2;\r\n  const range = [];\r\n\r\n  const start = Math.max(2, current - delta);\r\n  const end = Math.min(total - 1, current + delta);\r\n\r\n  for (let i = start; i <= end; i++) {\r\n    range.push(i);\r\n  }\r\n\r\n  if (start > 2) range.unshift('...');\r\n  if (end < total - 1) range.push('...');\r\n\r\n  range.unshift(1);\r\n  if (total > 1) range.push(total);\r\n\r\n  return range;\r\n});\r\n\r\nonMounted(fetchData);\r\n</script>\r\n\r\n<template>\r\n  <div class=\"container mt-4\">\r\n    <div class=\"card p-4 shadow-sm\">\r\n      <!-- Header -->\r\n      <div class=\"d-flex justify-content-between align-items-center mb-3\">\r\n        <h2 class=\"fw-bold\">{{ settings.title }}</h2>\r\n        <input \r\n          type=\"text\" \r\n          class=\"form-control w-25\" \r\n          :placeholder=\"settings.searchText || 'Search...'\" \r\n          v-model=\"searchQuery\" \r\n        />\r\n      </div>\r\n\r\n      <!-- Table -->\r\n      <div class=\"table-responsive\">\r\n        <table class=\"table table-hover align-middle\">\r\n          <thead class=\"table-light\">\r\n            <tr class=\"filter-row\">\r\n              <th v-for=\"col in fields.columns\" :key=\"'filter-' + col.column\">\r\n                <template v-if=\"col.filterText\">\r\n                  <input \r\n                    v-if=\"!isDropdown(col.column)\" \r\n                    type=\"text\" \r\n                    class=\"form-control form-control-sm\" \r\n                    :placeholder=\"col.filterText\" \r\n                    v-model=\"columnFilters[col.column]\" \r\n                  />\r\n                  <select \r\n                    v-else \r\n                    class=\"form-select form-select-sm\" \r\n                    v-model=\"columnFilters[col.column]\"\r\n                  >\r\n                    <option :value=\"''\">{{ col.filterText }}</option>\r\n                    <option \r\n                      v-for=\"val in uniqueValues[col.column] || []\" \r\n                      :key=\"val\" \r\n                      :value=\"val\"\r\n                    >\r\n                      {{ val }}\r\n                    </option>\r\n                  </select>\r\n                </template>\r\n              </th>\r\n            </tr>\r\n            <tr>\r\n              <th v-for=\"col in fields.columns\" :key=\"'header-' + col.column\"     @click=\"toggleSort(col.column)\"\r\n              class=\"sortable\">\r\n                {{ col.label }}\r\n                <span v-if=\"sortBy === col.column\">\r\n                {{ sort.ascending === 'asc' ? '▲' : '▼' }}\r\n              </span>\r\n              </th>\r\n            </tr>\r\n          </thead>\r\n          <tbody>\r\n            <tr \r\n              v-for=\"item in paginatedData\" \r\n              :key=\"item.id\" \r\n              class=\"clickable-row\"\r\n            >\r\n              <td \r\n                v-for=\"col in fields.columns\" \r\n                :key=\"'cell-' + col.column\"\r\n                contenteditable\r\n              >\r\n              <template v-if=\"checkType('checkbox', col.column)\">\r\n              <input \r\n                type=\"checkbox\" \r\n                :checked=\"Boolean(parseInt(getMergedValue(item, col.column)))\"\r\n                style=\"align-content: center;\"\r\n              />\r\n            </template>\r\n            <template v-else-if=\"checkType('datetime', col.column)\">\r\n              <input \r\n                type=\"datetime-local\"\r\n                v-model=\"item[col.column]\"\r\n                style=\"font-size: 9px;\"\r\n              />\r\n            </template>\r\n            <template v-else>\r\n              {{ getMergedValue(item, col.column) }}\r\n            </template>\r\n              </td>\r\n            </tr>\r\n            <tr v-if=\"paginatedData.length === 0\">\r\n              <td :colspan=\"fields.columns.length\" class=\"text-center text-muted py-4\">\r\n                No data found\r\n              </td>\r\n            </tr>\r\n          </tbody>\r\n        </table>\r\n      </div>\r\n\r\n      <!-- Pagination -->\r\n      <div class=\"d-flex justify-content-between align-items-center mt-3 flex-wrap gap-2\">\r\n        <div class=\"d-flex align-items-center gap-2\">\r\n          <label for=\"itemsPerPage\" class=\"form-label mb-0\">Rows per page:</label>\r\n          <select \r\n            id=\"itemsPerPage\"\r\n            class=\"form-select form-select-sm w-auto\"\r\n            v-model=\"itemsPerPage\"\r\n          >\r\n            <option v-for=\"option in itemsPerPageOptions\" :key=\"option\" :value=\"option\">\r\n              {{ option }}\r\n            </option>\r\n          </select>\r\n        </div>\r\n\r\n        <div>\r\n          Showing {{ paginatedData.length }} of {{ filteredData.length }} filtered results\r\n        </div>\r\n\r\n        <nav>\r\n          <ul class=\"pagination mb-0\">\r\n            <li class=\"page-item\" :class=\"{ disabled: currentPage === 1 }\">\r\n              <button class=\"page-link\" @click=\"goToPage(currentPage - 1)\">«</button>\r\n            </li>\r\n\r\n            <li \r\n              v-for=\"page in paginationWindow\" \r\n              :key=\"'page-' + page\" \r\n              class=\"page-item\" \r\n              :class=\"{ active: page === currentPage, disabled: page === '...'}\"\r\n            >\r\n              <button \r\n                class=\"page-link\" \r\n                @click=\"typeof page === 'number' && goToPage(page)\" \r\n                :disabled=\"page === '...'\"\r\n              >\r\n                {{ page }}\r\n              </button>\r\n            </li>\r\n\r\n            <li class=\"page-item\" :class=\"{ disabled: currentPage === totalPages }\">\r\n              <button class=\"page-link\" @click=\"goToPage(currentPage + 1)\">»</button>\r\n            </li>\r\n          </ul>\r\n        </nav>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<style scoped>\r\n.table {\r\n  table-layout: fixed;\r\n}\r\ninput.form-control,\r\nselect.form-select,\r\ninput[type=\"datetime-local\"],\r\ninput[type=\"checkbox\"] {\r\n  border: 1px solid #000000 !important;\r\n  border-radius: 4px;\r\n}\r\nthead input,\r\nthead select {\r\n  border: 1px solid #000;\r\n  border-radius: 4px;\r\n  font-size: 13px;\r\n}\r\n\r\nth, td {\r\n  overflow: hidden;\r\n  text-overflow: ellipsis;\r\n  white-space: nowrap;\r\n  font-size: 14px;\r\n}\r\ninput.form-control,\r\nselect.form-select {\r\n  font-size: 13px; \r\n}\r\n.clickable-row {\r\n  cursor: pointer;\r\n}\r\n.page-link {\r\n  color: rgb(255, 255, 255) !important; \r\n}\r\n.page-item.active .page-link {\r\n  background-color: rgb(217, 0, 0); \r\n  border-color: rgb(217, 0, 0);\r\n}\r\n\r\n</style>"],"names":["props","__props","rawData","ref","searchQuery","columnFilters","uniqueValues","sort","column","ascending","currentPage","itemsPerPage","itemsPerPageOptions","isDropdown","columnName","fields","columns","some","col","dropdown","checkType","type","_a","includes","getMergedValue","item","mergeDef","merge","find","m","to","i","length","value","filteredData","computed","result","filter","matchesSearch","Object","values","join","toLowerCase","matchesColumnFilters","entries","every","key","val","lowerVal","f","toString","a","b","valA","valB","totalPages","Math","ceil","paginatedData","start","slice","goToPage","page","paginationWindow","total","current","range","max","end","min","push","unshift","onMounted","async","response","axios","get","urls","data","forEach","Set","map","error"],"mappings":"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"}