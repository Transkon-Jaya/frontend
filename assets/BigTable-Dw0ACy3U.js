import{u as e,r as l,o as a,G as o,c as t,g as n,a as u,m as d,t as i,E as s,f as c,b as r,z as v,v as p,d as m,h as f,V as w,q as b,p as h,B as y}from"./index-C57kw19F.js";import{V as k,u as g,w as x}from"./xlsx-Bzg_cIzL.js";import{s as C}from"./vue-multiselect-C1ZQBWzF.js";const U={class:"container-global mb-4"},I={key:2},V={key:3,class:"error"},_={class:"table-container"},O={key:0,class:"checkbox-container"},j=["checked","onClick"],$=["onUpdate:modelValue","onInput"],E=["value","onInput"],S=["onUpdate:modelValue","onInput"],N={key:5},R={class:"mb-2"},T={class:"table-container"},z={key:0,class:"checkbox-container"},D=["checked","onClick"],F=["onUpdate:modelValue","onInput"],L=["value","onInput"],q=["onUpdate:modelValue","onInput"],A={key:5},M={__name:"BigTable",props:{settings:{type:Object,required:!0},urls:{type:Object,required:!0},fields:{type:Object,required:!0},canInsert:{type:Boolean,default:!0},canUpdate:{type:Boolean,default:!0}},setup(M,{expose:W}){e();const B=M,P=l(),G=l(),H=l(),J=l(),K=l();P.value=B.settings,G.value=B.urls,H.value=B.fields,J.value=B.canInsert,K.value=B.canUpdate;const Q=P.value.size??[10,20,100];Array.isArray(H.value.toRemove)?H.value.toRemove.push("isEditing","filterable","vgt_id","originalIndex"):H.value.toRemove=["isEditing","filterable","vgt_id","originalIndex"];const X=l({data:[],dropdowns:[]}),Y=l([]);let Z=l([]);const ee=l([]),le=l([]),ae=l(!0),oe=l(null);l("150px");const te=l("100px"),ne=l(new Map),ue=l(new Map);let de=G.value.data;if(G.value.params){const e=new URLSearchParams(G.value.params).toString();de+=`?${e}`}const ie=async()=>{try{ae.value=!0;const e=await b.get(de);if(e.data.length>0){const l=H.value.priority||[],a=H.value.toRemove||[],o=H.value.unpriority||[],t=Object.keys(e.data[0]),n=l.filter((e=>t.includes(e)&&e!==H.value.firstCol.field&&!a.includes(e)&&!o.includes(e))),u=o.filter((e=>t.includes(e)&&e!==H.value.firstCol.field&&!a.includes(e)&&!n.includes(e))),d=t.filter((e=>!(n.includes(e)||u.includes(e)||e===H.value.firstCol.field||a.includes(e)||H.value.hidden.includes(e)))),i=[...n,...d,...u];Y.value=[{label:H.value.firstCol.label,field:H.value.firstCol.field,width:`${H.value.firstCol.width??80}px`,minWidth:"100px",sortable:!0,filterable:!1,editable:!1,frozen:!0,type:H.value.firstCol.type,headerClass:"custom-header"},...H.value.status?[{label:H.value.status.label??H.value.status.field.toUpperCase(),field:H.value.status.field,sortable:!1,filterable:!0,filterOptions:{enabled:!0,placeholder:"status"},editable:!1,type:"text",width:`${H.value.status.width??120}px`,minWidth:"100px",headerClass:"custom-header"}]:[],...i.map((l=>{var a,o,t,n,u;const d=H.value.checkbox.includes(l),i=!d&&e.data.every((e=>{const a=e[l];return!isNaN(Number(a))})),s=null==(o=null==(a=H.value)?void 0:a.columns)?void 0:o.find((e=>e.column===l));return{label:l.replace(/_/g," ").toUpperCase(),field:l,sortable:!0,filterable:!0,filterOptions:{enabled:!0,placeholder:`${l}`},editable:K.value&&!(null==(u=null==(n=null==(t=H.value)?void 0:t.uneditable)?void 0:n.includes)?void 0:u.call(n,l)),type:d?"checkbox":i?"number":"text",width:`${(null==s?void 0:s.width)??Math.max(...e.data.map((e=>String((null==e?void 0:e[l])??"").length)),l.length)*Q[0]+Q[1]}px`,minWidth:`${(null==s?void 0:s.minWidth)??Q[2]}px`,headerClass:"custome-header"}}))]}Z=h((()=>Y.value.map((e=>({...e,filterOptions:{enabled:!1},sortable:!1}))))),X.value.data=e.data.map((e=>({...e,filterable:!0}))),X.value.data=e.data.map((e=>{const l={};for(const a in e){const o=e[a];if(null==o)l[a]=o;else{const e=Number(o);l[a]=isNaN(e)?String(o):e}}return H.value.status&&H.value.status.calculate&&(l.status=H.value.status.calculate(e)),l.filterable=!0,l})),le.value=[...X.value.data],setTimeout(we,500)}catch(e){oe.value="Failed to fetch data"}finally{ae.value=!1,se()}},se=()=>{const e={};Y.value.forEach((l=>{e[l.field]=H.value.checkbox.includes(l.field)?0:""})),e.id=ee.value.length+1,ee.value.push(e)},ce=(e,l)=>{ue.value.has(e.id)?ue.value.get(e.id)[l]=e[l]:ue.value.set(e.id,{...e})},re=async()=>{try{const e=Array.from(ue.value.values());for(const l of e){const e={...l};for(const l of H.value.toRemove)delete e[l];delete e.id,H.value.date.forEach((l=>{null===e[l]||void 0===e[l]||isNaN(Date.parse(e[l]))||(e[l]=new Date(e[l]).toISOString().split("T")[0])})),Object.keys(e).forEach((l=>{""===e[l]&&(e[l]=null)})),await b.post(G.value.data,e),await ie(),ee.value=[],ue.value.clear(),window.location.reload()}}catch(e){alert("Failed to upload")}},ve=(e,l)=>{ne.value.has(e.id)?ne.value.get(e.id)[l]=e[l]:ne.value.set(e.id,{...e})},pe=async()=>{const e=Array.from(ne.value.values()),l=[];for(const o of e)try{const e=Object.fromEntries(Object.entries(o).filter((([e])=>!H.value.exclude.includes(e)&&!H.value.toRemove.includes(e))));H.value.date.forEach((l=>{null===e[l]||void 0===e[l]||isNaN(Date.parse(e[l]))||(e[l]=new Date(e[l]).toISOString().split("T")[0])})),await b.put(G.value.data,e)}catch(a){l.push(o.id)}l.length>0?alert(`Some rows failed to save: ${l.join(", ")}`):(alert("Changes saved successfully!"),window.location.reload(),ne.value.clear())},me=()=>{const e=g.json_to_sheet(le.value),l=g.book_new();g.book_append_sheet(l,e,"Marketing Data"),x(l,"Filtered_Marketing_Data.xlsx")},fe=e=>{le.value=e,y("Length : "+le.value.length),y("onTableFiltered : ",le.value)},we=()=>{const e=document.querySelector(".vue-good-table th:nth-child(1)");e&&(te.value=e.offsetWidth+"px"),document.documentElement.style.setProperty("--second-column-width",te.value)};W({datas:X,loading:ae,getLoading:()=>ae.value}),a((()=>{(async()=>{const e=Object.keys(G.value.dropdowns);for(const a of e){const e=G.value.dropdowns[a].url,o=G.value.dropdowns[a].valueField,t=G.value.dropdowns[a].labelField;try{const l=await b.get(e);X.value.dropdowns[t]=l.data.map((e=>e[o]??""))}catch(l){}}})(),ie(),window.addEventListener("resize",we)})),o((()=>{window.removeEventListener("resize",we)}));const be=e=>{if(e){const[l,a]=e.split(" ");return`${l}T${a.slice(0,5)}`}return""},he=e=>{if(e){const[l,a]=e.split("T");return`${l} ${`${a}:00`}`}return""};return l(!1),(e,l)=>(n(),t("div",U,[u("h2",null,i(P.value.title),1),J.value?(n(),t("button",{key:0,onClick:re},"Upload")):d("",!0),J.value?(n(),t("button",{key:1,onClick:se},"Add New Row")):d("",!0),ae.value?(n(),t("p",I,"Loading...")):d("",!0),oe.value?(n(),t("p",V,i(oe.value),1)):d("",!0),u("div",_,[ae.value||oe.value||!J.value?d("",!0):(n(),s(v(k),{key:0,columns:v(Z),rows:ee.value,"search-options":{enabled:!1},"sort-options":{enabled:!1},"line-numbers":!1,"select-options":{enabled:!1},"pagination-options":{enabled:!1},style:{"overflow-x":"auto"}},{"table-row":c((e=>[H.value.checkbox.includes(e.column.field)?(n(),t("div",O,[u("input",{type:"checkbox",name:"custom-checkbox",class:"custom-checkbox",checked:1==e.row[e.column.field],onClick:l=>{e.row[e.column.field]=l.target.checked?1:0,ce(e.row,e.column.field)}},null,8,j)])):Object.keys(X.value.dropdowns).includes(e.column.field)?(n(),s(v(C),{key:1,modelValue:e.row[e.column.field],"onUpdate:modelValue":[l=>e.row[e.column.field]=l,l=>(null==ce?void 0:ce(e.row,e.column.field))||(null==ve?void 0:ve(e.row,e.column.field))],options:X.value.dropdowns[e.column.field]||[],searchable:!0,"allow-empty":!1,placeholder:`Select ${e.column.field}`},null,8,["modelValue","onUpdate:modelValue","options","placeholder"])):H.value.date.includes(e.column.field)?r((n(),t("input",{key:2,type:"date","onUpdate:modelValue":l=>e.row[e.column.field]=l,onInput:l=>ce(e.row,e.column.field)},null,40,$)),[[p,e.row[e.column.field]]]):H.value.datetime.includes(e.column.field)?(n(),t("input",{key:3,type:"datetime-local",value:be(e.row[e.column.field]),onInput:l=>{return a=l,o=e.row,t=e.column.field,o[t]=he(a.target.value),void ce(o,t);var a,o,t}},null,40,E)):!1!==e.column.editable?r((n(),t("input",{key:4,"onUpdate:modelValue":l=>e.row[e.column.field]=l,onInput:l=>ce(e.row,e.column.field)},null,40,S)),[[p,e.row[e.column.field]]]):(n(),t("span",N,i(e.row[e.column.field]),1))])),_:1},8,["columns","rows"]))]),u("div",R,[m(w,{onClick:me,type:"submit",color:"danger",size:"md",block:!1,class:"me-2"},{default:c((()=>l[0]||(l[0]=[f("Export to Excel")]))),_:1}),K.value?(n(),s(w,{key:0,onClick:pe,type:"submit",color:"danger",size:"md",block:!1},{default:c((()=>l[1]||(l[1]=[f("Save Updates")]))),_:1})):d("",!0)]),u("div",T,[ae.value||oe.value?d("",!0):(n(),s(v(k),{key:0,columns:Y.value,rows:X.value.data,"pagination-options":{enabled:!0,mode:"pages",perPage:10},"search-options":{enabled:!0},"sort-options":{enabled:!0},style:{"overflow-x":"auto"},onOnFiltered:fe,styleClass:"vgt-table striped"},{"table-row":c((e=>[H.value.checkbox.includes(e.column.field)?(n(),t("div",z,[u("input",{type:"checkbox",class:"custom-checkbox",checked:1==e.row[e.column.field],onClick:l=>{e.row[e.column.field]=l.target.checked?1:0,ve(e.row,e.column.field)}},null,8,D)])):Object.keys(X.value.dropdowns).includes(e.column.field)&&K.value?(n(),s(v(C),{key:1,modelValue:e.row[e.column.field],"onUpdate:modelValue":[l=>e.row[e.column.field]=l,l=>(null==ce?void 0:ce(e.row,e.column.field))||(null==ve?void 0:ve(e.row,e.column.field))],options:X.value.dropdowns[e.column.field]||[],searchable:!0,"allow-empty":!1,placeholder:`Select ${e.column.field}`,noResultsText:"No matching results"},null,8,["modelValue","onUpdate:modelValue","options","placeholder"])):H.value.date.includes(e.column.field)?r((n(),t("input",{key:2,type:"date","onUpdate:modelValue":l=>e.row[e.column.field]=l,onInput:l=>ve(e.row,e.column.field)},null,40,F)),[[p,e.row[e.column.field]]]):H.value.datetime.includes(e.column.field)?(n(),t("input",{key:3,type:"datetime-local",value:be(e.row[e.column.field]),onInput:l=>{return a=l,o=e.row,t=e.column.field,o[t]=he(a.target.value),void ve(o,t);var a,o,t}},null,40,L)):!1!==e.column.editable?r((n(),t("input",{key:4,"onUpdate:modelValue":l=>e.row[e.column.field]=l,onInput:l=>ve(e.row,e.column.field)},null,40,q)),[[p,e.row[e.column.field]]]):(n(),t("span",A,i(e.row[e.column.field]),1))])),_:1},8,["columns","rows"]))])]))}};export{M as _};
//# sourceMappingURL=BigTable-Dw0ACy3U.js.map
