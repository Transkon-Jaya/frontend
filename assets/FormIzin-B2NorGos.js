import{_ as U,u as G,B as V,C as J,r as p,o as N,c as l,a as e,s as R,b as $,v as q,d as f,t as o,f as k,T as K,q as h,V as w,F,j as I,p as P,A as B,g as r,z as y,x as H,h as C}from"./index-BjyKRxJM.js";import{l as D}from"./logger-DsocdAuK.js";const O={class:"row"},Q={class:"col-xl-8 mx-auto"},W={class:"card mb-4"},X={class:"card-body p-4"},Y={class:"col-md-12"},Z={class:"col-md-12"},ee=["onClick"],ae={class:"col-md-12"},ne={key:0,class:"mt-3 d-flex align-items-center"},te=["src"],se={class:"col-md-12 mt-4 d-flex gap-3"},le={key:0,class:"spinner-border spinner-border-sm me-2",role:"status"},re={class:"card"},ie={class:"card-body p-4"},oe={key:0,class:"text-center py-4"},de={key:1,class:"text-center py-4"},ue={key:2,class:"table-responsive"},ce={class:"table table-hover"},pe={__name:"FormIzin",setup(ge){const g=G(),L=V(),s=J({keterangan:"",jenis:"",jenisLabel:""}),b=p([]),d=p(null),u=p(null),i=p(!1),m=p(!1),j=[{value:"datang telat",label:"Datang terlambat"},{value:"pulang cepat",label:"Pulang cepat"},{value:"izin",label:"Izin Tidak Masuk"},{value:"cuti",label:"Cuti"},{value:"dinas",label:"Perjalanan Dinas"}],A=n=>{const a=n.target.files[0];if(!a){d.value=null,u.value=null;return}const t=["jpg","jpeg","png","gif"],c=a.name.split(".").pop().toLowerCase();if(!t.includes(c)){alert("Hanya file gambar (JPG, JPEG, PNG, GIF) yang diperbolehkan"),n.target.value="";return}if(a.size>5*1024*1024){alert("Ukuran file maksimal 5MB"),n.target.value="";return}d.value=a;const v=new FileReader;v.onload=T=>{u.value=T.target.result},v.readAsDataURL(a)},z=()=>{d.value=null,u.value=null;const n=document.getElementById("foto");n&&(n.value="")},_=async()=>{try{i.value=!0;const n=await P.get(`${B}/perizinan`,{headers:{Authorization:`Bearer ${g.token}`},params:{username:g.username}});b.value=n.data}catch(n){D("Fetch error:",n),alert("Gagal mengambil data perizinan")}finally{i.value=!1}},x=()=>{s.keterangan="",s.jenis="",s.jenisLabel="",z()},S=async()=>{try{if(!s.keterangan.trim()){alert("Keterangan tidak boleh kosong");return}if(!s.jenis){alert("Pilih jenis perizinan");return}if(!d.value){alert("Upload foto bukti terlebih dahulu");return}const n=new FormData;n.append("username",g.username),n.append("keterangan",s.keterangan),n.append("izin",s.jenis),n.append("picture",d.value),i.value=!0;const a=await P.post(`${B}/perizinan`,n,{headers:{Authorization:`Bearer ${g.token}`,"Content-Type":"multipart/form-data"}});if(a.data.status!==200)throw new Error(a.data.error||"Gagal mengajukan perizinan");alert("Pengajuan perizinan berhasil dikirim!"),x(),_()}catch(n){D("Submit error:",n),alert(n.message||"Gagal mengajukan perizinan. Silakan coba lagi.")}finally{i.value=!1}},E=()=>{m.value=!m.value},M=n=>{s.jenis=n.value,s.jenisLabel=n.label,m.value=!1};return N(()=>{_()}),(n,a)=>(r(),l("div",O,[e("div",Q,[e("div",W,[a[6]||(a[6]=e("div",{class:"card-header px-4 py-3"},[e("h5",{class:"mb-0"},"Ajukan Perizinan")],-1)),e("div",X,[e("form",{onSubmit:R(S,["prevent"]),class:"row g-3"},[e("div",Y,[a[1]||(a[1]=e("label",{for:"keterangan",class:"form-label"},"Keterangan",-1)),$(e("textarea",{"onUpdate:modelValue":a[0]||(a[0]=t=>s.keterangan=t),class:"form-control",id:"keterangan",rows:"3",placeholder:"Masukkan keterangan perizinan",required:""},null,512),[[q,s.keterangan]])]),e("div",Z,[a[3]||(a[3]=e("label",{class:"form-label"},"Jenis Izin",-1)),e("div",{class:"dropdown-selected d-flex justify-content-between align-items-center px-3 py-2 border rounded",onClick:E},[e("span",null,o(s.jenisLabel||"Pilih jenis izin"),1),a[2]||(a[2]=e("i",{class:"bi bi-chevron-down"},null,-1))]),f(K,{name:"slide-fade"},{default:k(()=>[m.value?(r(),l("div",{key:0,class:y(["dropdown-options border rounded mt-1",H(L).darkMode?"bg-dark text-white border-secondary":"bg-white text-dark border-secondary"])},[(r(),l(F,null,I(j,t=>e("div",{key:t.value,class:"dropdown-option px-3 py-2",onClick:c=>M(t)},o(t.label),9,ee)),64))],2)):h("",!0)]),_:1})]),e("div",ae,[a[4]||(a[4]=e("label",{for:"foto",class:"form-label"},"Upload Foto Bukti",-1)),e("input",{type:"file",class:"form-control",id:"foto",onChange:A,accept:"image/jpeg, image/png, image/jpg",required:""},null,32),u.value?(r(),l("div",ne,[e("img",{src:u.value,alt:"Preview Foto Bukti",class:"img-thumbnail",style:{"max-width":"200px","max-height":"200px"}},null,8,te),e("button",{type:"button",class:"btn btn-sm btn-outline-danger ms-2",onClick:z}," Hapus ")])):h("",!0)]),e("div",se,[f(w,{type:"submit",color:"primary",size:"md",disabled:i.value},{default:k(()=>[i.value?(r(),l("span",le)):h("",!0),C(" "+o(i.value?"Mengirim...":"Ajukan Perizinan"),1)]),_:1},8,["disabled"]),f(w,{type:"button",color:"secondary",size:"md",onClick:x},{default:k(()=>a[5]||(a[5]=[C(" Reset ")])),_:1})])],32)])]),e("div",re,[a[10]||(a[10]=e("div",{class:"card-header px-4 py-3"},[e("h5",{class:"mb-0"},"Riwayat Perizinan")],-1)),e("div",ie,[i.value&&!b.value.length?(r(),l("div",oe,a[7]||(a[7]=[e("div",{class:"spinner-border text-primary",role:"status"},[e("span",{class:"visually-hidden"},"Loading...")],-1)]))):b.value.length?(r(),l("div",ue,[e("table",ce,[a[9]||(a[9]=e("thead",null,[e("tr",null,[e("th",null,"Tanggal"),e("th",null,"Jenis Izin"),e("th",null,"Keterangan"),e("th",null,"Status"),e("th",null,"Feedback")])],-1)),e("tbody",null,[(r(!0),l(F,null,I(b.value,t=>{var c;return r(),l("tr",{key:t.id},[e("td",null,o(new Date(t.createdAt).toLocaleDateString()),1),e("td",null,[e("span",{class:y(["badge",{"bg-info":t.jenis==="datang telat","bg-warning":t.jenis==="pulang cepat","bg-danger":t.jenis==="izin","bg-primary":t.jenis==="cuti","bg-success":t.jenis==="dinas"}])},o(((c=j.find(v=>v.value===t.jenis))==null?void 0:c.label)||t.jenis),3)]),e("td",null,o(t.keterangan),1),e("td",null,[e("span",{class:y(["badge",{"bg-secondary":t.status==="pending","bg-success":t.status==="approved","bg-danger":t.status==="rejected"}])},o(t.status),3)]),e("td",null,o(t.feedback||"-"),1)])}),128))])])])):(r(),l("div",de,a[8]||(a[8]=[e("p",{class:"text-muted"},"Belum ada data perizinan",-1)])))])])])]))}},ve=U(pe,[["__scopeId","data-v-863fb932"]]);export{ve as default};
