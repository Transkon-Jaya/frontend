import{u as T,r as b,n as O,o as _,p as N,c as x,a,s as $,q as F,b as r,v as n,d as B,f as k,V as R,g as P,h as D,B as q}from"./index-DFdw_Vgd.js";import{l as H}from"./logger-DsocdAuK.js";const W={class:"row"},G={class:"col-xl-6 mx-auto"},J={class:"card"},K={class:"card-body p-4"},Q={class:"col-md-12"},X={class:"col-md-12"},Y={class:"col-md-12"},Z={class:"col-md-12"},ee={class:"col-md-12"},ae={class:"col-md-12"},se={class:"col-md-12"},oe={class:"col-md-12"},te={key:0,class:"text-danger"},le={class:"col-md-12"},re={key:0,class:"mt-3"},ne=["src"],de={class:"col-md-12 mt-4 mb-3 d-flex gap-3"},m="Loading...",pe={__name:"ProfileView",setup(ie){const d=T(),h=d.apiBaseUrl+"/profile",s=b({name:m,email:m,phone:m,department:m,position:m,username:m,password:"",confirmPassword:""}),t=new FormData,i=b(),u=b(null),p=b(null),z=l=>new Promise(e=>{const o=new FileReader;o.onload=S=>{const c=new Image;c.onload=()=>{const v=document.createElement("canvas"),j=v.getContext("2d");v.width=600,v.height=800;const y=c.width/c.height;let f,w;y>600/800?(w=800,f=800*y):(f=600,w=600/y);const I=(600-f)/2,M=(800-w)/2;j.drawImage(c,I,M,f,w),v.toBlob(V=>{const A=new File([V],l.name,{type:"image/jpeg",lastModified:Date.now()});p.value=URL.createObjectURL(V),e(A)},"image/jpeg",.9)},c.src=S.target.result},o.readAsDataURL(l)}),C=async l=>{const e=l.target.files[0];if(e)try{u.value=await z(e)}catch(o){console.error("Error resizing image:",o),u.value=e,p.value=URL.createObjectURL(e)}},g=O(()=>s.value.password!==s.value.confirmPassword);_(async()=>{try{const l=await N.get(h,{headers:{Authorization:`Bearer ${d.token}`},params:{username:d.username}});i.value=l.data[0],U()}catch(l){console.error("Fetch error:",l)}});const U=()=>{s.value.name=i.value.name,s.value.email=i.value.email,s.value.phone=i.value.phone,s.value.department=i.value.department,s.value.position=i.value.jabatan,s.value.username=d.username,s.value.password="",s.value.confirmPassword=""},E=()=>{U(),u.value=null,p.value=null},L=async()=>{if(!g.value)try{t.delete("name"),t.delete("email"),t.delete("phone"),t.delete("department"),t.delete("position"),t.delete("username"),t.delete("password"),t.delete("profilePicture"),t.append("name",s.value.name),t.append("email",s.value.email),t.append("phone",s.value.phone),t.append("department",s.value.department),t.append("position",s.value.position),t.append("username",s.value.username),s.value.password&&t.append("password",s.value.password),u.value&&t.append("profilePicture",u.value);const l=await N.post(h,t,{headers:{Authorization:`Bearer ${d.token}`}});d.setProfile(l.data.photo),await q(),window.location.reload(),alert("Profile updated successfully!")}catch(l){H("Submit error:",l),alert("Error updating profile.")}};return(l,e)=>(P(),x("div",W,[a("div",G,[a("div",J,[e[20]||(e[20]=a("div",{class:"card-header px-4 py-3"},[a("h5",{class:"mb-0"},"User Settings")],-1)),a("div",K,[a("form",{onSubmit:$(L,["prevent"]),class:"row g-3 needs-validation",novalidate:""},[a("div",Q,[e[8]||(e[8]=a("label",{for:"Name",class:"form-label"},"Name",-1)),r(a("input",{"onUpdate:modelValue":e[0]||(e[0]=o=>s.value.name=o),type:"text",class:"form-control",id:"firstName",disabled:""},null,512),[[n,s.value.name]])]),a("div",X,[e[9]||(e[9]=a("label",{for:"phone",class:"form-label"},"E-mail",-1)),r(a("input",{"onUpdate:modelValue":e[1]||(e[1]=o=>s.value.email=o),type:"text",class:"form-control",id:"email"},null,512),[[n,s.value.email]])]),a("div",Y,[e[10]||(e[10]=a("label",{for:"phone",class:"form-label"},"Phone",-1)),r(a("input",{"onUpdate:modelValue":e[2]||(e[2]=o=>s.value.phone=o),type:"text",class:"form-control",id:"phone"},null,512),[[n,s.value.phone]])]),a("div",Z,[e[11]||(e[11]=a("label",{for:"department",class:"form-label"},"Department",-1)),r(a("input",{"onUpdate:modelValue":e[3]||(e[3]=o=>s.value.department=o),type:"text",class:"form-control",id:"department",disabled:""},null,512),[[n,s.value.department]])]),a("div",ee,[e[12]||(e[12]=a("label",{for:"position",class:"form-label"},"Position",-1)),r(a("input",{"onUpdate:modelValue":e[4]||(e[4]=o=>s.value.position=o),type:"text",class:"form-control",id:"position",disabled:""},null,512),[[n,s.value.position]])]),a("div",ae,[e[13]||(e[13]=a("label",{for:"userName",class:"form-label"},"User Name",-1)),r(a("input",{"onUpdate:modelValue":e[5]||(e[5]=o=>s.value.username=o),type:"userName",class:"form-control",id:"userName",disabled:""},null,512),[[n,s.value.username]])]),a("div",se,[e[14]||(e[14]=a("label",{for:"password",class:"form-label"},"Password",-1)),r(a("input",{"onUpdate:modelValue":e[6]||(e[6]=o=>s.value.password=o),type:"password",class:"form-control",id:"password"},null,512),[[n,s.value.password]])]),a("div",oe,[e[15]||(e[15]=a("label",{for:"confirmationPassword",class:"form-label"},"Confirm Password",-1)),r(a("input",{"onUpdate:modelValue":e[7]||(e[7]=o=>s.value.confirmPassword=o),type:"password",class:"form-control",id:"confirmationPassword"},null,512),[[n,s.value.confirmPassword]])]),g.value?(P(),x("small",te," Passwords do not match! ")):F("",!0),a("div",le,[e[17]||(e[17]=a("label",{for:"photo",class:"form-label"},"Upload Photo",-1)),a("input",{type:"file",class:"form-control",id:"photo",onChange:C,accept:"image/*"},null,32),p.value?(P(),x("div",re,[a("img",{src:p.value,alt:"Preview",class:"img-thumbnail",style:{"max-width":"200px"}},null,8,ne),e[16]||(e[16]=a("p",{class:"text-muted mt-2"},"Image will be resized to 600x800 pixels",-1))])):F("",!0)]),a("div",de,[B(R,{type:"submit",class:"btn btn-danger",disabled:g.value},{default:k(()=>e[18]||(e[18]=[D("Submit ")])),_:1},8,["disabled"]),B(R,{type:"reset",class:"btn btn-secondary",onClick:E},{default:k(()=>e[19]||(e[19]=[D(" Reset ")])),_:1})])],32)])])])]))}};export{pe as default};
