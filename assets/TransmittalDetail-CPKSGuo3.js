import{_ as le,u as ae,r as v,o as oe,n as R,c as o,a as e,q as A,h as w,t as r,F as y,j as x,b as u,k as $,z as S,s as ne,v as m,p as O,A as F,g as n}from"./index-CFqpVhRV.js";const re={class:"card border-0 shadow-sm"},de={class:"card-header"},ie={class:"d-flex justify-content-between align-items-center"},ue=["disabled"],ce={class:"card-body"},me={key:0,class:"alert alert-danger alert-dismissible fade show"},ve={key:1,class:"text-center py-5"},pe={key:2,class:"table-responsive"},be={class:"table table-hover table-striped table-bordered mb-0"},fe={class:"table-dark"},_e=["onUpdate:modelValue","placeholder"],ge={key:0},ye=["colspan"],xe={class:"text-center font-mono"},ke={class:"text-center"},we={class:"text-center"},he={class:"text-center"},Ce={class:"text-center"},De={class:"text-center"},Ae={class:"text-center"},Ve={class:"text-center"},Ue={class:"btn-group btn-group-sm"},Te=["onClick"],$e=["onClick"],Se={class:"d-flex flex-wrap justify-content-between align-items-center mt-3"},Oe={class:"d-flex align-items-center mb-2"},Fe=["value"],Pe={class:"text-muted"},Be={class:"pagination pagination-sm mb-0"},Ie={class:"page-item disabled"},Ee={class:"page-link"},Ne={key:0,class:"modal fade show d-block",style:{background:"rgba(0,0,0,0.5)"}},je={class:"modal-dialog modal-dialog-centered modal-lg"},Re={class:"modal-content border-0 shadow"},Me={class:"modal-header bg-danger text-white"},qe={class:"modal-title"},ze={class:"modal-body"},Le={class:"row g-3"},Je={class:"col-md-6"},He=["disabled"],We={class:"col-md-6"},Ge={class:"col-md-6"},Ke=["value"],Qe={class:"col-md-6"},Xe={class:"col-md-6"},Ye=["value"],Ze={class:"col-md-6"},et={class:"col-md-6"},tt={class:"col-md-6"},st={class:"table table-sm table-bordered mt-2"},lt=["onUpdate:modelValue"],at=["onUpdate:modelValue"],ot={class:"text-center"},nt=["onClick"],rt={class:"col-md-6"},dt={class:"col-md-6"},it={class:"col-md-6"},ut={class:"col-md-6"},ct={class:"col-md-6"},mt=["value"],vt={key:1,class:"modal fade show d-block",style:{background:"rgba(0,0,0,0.5)"}},pt={class:"modal-dialog modal-dialog-centered"},bt={class:"modal-content border-0 shadow"},ft={class:"modal-body"},_t={__name:"TransmittalDetail",setup(gt){const V=ae(),h=v([]),_=v({fromOrigins:[],companies:[],statuses:["","Pending","Received","Completed"]}),P=v(!0),f=v(null),B=v(!1),C=v(!1),l=v({date:"",from_origin:"",document_type:"",attention:"",company:"",address:"",state:"",awb_reg:"",expeditur:"",receiver_name:"",receive_date:"",ras_status:"",doc_details:[]}),k=v({ta_id:"",from_origin:"",document_type:"",company:"",ras_status:""}),g=v(10),p=v(1),H=[10,20,50,{value:-1,text:"All"}],M=[{text:"TA ID",value:"ta_id",align:"center",sortable:!0,filterable:!0},{text:"Date",value:"date",align:"center",sortable:!0,filterable:!0},{text:"From Origin",value:"from_origin",align:"center",sortable:!0,filterable:!0},{text:"Document Type",value:"document_type",align:"center",sortable:!0,filterable:!0},{text:"Company",value:"company",align:"center",sortable:!0,filterable:!0},{text:"Status",value:"ras_status",align:"center",sortable:!0,filterable:!0},{text:"Docs",value:"document_count",align:"center",sortable:!1,filterable:!1},{text:"Actions",value:"actions",align:"center",sortable:!1,filterable:!1}],I=async()=>{var a,t,d,s,i,b;try{const c=await O.get(`${F}/transmittal`,{headers:{Authorization:`Bearer ${V.token}`}});console.log("Raw response data:",c.data);let j=[];if(typeof c.data=="string"){f.value="Invalid JSON response from server (possibly PHP errors)",console.error("Raw string response:",c.data);const L=c.data.match(/\{.*\}/s);if(L){const se=L[0];try{j=((a=JSON.parse(se).data)==null?void 0:a.items)||[]}catch(J){console.error("Failed to parse cleaned JSON",J)}}}else j=((d=(t=c.data)==null?void 0:t.data)==null?void 0:d.items)||((s=c.data)==null?void 0:s.items)||[];h.value=j,W()}catch(c){f.value="Failed to load data: "+(((b=(i=c.response)==null?void 0:i.data)==null?void 0:b.error)||c.message),console.error("API Error:",c)}},W=()=>{_.value.fromOrigins=[...new Set(h.value.map(a=>a.from_origin).filter(Boolean))],_.value.companies=[...new Set(h.value.map(a=>a.company).filter(Boolean))]};oe(async()=>{try{await I()}catch(a){console.error("Mount error:",a)}});const U=R(()=>h.value.length?h.value.filter(a=>Object.entries(k.value).every(([t,d])=>{if(!d)return!0;const s=a[t]||"";return String(s).toLowerCase().includes(d.toLowerCase())})):[]),E=R(()=>{if(g.value===-1)return U.value;const a=(p.value-1)*g.value;return U.value.slice(a,a+g.value)}),q=R(()=>g.value===-1?1:Math.ceil(U.value.length/g.value)),G=()=>{l.value={date:"",from_origin:_.value.fromOrigins[0]||"",document_type:"",attention:"",company:_.value.companies[0]||"",address:"",state:"",awb_reg:"",expeditur:"",receiver_name:"",receive_date:"",ras_status:"",doc_details:[]},C.value=!0},K=async a=>{var t,d;try{P.value=!0;const s=await O.get(`${F}/transmittal?ta_id=${a.ta_id}`,{headers:{Authorization:`Bearer ${V.token}`,"Content-Type":"application/json"}});l.value={...s.data.data,doc_details:Array.isArray(s.data.data.doc_details)?s.data.data.doc_details:[]},B.value=!0}catch(s){f.value="Failed to load data: "+(((d=(t=s.response)==null?void 0:t.data)==null?void 0:d.error)||s.message)}finally{P.value=!1}},Q=async()=>{var a,t,d,s;try{if(!l.value.date||!l.value.from_origin)throw new Error("Date and From Origin are required");const i={headers:{"Content-Type":"application/json",Authorization:`Bearer ${V.token}`}},b=`${F}/transmittal`,c=await O.post(b,l.value,i);if(c.data.status===200)await I(),N();else throw new Error(c.data.error||"Save failed")}catch(i){console.error("Save error:",i),f.value=((t=(a=i.response)==null?void 0:a.data)==null?void 0:t.error)||((s=(d=i.response)==null?void 0:d.data)==null?void 0:s.message)||i.message||"Failed to save transmittal"}},T=v(null),D=v(!1),X=a=>{T.value=a,D.value=!0},Y=async()=>{var a,t;try{await O.delete(`${F}/transmittal?ta_id=${T.value.ta_id}`,{headers:{Authorization:`Bearer ${V.token}`,"Content-Type":"application/json"}}),D.value=!1,await I()}catch(d){f.value="Delete failed: "+(((t=(a=d.response)==null?void 0:a.data)==null?void 0:t.error)||d.message),D.value=!1}},z=()=>{D.value=!1,T.value=null},N=()=>{B.value=!1,C.value=!1,l.value={}},Z=()=>{Object.keys(k.value).forEach(a=>{k.value[a]=""}),p.value=1},ee=()=>{l.value.doc_details.push({doc_desc:"",remarks:""})},te=a=>{l.value.doc_details.splice(a,1)};return(a,t)=>{var d;return n(),o("div",re,[e("div",de,[e("div",ie,[t[21]||(t[21]=e("h3",{class:"mb-0"},"Transmittal Management",-1)),e("div",null,[e("button",{onClick:Z,class:"btn btn-sm btn-light me-2",disabled:!Object.values(k.value).some(Boolean)},t[19]||(t[19]=[e("i",{class:"fas fa-filter-circle-xmark me-1"},null,-1),w(" Reset Filters ")]),8,ue),e("button",{onClick:G,class:"btn btn-sm btn-danger"},t[20]||(t[20]=[e("i",{class:"fas fa-plus me-1"},null,-1),w(" Add New ")]))])])]),e("div",ce,[f.value?(n(),o("div",me,[w(r(f.value)+" ",1),e("button",{type:"button",class:"btn-close",onClick:t[0]||(t[0]=s=>f.value=null)})])):A("",!0),P.value?(n(),o("div",ve,t[22]||(t[22]=[e("div",{class:"spinner-border text-primary",role:"status"},null,-1),e("p",{class:"mt-2"},"Loading...",-1)]))):(n(),o("div",pe,[e("table",be,[e("thead",fe,[e("tr",null,[(n(),o(y,null,x(M,s=>e("th",{key:s.value,class:S({"filter-cell":s.filterable})},[e("div",null,r(s.text),1),s.filterable?u((n(),o("input",{key:0,"onUpdate:modelValue":i=>k.value[s.value]=i,type:"text",class:"form-control form-control-sm mt-1 text-center",placeholder:`Filter ${s.text}`,onInput:t[1]||(t[1]=i=>p.value=1)},null,40,_e)),[[m,k.value[s.value]]]):A("",!0)],2)),64))])]),e("tbody",null,[E.value.length===0?(n(),o("tr",ge,[e("td",{colspan:M.length,class:"text-center py-4"},"No data available",8,ye)])):A("",!0),(n(!0),o(y,null,x(E.value,s=>(n(),o("tr",{key:s.ta_id,class:"align-middle"},[e("td",xe,r(s.ta_id),1),e("td",ke,r(s.date),1),e("td",we,r(s.from_origin),1),e("td",he,r(s.document_type),1),e("td",Ce,r(s.company),1),e("td",De,[e("span",{class:S(`badge ${s.ras_status==="Pending"?"bg-warning":s.ras_status==="Received"?"bg-info":"bg-success"}`)},r(s.ras_status),3)]),e("td",Ae,r(s.document_count),1),e("td",Ve,[e("div",Ue,[e("button",{onClick:i=>K(s),class:"btn btn-warning",title:"Edit"},t[23]||(t[23]=[e("i",{class:"fas fa-edit"},null,-1)]),8,Te),e("button",{onClick:i=>X(s),class:"btn btn-danger",title:"Delete"},t[24]||(t[24]=[e("i",{class:"fas fa-trash-alt"},null,-1)]),8,$e)])])]))),128))])])])),e("div",Se,[e("div",Oe,[u(e("select",{"onUpdate:modelValue":t[2]||(t[2]=s=>g.value=s),class:"form-select form-select-sm me-2",style:{width:"90px"},onChange:t[3]||(t[3]=s=>p.value=1)},[(n(),o(y,null,x(H,s=>e("option",{key:s.value||s,value:s.value||s},r(s.text||s),9,Fe)),64))],544),[[$,g.value]]),e("small",Pe," Showing "+r(E.value.length)+" of "+r(U.value.length),1)]),e("nav",null,[e("ul",Be,[e("li",{class:S(["page-item",{disabled:p.value===1}])},[e("button",{class:"page-link",onClick:t[4]||(t[4]=s=>p.value--)},"«")],2),e("li",Ie,[e("span",Ee,"Page "+r(p.value)+" of "+r(q.value),1)]),e("li",{class:S(["page-item",{disabled:p.value===q.value}])},[e("button",{class:"page-link",onClick:t[5]||(t[5]=s=>p.value++)},"»")],2)])])])]),B.value||C.value?(n(),o("div",Ne,[e("div",je,[e("div",Re,[e("div",Me,[e("h5",qe,r(C.value?"Add New Transmittal":"Edit Transmittal"),1),e("button",{type:"button",class:"btn-close btn-close-white",onClick:N})]),e("div",ze,[e("form",{onSubmit:ne(Q,["prevent"])},[e("div",Le,[e("div",Je,[t[25]||(t[25]=e("label",{class:"form-label"},"TA ID",-1)),u(e("input",{"onUpdate:modelValue":t[6]||(t[6]=s=>l.value.ta_id=s),type:"text",class:"form-control",disabled:!C.value,placeholder:"Auto-generated",readonly:""},null,8,He),[[m,l.value.ta_id]])]),e("div",We,[t[26]||(t[26]=e("label",{class:"form-label"},[w("Date "),e("span",{class:"text-danger"},"*")],-1)),u(e("input",{"onUpdate:modelValue":t[7]||(t[7]=s=>l.value.date=s),type:"date",class:"form-control"},null,512),[[m,l.value.date]])]),e("div",Ge,[t[27]||(t[27]=e("label",{class:"form-label"},[w("From Origin "),e("span",{class:"text-danger"},"*")],-1)),u(e("select",{"onUpdate:modelValue":t[8]||(t[8]=s=>l.value.from_origin=s),class:"form-select",required:""},[(n(!0),o(y,null,x(_.value.fromOrigins,s=>(n(),o("option",{value:s},r(s),9,Ke))),256))],512),[[$,l.value.from_origin]])]),e("div",Qe,[t[28]||(t[28]=e("label",{class:"form-label"},"Document Type",-1)),u(e("input",{"onUpdate:modelValue":t[9]||(t[9]=s=>l.value.document_type=s),type:"text",class:"form-control",placeholder:""},null,512),[[m,l.value.document_type]])]),e("div",Xe,[t[29]||(t[29]=e("label",{class:"form-label"},"Company",-1)),u(e("select",{"onUpdate:modelValue":t[10]||(t[10]=s=>l.value.company=s),class:"form-select"},[(n(!0),o(y,null,x(_.value.companies,s=>(n(),o("option",{value:s},r(s),9,Ye))),256))],512),[[$,l.value.company]])]),e("div",Ze,[t[30]||(t[30]=e("label",{class:"form-label"},"Attention",-1)),u(e("input",{"onUpdate:modelValue":t[11]||(t[11]=s=>l.value.attention=s),type:"text",class:"form-control",required:""},null,512),[[m,l.value.attention]])]),e("div",et,[t[31]||(t[31]=e("label",{class:"form-label"},"Address",-1)),u(e("textarea",{"onUpdate:modelValue":t[12]||(t[12]=s=>l.value.address=s),rows:"2",class:"form-control",required:""},null,512),[[m,l.value.address]])]),e("div",tt,[t[32]||(t[32]=e("label",{class:"form-label"},"State",-1)),u(e("input",{"onUpdate:modelValue":t[13]||(t[13]=s=>l.value.state=s),type:"text",class:"form-control",required:""},null,512),[[m,l.value.state]])]),t[39]||(t[39]=e("h5",{class:"mt-4"},"Document Details",-1)),e("table",st,[t[33]||(t[33]=e("thead",null,[e("tr",null,[e("th",null,"Description"),e("th",null,"Remarks")])],-1)),e("tbody",null,[(n(!0),o(y,null,x(l.value.doc_details,(s,i)=>(n(),o("tr",{key:i},[e("td",null,[u(e("input",{"onUpdate:modelValue":b=>s.doc_desc=b,type:"text",class:"form-control form-control-sm"},null,8,lt),[[m,s.doc_desc]])]),e("td",null,[u(e("input",{"onUpdate:modelValue":b=>s.remarks=b,type:"text",class:"form-control form-control-sm"},null,8,at),[[m,s.remarks]])]),e("td",ot,[e("button",{type:"button",onClick:b=>te(i),class:"btn btn-sm btn-danger"},"×",8,nt)])]))),128))])]),e("button",{type:"button",onClick:ee,class:"btn btn-sm btn-outline-primary mb-3"},"+ Add Document"),e("div",rt,[t[34]||(t[34]=e("label",{class:"form-label"},"AWB/Reg",-1)),u(e("input",{"onUpdate:modelValue":t[14]||(t[14]=s=>l.value.awb_reg=s),type:"text",class:"form-control"},null,512),[[m,l.value.awb_reg]])]),e("div",dt,[t[35]||(t[35]=e("label",{class:"form-label"},"Expeditur",-1)),u(e("input",{"onUpdate:modelValue":t[15]||(t[15]=s=>l.value.expeditur=s),type:"text",class:"form-control"},null,512),[[m,l.value.expeditur]])]),e("div",it,[t[36]||(t[36]=e("label",{class:"form-label"},"Receiver Name",-1)),u(e("input",{"onUpdate:modelValue":t[16]||(t[16]=s=>l.value.receiver_name=s),type:"text",class:"form-control"},null,512),[[m,l.value.receiver_name]])]),e("div",ut,[t[37]||(t[37]=e("label",{class:"form-label"},"Receive Date",-1)),u(e("input",{"onUpdate:modelValue":t[17]||(t[17]=s=>l.value.receive_date=s),type:"date",class:"form-control"},null,512),[[m,l.value.receive_date]])]),e("div",ct,[t[38]||(t[38]=e("label",{class:"form-label"},"Status",-1)),u(e("select",{"onUpdate:modelValue":t[18]||(t[18]=s=>l.value.ras_status=s),class:"form-select"},[(n(!0),o(y,null,x(_.value.statuses,s=>(n(),o("option",{value:s},r(s),9,mt))),256))],512),[[$,l.value.ras_status]])])]),e("div",{class:"modal-footer border-top-0"},[e("button",{type:"button",class:"btn btn-secondary",onClick:N},"Cancel"),t[40]||(t[40]=e("button",{type:"submit",class:"btn btn-danger"},"Save",-1))])],32)])])])])):A("",!0),D.value?(n(),o("div",vt,[e("div",pt,[e("div",bt,[e("div",{class:"modal-header bg-danger text-white"},[t[41]||(t[41]=e("h5",{class:"modal-title"},"Confirm Delete",-1)),e("button",{type:"button",class:"btn-close btn-close-white",onClick:z})]),e("div",ft,[t[43]||(t[43]=e("p",null,"Are you sure you want to delete this transmittal?",-1)),e("p",null,[t[42]||(t[42]=e("strong",null,"TA ID:",-1)),w(" "+r((d=T.value)==null?void 0:d.ta_id),1)]),t[44]||(t[44]=e("p",{class:"text-danger"},"This action cannot be undone!",-1))]),e("div",{class:"modal-footer border-top-0"},[e("button",{type:"button",class:"btn btn-secondary",onClick:z},"Cancel"),e("button",{type:"button",class:"btn btn-danger",onClick:Y},"Delete")])])])])):A("",!0)])}}},xt=le(_t,[["__scopeId","data-v-fe318088"]]);export{xt as default};
