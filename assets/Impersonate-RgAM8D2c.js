import{_ as W,r as d,o as X,q as j,u as Y,C as Z,c as n,a as e,m as w,h as m,t as l,F as k,j as y,b as f,k as C,n as _,p as ee,v as E,x as S,A as U,D as te,g as o}from"./index-BSs2LI8U.js";const se={class:"card border-0 shadow-sm"},ae={class:"card-header"},le={class:"d-flex justify-content-between align-items-center"},ne=["disabled"],oe={class:"card-body"},re={key:0,class:"alert alert-danger alert-dismissible fade show"},ie={key:1,class:"text-center py-5"},ue={key:2,class:"table-responsive"},de={class:"table table-hover table-striped table-bordered mb-0"},ve={class:"table-dark"},ce=["onUpdate:modelValue","placeholder"],me={key:0},pe=["colspan"],be={class:"text-center"},fe=["onClick"],ge={class:"text-center"},ke={class:"text-center"},ye={class:"text-center"},_e={class:"text-center"},xe={class:"text-center"},he={class:"text-center"},we={class:"d-flex flex-wrap justify-content-between align-items-center mt-3"},Ce={class:"d-flex align-items-center mb-2"},Se=["value"],Ue={class:"text-muted"},$e={"aria-label":"Page navigation"},Ie={class:"pagination pagination-sm mb-0"},Pe={class:"page-item disabled"},Le={class:"page-link"},Be={key:0,class:"modal fade show d-block",style:{background:"rgba(0,0,0,0.5)"}},Ve={class:"modal-dialog modal-dialog-centered"},je={class:"modal-content border-0 shadow"},Ee={class:"modal-title"},Ne={class:"modal-body"},Ae={class:"mb-3"},Te=["disabled"],qe={class:"mb-3"},Fe={class:"mb-3"},Oe=["value"],Ke={class:"mb-3"},Me=["value"],De={class:"mb-3"},Re=["value"],ze={class:"mb-3"},Ge=["value"],He={class:"modal-footer border-top-0"},Je={key:1,class:"modal fade show d-block",style:{background:"rgba(0,0,0,0.5)"}},Qe={class:"modal-dialog modal-dialog-centered"},We={class:"modal-content border-0 shadow"},Xe={class:"modal-body"},Ye={__name:"Impersonate",setup(Ze){const K=te(),v=d([]),u=d({departments:[],placements:[],genders:["L","P"],locations:[]}),$=d(!0),x=d(null),M=d(0),L=d(!1),c=d(!1),i=d({}),D=d(-1),I=d(!1),h=d(null),b=d({username:"",name:"",department:"",placement:"",gender:"",lokasi:""}),g=d(10),p=d(1),R=[10,20,50,{value:-1,text:"All"}],N=[{text:"Username",value:"username",align:"center",sortable:!0,filterable:!0},{text:"Nama",value:"name",align:"center",sortable:!0,filterable:!0},{text:"Departemen",value:"department",align:"center",sortable:!0,filterable:!0},{text:"Jabatan",value:"jabatan",align:"center",sortable:!0,filterable:!0},{text:"Penempatan",value:"placement",align:"center",sortable:!0,filterable:!0},{text:"Gender",value:"gender",align:"center",sortable:!0,filterable:!0},{text:"Lokasi",value:"lokasi",align:"center",sortable:!0,filterable:!0}],z=async()=>{var a,t;try{$.value=!0;const s=await S.get(`${U}/users`);v.value=s.data,M.value=v.value.length,u.value.departments=[...new Set(v.value.map(r=>r.department).filter(Boolean))],u.value.placements=[...new Set(v.value.map(r=>r.placement).filter(Boolean))],u.value.locations=[...new Set(v.value.map(r=>r.lokasi).filter(Boolean))],u.value.site=[...new Set(v.value.map(r=>r.site).filter(Boolean))],$.value=!1}catch(s){x.value=((t=(a=s.response)==null?void 0:a.data)==null?void 0:t.message)||s.message,$.value=!1}};X(async()=>{await z()});const P=j(()=>v.value.filter(a=>Object.keys(b.value).every(t=>b.value[t]?String(a[t]).toLowerCase().includes(b.value[t].toLowerCase()):!0))),B=j(()=>{if(g.value===-1)return P.value;const a=(p.value-1)*g.value,t=a+g.value;return P.value.slice(a,t)}),A=j(()=>g.value===-1?1:Math.ceil(P.value.length/g.value)),G=async()=>{var a,t;try{if(c.value){const s=await S.post(`${U}/users`,i.value,{headers:{"Content-Type":"application/json"}});v.value.unshift(s.data),T(s.data),c.value=!1}else{const s=await S.put(`${U}/users`,i.value,{headers:{"Content-Type":"application/json"}});v.value[D.value]=s.data,T(s.data),L.value=!1}i.value={}}catch(s){x.value=((t=(a=s.response)==null?void 0:a.data)==null?void 0:t.error)||s.message,console.error("CRUD Error:",s)}},T=a=>{a.department&&!u.value.departments.includes(a.department)&&u.value.departments.push(a.department),a.placement&&!u.value.placements.includes(a.placement)&&u.value.placements.push(a.placement),a.lokasi&&!u.value.locations.includes(a.lokasi)&&u.value.locations.push(a.lokasi)},H=async()=>{var a,t;try{await S.delete(`${U}/users/${h.value.username}`),v.value=v.value.filter(s=>s.username!==h.value.username),I.value=!1,h.value=null}catch(s){x.value=((t=(a=s.response)==null?void 0:a.data)==null?void 0:t.message)||s.message,I.value=!1}},q=()=>{I.value=!1,h.value=null},F=()=>{L.value=!1,c.value=!1,i.value={}},V=Y(),O=Z(),J=async a=>{try{O.originalToken||O.setToken(V.token);const t=await S.post(`${U}/sa/impersonate`,{username:a},{headers:{Authorization:`Bearer ${V.token}`}}),{token:s,payload:r}=t.data;return V.setUser({username:r.username,name:r.name,photo:r.photo,level:r.user_level,permissions:r.permissions,token:s}),K.push("/login"),!0}catch(t){return console.error("Impersonation failed:",t),!1}},Q=()=>{Object.keys(b.value).forEach(a=>{b.value[a]=""}),p.value=1};return(a,t)=>(o(),n("div",se,[e("div",ae,[e("div",le,[t[13]||(t[13]=e("h3",{class:"mb-0"},"Impersonate User",-1)),e("div",null,[e("button",{onClick:Q,class:"btn btn-sm btn-light me-2",disabled:!Object.values(b.value).some(Boolean)},t[12]||(t[12]=[e("i",{class:"fas fa-filter-circle-xmark me-1"},null,-1),m(" Reset Filters ")]),8,ne)])])]),e("div",oe,[x.value?(o(),n("div",re,[m(l(x.value)+" ",1),e("button",{type:"button",class:"btn-close",onClick:t[0]||(t[0]=s=>x.value=null)})])):w("",!0),$.value?(o(),n("div",ie,t[14]||(t[14]=[e("div",{class:"spinner-border text-primary",role:"status"},[e("span",{class:"visually-hidden"},"Loading...")],-1),e("p",{class:"mt-2"},"Loading data...",-1)]))):(o(),n("div",ue,[e("table",de,[e("thead",ve,[e("tr",null,[(o(),n(k,null,y(N,s=>e("th",{key:s.value,class:_(s.align?`text-${s.align}`:"")},[e("div",null,l(s.text),1),s.filterable?f((o(),n("input",{key:0,"onUpdate:modelValue":r=>b.value[s.value]=r,type:"text",class:"form-control form-control-sm mt-1",placeholder:`Filter ${s.text}`,onInput:t[1]||(t[1]=r=>p.value=1)},null,40,ce)),[[E,b.value[s.value]]]):w("",!0)],2)),64))])]),e("tbody",null,[B.value.length===0?(o(),n("tr",me,[e("td",{colspan:N.length,class:"text-center py-4"},"No data available",8,pe)])):w("",!0),(o(!0),n(k,null,y(B.value,(s,r)=>(o(),n("tr",{key:r,class:"align-middle"},[e("td",be,[e("a",{href:"javascript:void(0)",onClick:et=>J(s.username),class:"text-primary fw-semibold"},l(s.username),9,fe)]),e("td",ge,l(s.name),1),e("td",ke,l(s.department),1),e("td",ye,l(s.jabatan),1),e("td",_e,l(s.placement),1),e("td",xe,[e("span",{class:_(["badge",s.gender==="Laki-laki"?"bg-info":"bg-danger"])},l(s.gender),3)]),e("td",he,l(s.lokasi),1)]))),128))])])])),e("div",we,[e("div",Ce,[f(e("select",{"onUpdate:modelValue":t[2]||(t[2]=s=>g.value=s),class:"form-select form-select-sm me-2",style:{width:"90px"},onChange:t[3]||(t[3]=s=>p.value=1)},[(o(),n(k,null,y(R,s=>e("option",{key:s.value||s,value:s.value||s},l(s.text||s),9,Se)),64))],544),[[C,g.value]]),e("small",Ue," Showing "+l(B.value.length)+" of "+l(P.value.length)+" entries ",1)]),e("nav",$e,[e("ul",Ie,[e("li",{class:_(["page-item",{disabled:p.value===1}])},[e("button",{class:"page-link",onClick:t[4]||(t[4]=s=>p.value--)},t[15]||(t[15]=[e("i",{class:"fas fa-chevron-left"},null,-1)]))],2),e("li",Pe,[e("span",Le," Page "+l(p.value)+" of "+l(A.value),1)]),e("li",{class:_(["page-item",{disabled:p.value===A.value}])},[e("button",{class:"page-link",onClick:t[5]||(t[5]=s=>p.value++)},t[16]||(t[16]=[e("i",{class:"fas fa-chevron-right"},null,-1)]))],2)])])])]),L.value||c.value?(o(),n("div",Be,[e("div",Ve,[e("div",je,[e("div",{class:_(["modal-header",(c.value,"bg-danger text-white")])},[e("h5",Ee,l(c.value?"Tambah Karyawan Baru":"Edit Karyawan"),1),e("button",{type:"button",class:_(["btn-close",(c.value,"btn-close-white")]),onClick:F},null,2)],2),e("div",Ne,[e("form",{onSubmit:ee(G,["prevent"])},[e("div",Ae,[t[17]||(t[17]=e("label",{class:"form-label"},[m("NIK "),e("span",{class:"text-danger"},"*")],-1)),f(e("input",{"onUpdate:modelValue":t[6]||(t[6]=s=>i.value.username=s),type:"text",class:"form-control",disabled:!c.value,required:""},null,8,Te),[[E,i.value.username]])]),e("div",qe,[t[18]||(t[18]=e("label",{class:"form-label"},[m("Nama "),e("span",{class:"text-danger"},"*")],-1)),f(e("input",{"onUpdate:modelValue":t[7]||(t[7]=s=>i.value.name=s),type:"text",class:"form-control",required:""},null,512),[[E,i.value.name]])]),e("div",Fe,[t[19]||(t[19]=e("label",{class:"form-label"},"Departemen",-1)),f(e("select",{"onUpdate:modelValue":t[8]||(t[8]=s=>i.value.department=s),class:"form-select",required:""},[(o(!0),n(k,null,y(u.value.departments,s=>(o(),n("option",{key:s,value:s},l(s),9,Oe))),128))],512),[[C,i.value.department]])]),e("div",Ke,[t[20]||(t[20]=e("label",{class:"form-label"},"Penempatan",-1)),f(e("select",{"onUpdate:modelValue":t[9]||(t[9]=s=>i.value.placement=s),class:"form-select",required:""},[(o(!0),n(k,null,y(u.value.placements,s=>(o(),n("option",{key:s,value:s},l(s),9,Me))),128))],512),[[C,i.value.placement]])]),e("div",De,[t[21]||(t[21]=e("label",{class:"form-label"},"Gender",-1)),f(e("select",{"onUpdate:modelValue":t[10]||(t[10]=s=>i.value.gender=s),class:"form-select",required:""},[(o(!0),n(k,null,y(u.value.genders,s=>(o(),n("option",{key:s,value:s},l(s==="L"?"Laki-laki":"Perempuan"),9,Re))),128))],512),[[C,i.value.gender]])]),e("div",ze,[t[23]||(t[23]=e("label",{class:"form-label"},"Lokasi",-1)),f(e("select",{"onUpdate:modelValue":t[11]||(t[11]=s=>i.value.lokasi=s),class:"form-select"},[t[22]||(t[22]=e("option",{value:""},"Pilih Lokasi",-1)),(o(!0),n(k,null,y(u.value.locations,s=>(o(),n("option",{key:s,value:s},l(s),9,Ge))),128))],512),[[C,i.value.lokasi]])]),e("div",He,[e("button",{type:"button",class:"btn btn-secondary",onClick:F},t[24]||(t[24]=[e("i",{class:"fas fa-times me-1"},null,-1),m(" Cancel ")])),e("button",{type:"submit",class:_(["btn",(c.value,"btn-danger")])},[t[25]||(t[25]=e("i",{class:"fas fa-save me-1"},null,-1)),m(" "+l(c.value?"Simpan":"Update"),1)],2)])],32)])])])])):w("",!0),I.value?(o(),n("div",Je,[e("div",Qe,[e("div",We,[e("div",{class:"modal-header bg-danger text-white"},[t[26]||(t[26]=e("h5",{class:"modal-title"},"Konfirmasi Hapus",-1)),e("button",{type:"button",class:"btn-close btn-close-white",onClick:q})]),e("div",Xe,[t[29]||(t[29]=e("p",null,"Apakah Anda yakin ingin menghapus karyawan ini?",-1)),e("p",null,[t[27]||(t[27]=e("strong",null,"NIK:",-1)),m(" "+l(h.value.username),1)]),e("p",null,[t[28]||(t[28]=e("strong",null,"Nama:",-1)),m(" "+l(h.value.name),1)]),t[30]||(t[30]=e("p",{class:"text-danger"},"Data yang dihapus tidak dapat dikembalikan!",-1))]),e("div",{class:"modal-footer border-top-0"},[e("button",{type:"button",class:"btn btn-secondary",onClick:q},t[31]||(t[31]=[e("i",{class:"fas fa-times me-1"},null,-1),m(" Batal ")])),e("button",{type:"button",class:"btn btn-danger",onClick:H},t[32]||(t[32]=[e("i",{class:"fas fa-trash-alt me-1"},null,-1),m(" Hapus ")]))])])])])):w("",!0)]))}},st=W(Ye,[["__scopeId","data-v-484f40cb"]]);export{st as default};
