import{_ as R,u as B,f as _,o as U,h as q,i as $,c as p,g as d,a as y,F as j,r as O,j as A,w as P,t as K,k as E,n as L,l as M,m as z,p as V,A as u,d as J,q as G}from"./index-CJDT_R6f.js";import{s as C,_ as H}from"./BigTable-KHPPHzi5.js";import"./xlsx-BWLgXIuo.js";const Q={class:"container-global mb-4"},W={key:0},X={class:"form-grid"},Y=["value"],Z=["value","onInput"],ee=["value","onInput"],le={key:5,class:"checkbox-field no-border"},te=["checked","onChange"],ae=["onUpdate:modelValue","placeholder"],re={key:1,class:"loading-message"},oe={__name:"MiniForm",props:{modelValue:{type:Object,default:()=>({})},fields:Object,urls:Object},emits:["update:modelValue"],setup(T,{emit:h}){const k=B(),c=T,b=h,r=_({...c.modelValue}),v=_({}),l=_(!1),a=async()=>{const s=Object.entries(c.urls.dropdowns).map(async([o,e])=>{try{const i=await V.get(e.url);v.value[o]=i.data.map(t=>({label:t,value:t}))}catch(i){console.error(`Failed to fetch dropdown data for ${o}:`,i)}});await Promise.all(s),l.value=!0};U(async()=>{await a()}),q(()=>c.modelValue,s=>{r.value={...s}});const f=async(s,o)=>{r.value[s]=o,b("update:modelValue",{...r.value}),c.fields.columns.forEach(async e=>{if(e.autofill&&e.autofill.triggeredBy===s)try{const i=await V.get(u+"/"+e.autofill.url,{params:[o.label]}),t=e.autofill.getValue(i.data);r.value[e.column]=t,b("update:modelValue",{...r.value})}catch(i){console.error(`Failed to autofill ${e.column}:`,i),r.value[e.column]=""}})},N=s=>{var o;return(o=c.fields.uneditable)==null?void 0:o.includes(s.column)},g=(s,o)=>{var e;return(e=c.fields[s])==null?void 0:e.includes(o.column)},D=async()=>{var s,o;try{const e={};for(const t of c.fields.columns||[]){const m=t.column;if((s=c.fields.toRemove)!=null&&s.includes(m)||(o=c.fields.exclude)!=null&&o.includes(m))continue;if(t.compute){e[m]=t.compute(r.value),typeof e[m]=="boolean"&&(e[m]=e[m]?1:0);continue}if(!(typeof t.visibleIf=="function"?t.visibleIf(r.value):!0))continue;const n=r.value[m],I=t.required??!1,S=n==null||typeof n=="string"&&n.trim()===""||Array.isArray(n)&&n.length===0&&typeof n!="boolean";if(I&&S){alert(`Field "${t.label||m}" is required.`);return}!I&&S||(Array.isArray(n)?e[m]=n.map(x=>(x==null?void 0:x.label)??x).join(","):typeof n=="object"&&"label"in n?e[m]=n.label:typeof n=="boolean"?e[m]=n?1:0:e[m]=n)}e.username=k.username,console.log("payload:",e);const i=await V.post(c.urls.data,e);window.location.reload(),console.log("Form submitted successfully:",i.data)}catch(e){console.error("Failed to submit form:",e)}},w=$(()=>c.fields.columns.filter(s=>typeof s.visibleIf=="function"?s.visibleIf(r.value):!0)),F=_(w.value);return q(w,s=>{const o=s.map(i=>i.column);F.value.filter(i=>!o.includes(i)).forEach(i=>{f(i,null)}),F.value=o},{immediate:!0}),(s,o)=>(d(),p("div",Q,[l.value?(d(),p("div",W,[y("form",{onSubmit:z(D,["prevent"]),class:"mini-form"},[y("div",X,[(d(!0),p(j,null,O(w.value,(e,i)=>(d(),p("div",{key:e.column,class:"form-field"},[y("label",null,K(e.label),1),N(e)?(d(),p("input",{key:0,type:"text",class:"input bordered",value:r.value[e.column],disabled:""},null,8,Y)):g("datetime",e)?(d(),p("input",{key:1,type:"datetime-local",class:"input bordered",value:r.value[e.column]||"",onInput:t=>f(e.column,t.target.value)},null,40,Z)):g("number",e)?(d(),p("input",{key:2,type:"number",class:"input bordered",value:r.value[e.column]||"",onInput:t=>f(e.column,t.target.value)},null,40,ee)):g("dropdown",e)?(d(),A(E(C),{key:3,modelValue:r.value[e.column],"onUpdate:modelValue":[t=>r.value[e.column]=t,t=>f(e.column,t)],options:v.value[e.column]||[],placeholder:"Select",label:"label","track-by":"value",class:"multiselect no-border"},null,8,["modelValue","onUpdate:modelValue","options"])):g("multiselect",e)?(d(),A(E(C),{key:4,modelValue:r.value[e.column],"onUpdate:modelValue":[t=>r.value[e.column]=t,t=>f(e.column,t)],options:v.value[e.column]||[],placeholder:"Select",label:"label","track-by":"value",class:L(["multiselect no-border",{"multiselect--multiple":g("multiselect",e)}]),multiple:"true","close-on-select":!1},null,8,["modelValue","onUpdate:modelValue","options","class"])):g("checkbox",e)?(d(),p("div",le,[y("input",{type:"checkbox",checked:r.value[e.column],onChange:t=>f(e.column,t.target.checked),class:"form-checkbox"},null,40,te)])):P((d(),p("input",{key:6,type:"text",class:"form-input bordered","onUpdate:modelValue":t=>r.value[e.column]=t,placeholder:e.filterText||e.label},null,8,ae)),[[M,r.value[e.column]]])]))),128))]),o[0]||(o[0]=y("div",{class:"submit-container"},[y("button",{type:"submit",class:"submit-button bordered"},"Submit")],-1))],32)])):(d(),p("div",re,o[1]||(o[1]=[y("i",{class:"pi pi-spin pi-spinner",style:{"font-size":"1.5rem"}},null,-1),y("p",null,"Loading form...",-1)])))]))}},se=R(oe,[["__scopeId","data-v-dd824ff5"]]),ie={class:"card"},me={__name:"AdminFormDe",setup(T){const h=B(),k=_({title:"Down Equipment",size:[5,55,100],canInsert:!0,canUpdate:!0}),c=_({data:`${u}/de_site`,params:`?username=${encodeURIComponent(h.username)}`,dropdowns:{vehicle_type:{url:u+"/dropdowns/vehicle_type",valueField:"vehicle_type",column:"vehicle_type"},tk_no:{url:u+"/dropdowns/tk_no",valueField:"tk_no",column:"tk_no"},tk_no_spare:{url:u+"/dropdowns/tk_no",valueField:"tk_no",column:"tk_no"},category:{url:u+"/dropdowns/op_svc_category",valueField:"category",column:"category"},engine_:{url:u+"/dropdowns/op_svc_category_engine",valueField:"engine_",column:"engine_"},drive_train:{url:u+"/dropdowns/op_svc_category_driveTrain",valueField:"drive_train",column:"drive_train"},chasis:{url:u+"/dropdowns/op_svc_category_chasis",valueField:"chasis",column:"chasis"},electrical_body:{url:u+"/dropdowns/op_svc_category_electricalBody",valueField:"electrical_body",column:"electrical_body"},ac_system:{url:u+"/dropdowns/op_svc_category_acSystem",valueField:"ac_system",column:"ac_system"},repair_electrical:{url:u+"/dropdowns/op_svc_category_repairElectrical",valueField:"repair_electrical",column:"repair_electrical"},defact:{url:u+"/dropdowns/op_svc_category_defact",valueField:"defact",column:"defact"},body:{url:u+"/dropdowns/op_svc_category_body",valueField:"body",column:"body"}},get:{vehicle_type:{url:u+"/get/vehicle_type",valueField:"vehicle_type",column:"vehicle_type"}}}),b=_({firstCol:{label:"TK Number",field:"tk_no",type:"type"},columns:[{column:"tk_no",label:"TK Number",filterText:"Filter TK",required:!0},{column:"vehicle_type",label:"Vehicle Type",filterText:"All Vehicle",autofill:{triggeredBy:"tk_no",url:"get/vehicle_type",getValue:l=>l[0]}},{column:"plate_no",label:"Plate Number",filterText:"All Plate No",autofill:{triggeredBy:"tk_no",url:"get/plate_no",getValue:l=>l[0]}},{column:"km",label:"Kilometer",filterText:"km",required:!0},{column:"down_since",label:"Down Since",filterText:"Down Since",required:!0},{column:"estimated_return",label:"Estimated Return"},{column:"spare_exists",label:"Unit Spare"},{column:"tk_no_spare",label:"TK NO Spare",filterText:"Filter TK",required:!0,visibleIf:l=>l.spare_exists===!0},{column:"category",label:"Category",filterText:"Category"},{column:"schedule",label:"Schedule",filterText:"Schedule",required:!0,visibleIf:l=>!1,compute:l=>(console.log("formdata ",l.category),console.log("some ",l.category.some(a=>a.value==="Schedule")),Array.isArray(l.category)&&l.category.some(a=>a.value==="Schedule"))},{column:"engine_",label:"Engine",filterText:"Engine",required:!0,visibleIf:l=>Array.isArray(l.category)&&l.category.some(a=>a.value==="Engine")},{column:"drive_train",label:"Drive Train",filterText:"Drive Train",required:!0,visibleIf:l=>Array.isArray(l.category)&&l.category.some(a=>a.value==="Drive Train")},{column:"chasis",label:"Chasis",filterText:"Chasis",required:!0,visibleIf:l=>Array.isArray(l.category)&&l.category.some(a=>a.value==="Chasis")},{column:"electrical_body",label:"Electrical Body",filterText:"Electrical Body",required:!0,visibleIf:l=>Array.isArray(l.category)&&l.category.some(a=>a.value==="Electrical Body")},{column:"ac_system",label:"AC System",filterText:"AC System",required:!0,visibleIf:l=>Array.isArray(l.category)&&l.category.some(a=>a.value==="AC System")},{column:"repair_electrical",label:"Repair Electrical",filterText:"Repair Electrical",required:!0,visibleIf:l=>Array.isArray(l.category)&&l.category.some(a=>a.value==="Repair Electrical")},{column:"defact",label:"Defact",filterText:"Defact",required:!0,visibleIf:l=>Array.isArray(l.category)&&l.category.some(a=>a.value==="Defact")},{column:"body",label:"Body ",filterText:"Body ",required:!0,visibleIf:l=>Array.isArray(l.category)&&l.category.some(a=>a.value==="Body")},{column:"comment",label:"Cause of damage",filterText:"Comment"},{column:"progress",label:"Progress",filterText:"Progress",visibleIf:l=>!1}],priority:["done","vehicle_type","plate_no"],hidden:["id","schedule"],toRemove:["customer","alt_location","username","createdAt","lastUpdated","vgtSelected"],exclude:["vehicle_type","plate_no","category"],merge:[],uneditable:["vehicle_type","plate_no"],dropdown:["tk_no","tk_no_spare"],multiselect:["category","engine_","drive_train","chasis","electrical_body","ac_system","repair_electrical","defact","body"],checkbox:["done","spare_exists","deleted"],date:[],datetime:["down_since","estimated_return"],number:["km"]}),r=_(JSON.parse(JSON.stringify(b.value)));r.value.uneditable.push("spare_exists","tk_no_spare","engine_","drive_train","chasis","electrical_body","ac_system","repair_electrical","defact","body");const v=_({});return U(()=>{b.value.columns.forEach(l=>{v.value[l.column]=l.default!==void 0?l.default:""}),v.value.username=h.username}),(l,a)=>(d(),p("div",null,[k.value.canInsert?(d(),A(se,{key:0,modelValue:v.value,"onUpdate:modelValue":a[0]||(a[0]=f=>v.value=f),fields:b.value,urls:c.value},null,8,["modelValue","fields","urls"])):J("",!0),y("div",ie,[G(H,{settings:k.value,urls:c.value,fields:r.value,canInsert:!1,canUpdate:!0},null,8,["settings","urls","fields"])])]))}};export{me as default};
