import{_ as B,u as U,f as _,o as R,B as q,j as $,c as p,g as d,a as y,F as j,r as P,C as A,w as K,t as L,p as C,n as O,m as M,l as z,k as V,A as u,d as G,q as H}from"./index-B_SQgsNz.js";import{_ as J}from"./BigTable-B2S38-Dc.js";import{s as E}from"./xlsx-Dirqld1P.js";const Q={class:"container-global mb-4"},W={key:0},X={class:"form-grid"},Y=["value"],Z=["value","onInput"],ee=["value","onInput"],le={key:5,class:"checkbox-field no-border"},te=["checked","onChange"],ae=["onUpdate:modelValue","placeholder"],re={key:1,class:"loading-message"},oe={__name:"MiniForm",props:{modelValue:{type:Object,default:()=>({})},fields:Object,urls:Object},emits:["update:modelValue"],setup(T,{emit:g}){const h=U(),c=T,v=g,a=_({...c.modelValue}),l=_({}),r=_(!1),x=async()=>{const s=Object.entries(c.urls.dropdowns).map(async([o,e])=>{try{const n=await V.get(e.url);l.value[o]=n.data.map(t=>({label:t,value:t}))}catch(n){console.error(`Failed to fetch dropdown data for ${o}:`,n)}});await Promise.all(s),r.value=!0};R(async()=>{await x()}),q(()=>c.modelValue,s=>{a.value={...s}});const f=async(s,o)=>{a.value[s]=o,v("update:modelValue",{...a.value}),c.fields.columns.forEach(async e=>{if(e.autofill&&e.autofill.triggeredBy===s)try{const n=await V.get(u+"/"+e.autofill.url,{params:[o.label]}),t=e.autofill.getValue(n.data);a.value[e.column]=t,v("update:modelValue",{...a.value})}catch(n){console.error(`Failed to autofill ${e.column}:`,n),a.value[e.column]=""}})},D=s=>{var o;return(o=c.fields.uneditable)==null?void 0:o.includes(s.column)},b=(s,o)=>{var e;return(e=c.fields[s])==null?void 0:e.includes(o.column)},N=async()=>{var s,o;try{const e={};for(const t of c.fields.columns||[]){const m=t.column;if((s=c.fields.toRemove)!=null&&s.includes(m)||(o=c.fields.exclude)!=null&&o.includes(m))continue;if(t.compute){e[m]=t.compute(a.value),typeof e[m]=="boolean"&&(e[m]=e[m]?1:0);continue}if(!(typeof t.visibleIf=="function"?t.visibleIf(a.value):!0))continue;const i=a.value[m],I=t.required??!1,S=i==null||typeof i=="string"&&i.trim()===""||Array.isArray(i)&&i.length===0&&typeof i!="boolean";if(I&&S){alert(`Field "${t.label||m}" is required.`);return}!I&&S||(Array.isArray(i)?e[m]=i.map(k=>(k==null?void 0:k.label)??k).join(","):typeof i=="object"&&"label"in i?e[m]=i.label:typeof i=="boolean"?e[m]=i?1:0:e[m]=i)}e.username=h.username,console.log("payload:",e);const n=await V.post(c.urls.data,e);window.location.reload(),console.log("Form submitted successfully:",n.data)}catch(e){console.error("Failed to submit form:",e)}},w=$(()=>c.fields.columns.filter(s=>typeof s.visibleIf=="function"?s.visibleIf(a.value):!0)),F=_(w.value);return q(w,s=>{const o=s.map(n=>n.column);F.value.filter(n=>!o.includes(n)).forEach(n=>{f(n,null)}),F.value=o},{immediate:!0}),(s,o)=>(d(),p("div",Q,[r.value?(d(),p("div",W,[y("form",{onSubmit:z(N,["prevent"]),class:"mini-form"},[y("div",X,[(d(!0),p(j,null,P(w.value,(e,n)=>(d(),p("div",{key:e.column,class:"form-field"},[y("label",null,L(e.label),1),D(e)?(d(),p("input",{key:0,type:"text",class:"input bordered",value:a.value[e.column],disabled:""},null,8,Y)):b("datetime",e)?(d(),p("input",{key:1,type:"datetime-local",class:"input bordered",value:a.value[e.column]||"",onInput:t=>f(e.column,t.target.value)},null,40,Z)):b("number",e)?(d(),p("input",{key:2,type:"number",class:"input bordered",value:a.value[e.column]||"",onInput:t=>f(e.column,t.target.value)},null,40,ee)):b("dropdown",e)?(d(),A(C(E),{key:3,modelValue:a.value[e.column],"onUpdate:modelValue":[t=>a.value[e.column]=t,t=>f(e.column,t)],options:l.value[e.column]||[],placeholder:"Select",label:"label","track-by":"value",class:"multiselect no-border"},null,8,["modelValue","onUpdate:modelValue","options"])):b("multiselect",e)?(d(),A(C(E),{key:4,modelValue:a.value[e.column],"onUpdate:modelValue":[t=>a.value[e.column]=t,t=>f(e.column,t)],options:l.value[e.column]||[],placeholder:"Select",label:"label","track-by":"value",class:O(["multiselect no-border",{"multiselect--multiple":b("multiselect",e)}]),multiple:"true","close-on-select":!1},null,8,["modelValue","onUpdate:modelValue","options","class"])):b("checkbox",e)?(d(),p("div",le,[y("input",{type:"checkbox",checked:a.value[e.column],onChange:t=>f(e.column,t.target.checked),class:"form-checkbox"},null,40,te)])):K((d(),p("input",{key:6,type:"text",class:"form-input bordered","onUpdate:modelValue":t=>a.value[e.column]=t,placeholder:e.filterText||e.label},null,8,ae)),[[M,a.value[e.column]]])]))),128))]),o[0]||(o[0]=y("div",{class:"submit-container"},[y("button",{type:"submit",class:"submit-button bordered"},"Submit")],-1))],32)])):(d(),p("div",re,o[1]||(o[1]=[y("i",{class:"pi pi-spin pi-spinner",style:{"font-size":"1.5rem"}},null,-1),y("p",null,"Loading form...",-1)])))]))}},se=B(oe,[["__scopeId","data-v-dd824ff5"]]),ne={class:"card"},ie={__name:"AdminForm",setup(T){const g=U(),h=_({title:"Down Equipment",size:[5,55,100],canInsert:!0,canUpdate:!0}),c=_({data:`${u}/de_site`,params:`?username=${encodeURIComponent(g.username)}`,dropdowns:{vehicle_type:{url:u+"/dropdowns/vehicle_type",valueField:"vehicle_type",column:"vehicle_type"},tk_no:{url:u+"/dropdowns/tk_no",valueField:"tk_no",column:"tk_no"},tk_no_spare:{url:u+"/dropdowns/tk_no",valueField:"tk_no",column:"tk_no"},category:{url:u+"/dropdowns/op_svc_category",valueField:"category",column:"category"},engine_:{url:u+"/dropdowns/op_svc_category_engine",valueField:"engine_",column:"engine_"},drive_train:{url:u+"/dropdowns/op_svc_category_driveTrain",valueField:"drive_train",column:"drive_train"},chasis:{url:u+"/dropdowns/op_svc_category_chasis",valueField:"chasis",column:"chasis"},electrical_body:{url:u+"/dropdowns/op_svc_category_electricalBody",valueField:"electrical_body",column:"electrical_body"},ac_system:{url:u+"/dropdowns/op_svc_category_acSystem",valueField:"ac_system",column:"ac_system"},repair_electrical:{url:u+"/dropdowns/op_svc_category_repairElectrical",valueField:"repair_electrical",column:"repair_electrical"},defact:{url:u+"/dropdowns/op_svc_category_defact",valueField:"defact",column:"defact"},body:{url:u+"/dropdowns/op_svc_category_body",valueField:"body",column:"body"}},get:{vehicle_type:{url:u+"/get/vehicle_type",valueField:"vehicle_type",column:"vehicle_type"}}}),v=_({firstCol:{label:"TK Number",field:"tk_no",type:"type"},columns:[{column:"tk_no",label:"TK NO",filterText:"Filter TK",required:!0},{column:"vehicle_type",label:"Vehicle Type",filterText:"All Vehicle",autofill:{triggeredBy:"tk_no",url:"get/vehicle_type",getValue:l=>l[0]}},{column:"plate_no",label:"Plate Number",filterText:"All Plate No",autofill:{triggeredBy:"tk_no",url:"get/plate_no",getValue:l=>l[0]}},{column:"km",label:"Kilometer",filterText:"km",required:!0},{column:"down_since",label:"Down Since",filterText:"Down Since",required:!0},{column:"estimated_return",label:"Estimated Return"},{column:"spare_exists",label:"Unit Spare"},{column:"tk_no_spare",label:"TK NO Spare",filterText:"Filter TK",required:!0,visibleIf:l=>l.spare_exists===!0},{column:"category",label:"Category",filterText:"Category"},{column:"schedule",label:"Schedule",filterText:"Schedule",required:!0,visibleIf:l=>!1,compute:l=>(console.log("formdata ",l.category),console.log("some ",l.category.some(r=>r.value==="Schedule")),Array.isArray(l.category)&&l.category.some(r=>r.value==="Schedule"))},{column:"engine_",label:"Engine",filterText:"Engine",required:!0,visibleIf:l=>Array.isArray(l.category)&&l.category.some(r=>r.value==="Engine")},{column:"drive_train",label:"Drive Train",filterText:"Drive Train",required:!0,visibleIf:l=>Array.isArray(l.category)&&l.category.some(r=>r.value==="Drive Train")},{column:"chasis",label:"Chasis",filterText:"Chasis",required:!0,visibleIf:l=>Array.isArray(l.category)&&l.category.some(r=>r.value==="Chasis")},{column:"electrical_body",label:"Electrical Body",filterText:"Electrical Body",required:!0,visibleIf:l=>Array.isArray(l.category)&&l.category.some(r=>r.value==="Electrical Body")},{column:"ac_system",label:"AC System",filterText:"AC System",required:!0,visibleIf:l=>Array.isArray(l.category)&&l.category.some(r=>r.value==="AC System")},{column:"repair_electrical",label:"Repair Electrical",filterText:"Repair Electrical",required:!0,visibleIf:l=>Array.isArray(l.category)&&l.category.some(r=>r.value==="Repair Electrical")},{column:"defact",label:"Defact",filterText:"Defact",required:!0,visibleIf:l=>Array.isArray(l.category)&&l.category.some(r=>r.value==="Defact")},{column:"body",label:"Body ",filterText:"Body ",required:!0,visibleIf:l=>Array.isArray(l.category)&&l.category.some(r=>r.value==="Body")},{column:"comment",label:"Comment",filterText:"Comment"},{column:"progress",label:"Progress",filterText:"Progress",visibleIf:l=>!1}],priority:["done","vehicle_type","plate_no"],hidden:["id","schedule"],toRemove:["customer","alt_location","username","createdAt","lastUpdated","vgtSelected"],exclude:["vehicle_type","plate_no","category"],merge:[],uneditable:["vehicle_type","plate_no"],dropdown:["tk_no","tk_no_spare"],multiselect:["category","engine_","drive_train","chasis","electrical_body","ac_system","repair_electrical","defact","body"],checkbox:["done","spare_exists","deleted"],date:[],datetime:["down_since","estimated_return"],number:["km"]}),a=_({});return R(()=>{v.value.columns.forEach(l=>{a.value[l.column]=l.default!==void 0?l.default:""}),a.value.username=g.username}),(l,r)=>(d(),p("div",null,[h.value.canInsert?(d(),A(se,{key:0,modelValue:a.value,"onUpdate:modelValue":r[0]||(r[0]=x=>a.value=x),fields:v.value,urls:c.value},null,8,["modelValue","fields","urls"])):G("",!0),y("div",ne,[H(J,{settings:h.value,urls:c.value,fields:v.value,canInsert:!1,canUpdate:!0},null,8,["settings","urls","fields"])])]))}},pe=B(ie,[["__scopeId","data-v-d735b63c"]]);export{pe as default};
//# sourceMappingURL=AdminForm-D4vPT-lI.js.map
